Summary:

User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 6 impacted components identified (**High impact only**)  
- High complexity change: impacts real-time data ingestion, batch and online valuation, error/audit handling, DB2 and VSAM data persistence, and CICS screen refresh.

---

Ranked Impact List:

| Program File Path                           | Impact | Nature   | Affected Paragraphs/Sections         | Dependency Path                                   |
|---------------------------------------------|--------|----------|--------------------------------------|---------------------------------------------------|
| src/programs/batch/BCHVAL00.cbl             | High   | Direct   | 2000-PRICE-UPDATE, 2100-REVAL-POS    | Real-time valuation engine, updates PRICEDATA      |
| src/programs/online/PORTDISP.cbl            | High   | Direct   | 1000-REFRESH-SCREEN, 1100-DISPLAY    | CICS “View Portfolio” screen, displays valuations  |
| src/programs/batch/HISTLD00.cbl             | High   | Direct   | 2000-LOAD-HIST-PRICE, 2100-ARCHIVE   | Loads/persists historical price data (PRICEHIST)   |
| src/programs/common/AUDPROC.cbl             | High   | Direct   | 2000-PROCESS-AUDIT, 3000-TERMINATE   | Writes to AUDITLOG on error/stale feed            |
| src/copybook/db2/PRICEDATA.cpy              | High   | Direct   | DATA DIVISION                        | DB2 table mapping for real-time price updates      |
| src/copybook/common/AUDITLOG.cpy            | High   | Direct   | DATA DIVISION                        | Copybook for audit logging                        |

---

JSON Metadata:
```
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/BCHVAL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PRICE-UPDATE", "2100-REVAL-POS"],
        "dependencyPath": ["BCHVAL00"],
        "rationale": "Batch valuation engine that recalculates position values and P&L on each price update, updates PRICEDATA."
      },
      {
        "programFilePath": "src/programs/online/PORTDISP.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-REFRESH-SCREEN", "1100-DISPLAY"],
        "dependencyPath": ["PORTDISP"],
        "rationale": "CICS online program for 'View Portfolio'; must refresh and display real-time valuations within 10 seconds."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.94,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-LOAD-HIST-PRICE", "2100-ARCHIVE"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads and archives historical price feeds into new VSAM KSDS PRICEHIST for backtesting."
      },
      {
        "programFilePath": "src/programs/common/AUDPROC.cbl",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-AUDIT", "3000-TERMINATE"],
        "dependencyPath": ["AUDPROC"],
        "rationale": "Handles error and audit logging when feed fails or prices are stale, writing to AUDITLOG."
      },
      {
        "programFilePath": "src/copybook/db2/PRICEDATA.cpy",
        "impactScore": 0.91,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["DATA DIVISION"],
        "dependencyPath": ["BCHVAL00", "PRICEDATA.cpy"],
        "rationale": "DB2 copybook for PRICEDATA table, updated by ingestion and valuation logic."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.90,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["DATA DIVISION"],
        "dependencyPath": ["AUDPROC", "AUDITLOG.cpy"],
        "rationale": "Copybook for audit logging, used for error and feed failure audit trail."
      }
    ]
  }
}
```

---

Visualization:

```mermaid
graph TD
    BCHVAL00["src/programs/batch/BCHVAL00.cbl"]
    PORTDISP["src/programs/online/PORTDISP.cbl"]
    HISTLD00["src/programs/batch/HISTLD00.cbl"]
    AUDPROC["src/programs/common/AUDPROC.cbl"]
    PRICEDATA["src/copybook/db2/PRICEDATA.cpy"]
    AUDITLOG["src/copybook/common/AUDITLOG.cpy"]

    BCHVAL00 -- uses --> PRICEDATA
    BCHVAL00 -- triggers --> HISTLD00
    BCHVAL00 -- logs errors --> AUDPROC
    PORTDISP -- displays --> PRICEDATA
    AUDPROC -- uses --> AUDITLOG
    HISTLD00 -- archives --> PRICEDATA
    HISTLD00 -- writes --> AUDITLOG

    style BCHVAL00 fill:#ffcccc,stroke:#d33,stroke-width:2px
    style PORTDISP fill:#ffcccc,stroke:#d33,stroke-width:2px
    style HISTLD00 fill:#ffcccc,stroke:#d33,stroke-width:2px
    style AUDPROC fill:#ffcccc,stroke:#d33,stroke-width:2px
    style PRICEDATA fill:#ffcccc,stroke:#d33,stroke-width:2px
    style AUDITLOG fill:#ffcccc,stroke:#d33,stroke-width:2px
```

---

Notes on Reasoning:

- Only files present in the GitHub repository are included.
- All selected components are directly responsible for real-time price ingestion, valuation, online display, error/audit handling, or DB2/VSAM data persistence as per the user story.
- All copybooks are included only if directly referenced in the high-impact valuation, audit, or data flow.
- JCL files are not listed as high-impact unless they directly control the valuation or ingestion batch, which in this repo is handled in the COBOL batch programs.
- Impact scores are assigned based on proximity to the user story’s requirements, criticality, and direct data/control flow.

End of Report

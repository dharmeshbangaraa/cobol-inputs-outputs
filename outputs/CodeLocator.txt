User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 7 impacted components identified (**High impact only**)  
- High complexity change affecting data ingestion, valuation, online display, error handling, audit, and performance-critical batch and online programs.

---

**Ranked Impact List**:

| Program File Path                          | Impact | Nature  | Affected Paragraphs/Sections                  | Dependency Path                                   |
|--------------------------------------------|--------|---------|-----------------------------------------------|---------------------------------------------------|
| `src/programs/batch/POSUPDT.cbl`           | High   | Direct  | (All, core valuation update logic)            | Real-time price ingestion triggers valuation recalculation |
| `src/programs/online/PORTDISP.cbl`         | High   | Direct  | DISPLAY-PORTFOLIO, REFRESH-VALUATION         | CICS screen for "View Portfolio" auto-refresh     |
| `src/programs/batch/HISTLD00.cbl`          | High   | Direct  | 2000-LOAD-HIST, 2300-CHECK-COMMIT            | Loads historical price data into VSAM PRICEHIST   |
| `src/programs/common/AUDPROC.cbl`          | High   | Direct  | 2000-PROCESS-AUDIT                           | Error/audit logging for stale feed or failures    |
| `src/copybook/db2/PRICEDATA.cpy`           | High   | Direct  | (All, DB2 price data mapping)                 | DB2 mapping for incoming price ticks              |
| `src/copybook/common/AUDITLOG.cpy`         | High   | Direct  | (All, audit log structure)                    | Used for UDF-level alarm and audit trail          |
| `src/programs/batch/PORTVAL.cbl`           | High   | Direct  | 2000-RECALC-PORTFOLIO, 2100-UPDATE-PNL        | Batch job for portfolio valuation and P&L update  |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/POSUPDT.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["ALL (core valuation logic)"],
        "dependencyPath": ["POSUPDT"],
        "rationale": "Primary batch program for updating positions and recalculating valuations based on real-time price feed."
      },
      {
        "programFilePath": "src/programs/online/PORTDISP.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["DISPLAY-PORTFOLIO", "REFRESH-VALUATION"],
        "dependencyPath": ["PORTDISP"],
        "rationale": "CICS program responsible for online portfolio display; must refresh values within 10 seconds of price update."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-LOAD-HIST", "2300-CHECK-COMMIT"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Handles loading of historical price feeds into VSAM PRICEHIST for backtesting and audit."
      },
      {
        "programFilePath": "src/programs/common/AUDPROC.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-AUDIT"],
        "dependencyPath": ["AUDPROC"],
        "rationale": "Processes audit logging for feed failures, stale prices, and UDF-level alarms."
      },
      {
        "programFilePath": "src/copybook/db2/PRICEDATA.cpy",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["ALL"],
        "dependencyPath": ["PRICEDATA"],
        "rationale": "Defines the DB2 structure for real-time price ticks; central to mapping incoming data."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["ALL"],
        "dependencyPath": ["AUDITLOG"],
        "rationale": "Copybook for audit log records, required for error handling and compliance."
      },
      {
        "programFilePath": "src/programs/batch/PORTVAL.cbl",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-RECALC-PORTFOLIO", "2100-UPDATE-PNL"],
        "dependencyPath": ["PORTVAL"],
        "rationale": "Batch program for recalculating portfolio values and P&L on each price update."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  subgraph Batch Processing
    POSUPDT["src/programs/batch/POSUPDT.cbl (High)"]
    PORTVAL["src/programs/batch/PORTVAL.cbl (High)"]
    HISTLD00["src/programs/batch/HISTLD00.cbl (High)"]
  end
  subgraph Online
    PORTDISP["src/programs/online/PORTDISP.cbl (High)"]
  end
  subgraph Common & Copybooks
    PRICEDATA["src/copybook/db2/PRICEDATA.cpy (High)"]
    AUDITLOG["src/copybook/common/AUDITLOG.cpy (High)"]
    AUDPROC["src/programs/common/AUDPROC.cbl (High)"]
  end

  PRICEDATA --> POSUPDT
  PRICEDATA --> PORTVAL
  PRICEDATA --> HISTLD00
  POSUPDT --> PORTVAL
  POSUPDT --> HISTLD00
  PORTVAL --> PORTDISP
  AUDITLOG --> AUDPROC
  AUDPROC --> POSUPDT
  AUDPROC --> PORTVAL
  AUDPROC --> HISTLD00
  AUDPROC --> PORTDISP
```

---

**Reasoning**:
- `POSUPDT.cbl` and `PORTVAL.cbl` are central to batch recalculation and position updates, directly impacted by real-time feed.
- `PORTDISP.cbl` is the CICS online display, must refresh portfolio values.
- `HISTLD00.cbl` loads historical price data into the new VSAM KSDS for backtesting.
- `AUDPROC.cbl` and `AUDITLOG.cpy` are required for error handling and audit logging as per acceptance criteria.
- `PRICEDATA.cpy` is the DB2 mapping for price ticks, essential for ingestion and valuation.
- All listed files are present in the repository and are directly referenced in the dependency maps and business flow for this user story.

**Note:** No extra files are included; only those present in the repository and with a direct, high-impact relationship to the user story are listed.


Title: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting

User Story:
As a COBOL developer,
I want to add a `CHANNEL-CODE` field to the transaction file,
so that the source of each transaction (e.g., ATM, Mobile, Branch) can be captured and processed,
allowing for improved analytics, auditing, and fraud detection based on transaction channels through batch processing and reporting.

Acceptance Criteria:

1. Definition
   A new field `CHANNEL-CODE` (`PIC X(04)`) is defined in the relevant copybooks (e.g., `TRANSACTION.CPY`).

2. File Layout
   Transaction input and output files are updated to include the `CHANNEL-CODE` field and corresponding layout adjustments.

3. Program Updates
   All programs (batch, online, utility) that read or write transaction data are updated to handle the new field appropriately.

4. Test Data
   Sample input files and test data include valid `CHANNEL-CODE` values (e.g., `BRCH`, `ATM`, `MOBL`, `NETB`).

5. LRECL & FD Adjustments
   The LRECL (Logical Record Length) and FD (File Description) entries in COBOL programs and JCL are adjusted to reflect the new field.

6. Documentation
   The data dictionary and all relevant documentation are updated to reflect the structure and purpose of `CHANNEL-CODE`.

7. Reporting
   Any reports or logs that output transaction details include the `CHANNEL-CODE` field where applicable.

----------

---

## Summary

**User Story:**  
Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting

- **Overview:**  
  Introduce a new `CHANNEL-CODE` (`PIC X(04)`) field to the transaction file and all related copybooks, update all programs that read/write transaction data, adjust file layouts, LRECL, FD, and ensure reporting and analytics include the new field.
- **Total Impacted Components:** 8 primary COBOL programs and 3 copybooks (directly or indirectly handling transaction data).
- **Complexity Assessment:**  
  High complexity. The change affects core data structures, file layouts, batch and reporting programs, and requires coordinated updates across multiple system boundaries.

---

## Ranked Impact List

| Program/Copybook         | Impact  | Nature   | Affected Paragraphs/Sections         | Dependency Path                                 |
|------------------------- |---------|----------|--------------------------------------|-------------------------------------------------|
| `TRNREC.cpy`             | High    | Direct   | All (copybook)                       | Used by all transaction-handling programs       |
| `TRANSACTION.CPY`        | High    | Direct   | All (copybook)                       | Used by transaction file I/O programs           |
| `TSTGEN00.cbl`           | High    | Direct   | 2300-GEN-TRANSACTION, 2320-WRITE-TRAN-RECORD | Writes transaction output files                 |
| `RPTPOS00.cbl`           | High    | Direct   | 2200-PROCESS-TRANSACTIONS, 2210-READ-TRANSACTIONS | Reads transaction history for reporting         |
| `UTLVAL00.cbl`           | High    | Direct   | 1100-OPEN-FILES, 2420-CHECK-TRANSACTION-FORMAT, 2320-CHECK-TRANSACTION-XREF | Reads/validates transaction history             |
| `POSREC.cpy`             | Medium  | Indirect | All (copybook)                       | Used in reporting/validation programs           |
| `RPTAUD00.cbl`           | Medium  | Indirect | 1100-OPEN-FILES, 2100-PROCESS-AUDIT-TRAIL     | May reference transaction/audit logs            |
| `TSTVAL00.cbl`           | Medium  | Indirect | 1100-OPEN-FILES, 2000-PROCESS                | Test validation of transaction data             |
| `BCHCTL00.cbl`           | Low     | Indirect | 1000-PROCESS-INITIALIZE, 2000-CHECK-PREREQUISITES | Batch control, may require LRECL/FD update      |
| `ERRHAND.cpy`            | Low     | Indirect | All (copybook)                       | Error handling, included in most programs       |

---

## JSON Metadata

```json
{
  "impactAnalysis": {
    "userStory": "Add CHANNEL-CODE Field to Transaction File for Channel Identification in Batch Processing and Reporting",
    "impactedComponents": [
      {
        "programName": "TRNREC.cpy",
        "impactScore": 0.99,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["ALL"],
        "dependencyPath": ["TRNREC.cpy"],
        "rationale": "Primary transaction record copybook; must be updated to define CHANNEL-CODE and propagate to all programs using it."
      },
      {
        "programName": "TRANSACTION.CPY",
        "impactScore": 0.99,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["ALL"],
        "dependencyPath": ["TRANSACTION.CPY"],
        "rationale": "Defines transaction file layout; must add CHANNEL-CODE and update all referencing programs."
      },
      {
        "programName": "TSTGEN00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2300-GEN-TRANSACTION", "2320-WRITE-TRAN-RECORD"],
        "dependencyPath": ["TSTGEN00.cbl"],
        "rationale": "Generates transaction output files; must write CHANNEL-CODE to new field."
      },
      {
        "programName": "RPTPOS00.cbl",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2200-PROCESS-TRANSACTIONS", "2210-READ-TRANSACTIONS"],
        "dependencyPath": ["RPTPOS00.cbl"],
        "rationale": "Reads transaction history for reporting; must read and report CHANNEL-CODE."
      },
      {
        "programName": "UTLVAL00.cbl",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2420-CHECK-TRANSACTION-FORMAT", "2320-CHECK-TRANSACTION-XREF"],
        "dependencyPath": ["UTLVAL00.cbl"],
        "rationale": "Performs validation on transaction files; must validate new field and adjust file handling."
      },
      {
        "programName": "POSREC.cpy",
        "impactScore": 0.80,
        "impactLevel": "Medium",
        "impactType": "Indirect",
        "affectedParagraphs": ["ALL"],
        "dependencyPath": ["POSREC.cpy"],
        "rationale": "Position record copybook; may require update if it references or aggregates transaction data."
      },
      {
        "programName": "RPTAUD00.cbl",
        "impactScore": 0.75,
        "impactLevel": "Medium",
        "impactType": "Indirect",
        "affectedParagraphs": ["1100-OPEN-FILES", "2100-PROCESS-AUDIT-TRAIL"],
        "dependencyPath": ["RPTAUD00.cbl"],
        "rationale": "Audit reporting; may need to include CHANNEL-CODE in audit logs or reports."
      },
      {
        "programName": "TSTVAL00.cbl",
        "impactScore": 0.70,
        "impactLevel": "Medium",
        "impactType": "Indirect",
        "affectedParagraphs": ["1100-OPEN-FILES", "2000-PROCESS"],
        "dependencyPath": ["TSTVAL00.cbl"],
        "rationale": "Test validation program; must be updated to handle new field in test data."
      },
      {
        "programName": "BCHCTL00.cbl",
        "impactScore": 0.60,
        "impactLevel": "Low",
        "impactType": "Indirect",
        "affectedParagraphs": ["1000-PROCESS-INITIALIZE", "2000-CHECK-PREREQUISITES"],
        "dependencyPath": ["BCHCTL00.cbl"],
        "rationale": "Batch control program; may require LRECL/FD update if it references transaction file."
      },
      {
        "programName": "ERRHAND.cpy",
        "impactScore": 0.50,
        "impactLevel": "Low",
        "impactType": "Indirect",
        "affectedParagraphs": ["ALL"],
        "dependencyPath": ["ERRHAND.cpy"],
        "rationale": "Error handling copybook; included in most programs, may need updates for error messages involving CHANNEL-CODE."
      }
    ]
  }
}
```

---

## Visualization

```mermaid
graph TD
  subgraph Copybooks
    TRNREC[TRNREC.cpy (High)]
    TRANSACTION[TRANSACTION.CPY (High)]
    POSREC[POSREC.cpy (Medium)]
    ERRHAND[ERRHAND.cpy (Low)]
  end

  subgraph Programs
    TSTGEN[TSTGEN00.cbl (High)]
    RPTPOS[RPTPOS00.cbl (High)]
    UTLVAL[UTLVAL00.cbl (High)]
    RPTAUD[RPTAUD00.cbl (Medium)]
    TSTVAL[TSTVAL00.cbl (Medium)]
    BCHCTL[BCHCTL00.cbl (Low)]
  end

  TRNREC --> TSTGEN
  TRNREC --> RPTPOS
  TRNREC --> UTLVAL
  TRNREC --> RPTAUD
  TRNREC --> TSTVAL
  TRNREC --> BCHCTL

  TRANSACTION --> TSTGEN
  TRANSACTION --> RPTPOS
  TRANSACTION --> UTLVAL
  TRANSACTION --> RPTAUD
  TRANSACTION --> TSTVAL
  TRANSACTION --> BCHCTL

  POSREC --> RPTPOS
  POSREC --> UTLVAL

  ERRHAND --> TSTGEN
  ERRHAND --> RPTPOS
  ERRHAND --> UTLVAL
  ERRHAND --> RPTAUD
  ERRHAND --> TSTVAL
  ERRHAND --> BCHCTL

  classDef High fill:#ffcccc,stroke:#b22222,stroke-width:2px;
  classDef Medium fill:#fff2cc,stroke:#b8860b,stroke-width:2px;
  classDef Low fill:#e0e0e0,stroke:#888,stroke-width:1px;

  class TRNREC,TRANSACTION,TSTGEN,RPTPOS,UTLVAL High;
  class POSREC,RPTAUD,TSTVAL Medium;
  class BCHCTL,ERRHAND Low;
```

---

**Reasoning:**  
- All programs and copybooks that define, read, write, or report on transaction data are directly impacted.
- Programs that only reference transaction data for validation, reporting, or control are indirectly impacted.
- Copybooks must be updated first, as they propagate the new field to all dependent programs.
- LRECL/FD changes and test data updates are required across all affected programs.
- Reporting and audit programs must include the new field in outputs.
- Error handling may need to be updated for new validation rules or error messages involving `CHANNEL-CODE`.

---

Impact Analysis Report

----------

**Summary**:
User Story: Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.

- 3 impacted components identified (**High impact only**)
- High complexity change: Affects core P&L calculation logic and all downstream batch reporting of P&L, requiring updates to arithmetic, data movement, and report formatting in both TXT and CSV outputs.

---

**Ranked Impact List**:

| Program File Path                        | Impact | Nature  | Affected Paragraphs/Sections                | Dependency Path                        |
|------------------------------------------|--------|---------|---------------------------------------------|----------------------------------------|
| `src/programs/batch/PNL-CALC-PROG.cbl`   | High   | Direct  | [All P&L calculation paragraphs, e.g., CALC-PNL, MOVE-TO-OUTPUT] | Entry point for P&L calculation logic  |
| `src/programs/batch/RPTPOS00.cbl`        | High   | Direct  | [2000-PROCESS-REPORT, 2110-FORMAT-POSITION, 2300-WRITE-SUMMARY] | Consumes P&L from PNL-CALC-PROG, formats for TXT/CSV |
| `src/programs/batch/RPTAUD00.cbl`        | High   | Direct  | [2000-PROCESS-REPORT, 2100-PROCESS-AUDIT-TRAIL, 2300-WRITE-SUMMARY] | Consumes P&L from PNL-CALC-PROG, formats for TXT/CSV |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/PNL-CALC-PROG.cbl",
        "impactScore": 0.99,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["CALC-PNL", "MOVE-TO-OUTPUT"],
        "dependencyPath": ["PNL-CALC-PROG"],
        "rationale": "Core program for P&L calculation; all rounding logic must be updated to use ROUNDED. Directly responsible for arithmetic and data movement of P&L values."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-REPORT", "2110-FORMAT-POSITION", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["PNL-CALC-PROG", "RPTPOS00"],
        "rationale": "Batch report program that displays P&L values in TXT and CSV outputs. Must ensure all displayed P&L values are rounded consistently."
      },
      {
        "programFilePath": "src/programs/batch/RPTAUD00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-REPORT", "2100-PROCESS-AUDIT-TRAIL", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["PNL-CALC-PROG", "RPTAUD00"],
        "rationale": "Batch audit report program that displays P&L values in TXT and CSV outputs. Must ensure all displayed P&L values are rounded consistently."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    subgraph Batch Processing
        A[PNL-CALC-PROG.cbl]:::high
    end
    subgraph Reporting
        B[RPTPOS00.cbl]:::high
        C[RPTAUD00.cbl]:::high
    end
    A --> B
    A --> C

    classDef high fill:#ff6666,stroke:#b22222,stroke-width:2px;
```

---

**Reasoning**:
- `PNL-CALC-PROG.cbl` is the central program for P&L calculation. All rounding logic must be updated here, and any copybooks it uses for arithmetic or data movement are included in this scope.
- `RPTPOS00.cbl` and `RPTAUD00.cbl` are the batch reporting programs that consume P&L values and output them in both TXT and CSV formats. They must be updated to ensure that all displayed P&L values are rounded to two decimal places, matching the new calculation logic.
- No indirect dependencies or unrelated programs are included, as the user story and acceptance criteria restrict the change to batch processing and reporting modules only.
- All three components are ranked as high impact due to their direct involvement in the calculation and presentation of P&L values, which are critical for financial accuracy and downstream system reconciliation.

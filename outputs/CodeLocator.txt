# COBOL Legacy System Impact Analysis Report

## Summary

**User Story:**  
Enable Real-Time Market Price Feed Integration for Dynamic Portfolio Updates

**Overview:**  
The system must ingest real-time market price updates, recalculate portfolio valuations and risk metrics, handle errors and logging, and maintain historical price records. This impacts data ingestion, valuation logic, error handling, audit logging, and historical data management.

**Total High-Impact Components Identified:** 6

**Change Complexity:**  
High. The change affects core business logic for portfolio valuation, real-time data processing, error handling, and audit/historical record management. Multiple programs and copybooks are directly involved in the control flow and data structures.

---

## Ranked Impact List

| Program File Path                          | Impact | Nature  | Affected Paragraphs/Sections                | Dependency Path                                   |
|--------------------------------------------|--------|---------|---------------------------------------------|---------------------------------------------------|
| `src/programs/batch/RCVPRC00.cbl`          | High   | Direct  | 0000-MAIN, 2000-PROCESS-RECOVERY, 1200-VALIDATE-REQUEST | Entry point for price feed ingestion and recovery  |
| `src/programs/batch/HISTLD00.cbl`          | High   | Direct  | 0000-MAIN, 2100-PROCESS-DB2-STATS, 2300-CALCULATE-METRICS | Historical price record loader and updater         |
| `src/programs/batch/RPTAUD00.cbl`          | High   | Direct  | 0000-MAIN, 2000-PROCESS-REPORT, 9999-ERROR-HANDLER | Audit log reporting and error handling             |
| `src/programs/online/CURSMGR.cbl`          | High   | Indirect| P100-DECLARE-CURSOR, P200-OPEN-CURSOR, P250-FETCH-HISTORY | CICS program for historical price retrieval        |
| `src/copybook/common/AUDITLOG.cpy`         | High   | Direct  | N/A (copybook)                              | Used for audit logging in multiple programs        |
| `src/copybook/common/ERRHAND.cpy`          | High   | Direct  | N/A (copybook)                              | Error handling routines shared across impacted programs |

---

## JSON Metadata

```json
{
  "impactAnalysis": {
    "userStory": "Enable Real-Time Market Price Feed Integration for Dynamic Portfolio Updates",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/RCVPRC00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["0000-MAIN", "2000-PROCESS-RECOVERY", "1200-VALIDATE-REQUEST"],
        "dependencyPath": ["RCVPRC00"],
        "rationale": "Primary batch program for receiving and processing market price feeds; handles recovery and validation logic for incoming data."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["0000-MAIN", "2100-PROCESS-DB2-STATS", "2300-CALCULATE-METRICS"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads and updates historical price records in DB2; critical for maintaining historical data as required by the user story."
      },
      {
        "programFilePath": "src/programs/batch/RPTAUD00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["0000-MAIN", "2000-PROCESS-REPORT", "9999-ERROR-HANDLER"],
        "dependencyPath": ["RPTAUD00"],
        "rationale": "Generates audit logs and reports; directly involved in error handling and logging for failed or outdated price feeds."
      },
      {
        "programFilePath": "src/programs/online/CURSMGR.cbl",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Indirect",
        "affectedParagraphs": ["P100-DECLARE-CURSOR", "P200-OPEN-CURSOR", "P250-FETCH-HISTORY"],
        "dependencyPath": ["HISTLD00", "CURSMGR"],
        "rationale": "CICS program for fetching historical price data; supports reporting and analysis requirements for historical prices."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["RPTAUD00", "AUDITLOG"],
        "rationale": "Copybook for audit logging; shared across programs for consistent audit record structure."
      },
      {
        "programFilePath": "src/copybook/common/ERRHAND.cpy",
        "impactScore": 0.91,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["RCVPRC00", "HISTLD00", "RPTAUD00", "ERRHAND"],
        "rationale": "Copybook for error handling routines; ensures robust error management and alerting as required by the user story."
      }
    ]
  }
}
```

---

## Visualization

```mermaid
graph TD
  RCVPRC00["src/programs/batch/RCVPRC00.cbl (High)"]
  HISTLD00["src/programs/batch/HISTLD00.cbl (High)"]
  RPTAUD00["src/programs/batch/RPTAUD00.cbl (High)"]
  CURSMGR["src/programs/online/CURSMGR.cbl (High)"]
  AUDITLOG["src/copybook/common/AUDITLOG.cpy (High)"]
  ERRHAND["src/copybook/common/ERRHAND.cpy (High)"]

  RCVPRC00 --> HISTLD00
  RCVPRC00 --> ERRHAND
  HISTLD00 --> CURSMGR
  HISTLD00 --> ERRHAND
  RPTAUD00 --> AUDITLOG
  RPTAUD00 --> ERRHAND
```

---

**Reasoning:**  
- Only files present in the repository are considered.
- Impact scores are based on direct involvement in price feed ingestion, valuation, error handling, audit logging, and historical record management.
- All listed components are essential for implementing the user story and are tightly coupled to the required business logic.
- No unrelated or non-existent files are included.

Impact Analysis Report

Title: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting

User Story:
As a COBOL developer,
I want to add a `CHANNEL-CODE` field to the transaction file,
so that the source of each transaction (e.g., ATM, Mobile, Branch) can be captured and processed,
allowing for improved analytics, auditing, and fraud detection based on transaction channels through batch processing and reporting.

Acceptance Criteria:
1. Definition
   A new field `CHANNEL-CODE` (`PIC X(04)`) is defined in the relevant copybooks (e.g., `TRANSACTION.CPY`).

2. File Layout
   Transaction input and output files are updated to include the `CHANNEL-CODE` field and corresponding layout adjustments.

3. Program Updates
   All programs (batch, online, utility) that read or write transaction data are updated to handle the new field appropriately.

4. Test Data
   Sample input files and test data include valid `CHANNEL-CODE` values (e.g., `BRCH`, `ATM`, `MOBL`, `NETB`).

5. LRECL & FD Adjustments
   The LRECL (Logical Record Length) and FD (File Description) entries in COBOL programs and JCL are adjusted to reflect the new field.

6. Documentation
   The data dictionary and all relevant documentation are updated to reflect the structure and purpose of `CHANNEL-CODE`.

7. Reporting
   Any reports or logs that output transaction details include the `CHANNEL-CODE` field where applicable.

Validation Notes:
- Structure: The story clearly outlines the requirement, acceptance criteria, and justification.
- Completeness: Covers definition, implementation, testing, documentation, and reporting.
- Spelling & Grammar: Minor refinements made for clarity and consistency.

Next Steps:
1. Repo Scan:
   Check `TRANSACTION.CPY` (or equivalent) for the presence of `CHANNEL-CODE`.
   If not present, add the field:
     05 CHANNEL-CODE PIC X(04). *> BRCH, ATM, MOBL, NETB

2. Code Changes:
   - Update relevant copybooks
   - Modify file layouts
   - Adjust LRECL and FD definitions

3. Testing:
   - Update input files
   - Include diverse test values for `CHANNEL-CODE`

4. Documentation:
   - Update README
   - Refresh the data dictionary
   - Comment changes in COBOL programs

5. Reporting:
   - Ensure reports/logs show `CHANNEL-CODE` wherever transaction details are printed

----------

**Summary**:
User Story: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting

- 6 impacted components identified (**High impact only**)
- High complexity change affecting transaction data structure, file layouts, batch processing, reporting, and copybook definitions across multiple programs and JCL

---

**Ranked Impact List**:

| Program File Path                         | Impact | Nature  | Affected Paragraphs/Sections                      | Dependency Path                        |
|-------------------------------------------|--------|---------|---------------------------------------------------|----------------------------------------|
| `src/copybook/common/TRNREC.cpy`          | High   | Direct  | 05 CHANNEL-CODE, Transaction Record Layout         | Copybook for transaction data structure|
| `src/programs/batch/RPTPOS00.cbl`         | High   | Direct  | FILE-CONTROL, 1100-OPEN-FILES, 2200-PROCESS-TRANSACTIONS | Uses TRNREC for transaction history/reporting |
| `src/programs/batch/RPTAUD00.cbl`         | High   | Direct  | FILE-CONTROL, 1100-OPEN-FILES, 2100-PROCESS-AUDIT-TRAIL | Reads/writes transaction/audit data    |
| `src/programs/utility/UTLVAL00.cbl`       | High   | Direct  | FILE-CONTROL, 1100-OPEN-FILES, 2100-PROCESS-VALIDATION | Validates transaction data using TRNREC|
| `src/programs/test/TSTGEN00.cbl`          | High   | Direct  | FILE-CONTROL, 2300-GEN-TRANSACTION, 2320-WRITE-TRAN-RECORD | Generates test transaction files       |
| `src/programs/test/TSTVAL00.cbl`          | High   | Direct  | FILE-CONTROL, 1100-OPEN-FILES, 2100-EXECUTE-TEST  | Reads test transaction files           |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Add CHANNEL-CODE Field to Transaction File for Channel Identification in Batch Processing and Reporting",
    "impactedComponents": [
      {
        "programFilePath": "src/copybook/common/TRNREC.cpy",
        "impactScore": 0.99,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["05 CHANNEL-CODE", "Transaction Record Layout"],
        "dependencyPath": ["TRNREC.cpy"],
        "rationale": "Central copybook for transaction record; all programs using transaction data must update to include CHANNEL-CODE."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["FILE-CONTROL", "1100-OPEN-FILES", "2200-PROCESS-TRANSACTIONS"],
        "dependencyPath": ["RPTPOS00.cbl", "TRNREC.cpy"],
        "rationale": "Batch report program reads transaction history via TRNREC; must update file layout, FD, and reporting logic."
      },
      {
        "programFilePath": "src/programs/batch/RPTAUD00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["FILE-CONTROL", "1100-OPEN-FILES", "2100-PROCESS-AUDIT-TRAIL"],
        "dependencyPath": ["RPTAUD00.cbl", "TRNREC.cpy"],
        "rationale": "Audit report program processes transaction/audit logs; must reflect new CHANNEL-CODE in file layout and reports."
      },
      {
        "programFilePath": "src/programs/utility/UTLVAL00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["FILE-CONTROL", "1100-OPEN-FILES", "2100-PROCESS-VALIDATION"],
        "dependencyPath": ["UTLVAL00.cbl", "TRNREC.cpy"],
        "rationale": "Utility program validates transaction data; must update to validate and process CHANNEL-CODE."
      },
      {
        "programFilePath": "src/programs/test/TSTGEN00.cbl",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["FILE-CONTROL", "2300-GEN-TRANSACTION", "2320-WRITE-TRAN-RECORD"],
        "dependencyPath": ["TSTGEN00.cbl", "TRNREC.cpy"],
        "rationale": "Test data generator creates transaction files; must generate CHANNEL-CODE values for test coverage."
      },
      {
        "programFilePath": "src/programs/test/TSTVAL00.cbl",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["FILE-CONTROL", "1100-OPEN-FILES", "2100-EXECUTE-TEST"],
        "dependencyPath": ["TSTVAL00.cbl", "TRNREC.cpy"],
        "rationale": "Test validation program reads transaction files; must recognize and validate CHANNEL-CODE field."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  A[src/copybook/common/TRNREC.cpy]:::high
  B[src/programs/batch/RPTPOS00.cbl]:::high
  C[src/programs/batch/RPTAUD00.cbl]:::high
  D[src/programs/utility/UTLVAL00.cbl]:::high
  E[src/programs/test/TSTGEN00.cbl]:::high
  F[src/programs/test/TSTVAL00.cbl]:::high

  B --> A
  C --> A
  D --> A
  E --> A
  F --> A

  classDef high fill:#ffcccc,stroke:#d33,stroke-width:2px;
```

---

**Reasoning**:
- The `TRNREC.cpy` copybook is the canonical definition for transaction records and is included in all programs that process transaction data.
- Batch/reporting programs (`RPTPOS00.cbl`, `RPTAUD00.cbl`) and utility/test programs (`UTLVAL00.cbl`, `TSTGEN00.cbl`, `TSTVAL00.cbl`) all directly use this copybook and/or process transaction files.
- All these programs must update their file layouts, FD sections, LRECL, and logic to handle the new `CHANNEL-CODE` field, and are thus **high impact**.
- Only these files are included as high impact; other programs/copybooks/JCL are not directly affected unless they process transaction files via TRNREC.

**End of Report**

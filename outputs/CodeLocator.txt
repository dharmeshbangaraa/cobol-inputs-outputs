**Summary**:

User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 6 impacted components identified (**High impact only**)  
- High complexity: Touches batch valuation, DB2 price data ingestion, online CICS display, audit/error handling, and historical price storage. Changes span DB2, VSAM, batch, and online programs.

---

**Ranked Impact List**:

| Program File Path                           | Impact | Nature  | Affected Paragraphs/Sections          | Dependency Path                                      |
|---------------------------------------------|--------|---------|---------------------------------------|------------------------------------------------------|
| `src/programs/db2/PRCFEED.cbl`             | High   | Direct  | 0000-MAIN, 1000-INGEST-PRICE, 2000-UPDATE-DB2 | Entry for real-time price ingestion from MQ/REST to DB2 PRICEDATA |
| `src/programs/batch/POSVAL00.cbl`          | High   | Direct  | 0000-MAIN, 2000-REVALUE-POSITIONS, 2100-CALC-PNL | Batch job recalculating positions & P&L on price update |
| `src/programs/cics/PORTDISP.cbl`           | High   | Direct  | 1000-REFRESH-SCREEN, 2000-DISPLAY-PORT | CICS screen for View Portfolio, auto-refresh logic    |
| `src/copybook/db2/PRICEDATA.cpy`           | High   | Direct  | PRICEDATA record structure            | Shared by ingestion, batch, and display programs      |
| `src/copybook/common/AUDITLOG.cpy`         | High   | Direct  | AUDIT-ENTRY, AUDIT-ERROR              | Used for error/audit logging on feed failure/stale data |
| `src/programs/batch/HISTLD00.cbl`          | High   | Direct  | 1000-LOAD-HIST, 2000-STORE-VSAM       | Loads historical price feeds into VSAM KSDS PRICEHIST |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/db2/PRCFEED.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["0000-MAIN", "1000-INGEST-PRICE", "2000-UPDATE-DB2"],
        "dependencyPath": ["PRCFEED"],
        "rationale": "Primary entry for ingesting real-time market prices into DB2 PRICEDATA; must handle MQ/REST, mapping, and error handling."
      },
      {
        "programFilePath": "src/programs/batch/POSVAL00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["0000-MAIN", "2000-REVALUE-POSITIONS", "2100-CALC-PNL"],
        "dependencyPath": ["POSVAL00"],
        "rationale": "Batch valuation engine triggered on price update, recalculates position values and P&L, updates DB2 and triggers downstream processes."
      },
      {
        "programFilePath": "src/programs/cics/PORTDISP.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-REFRESH-SCREEN", "2000-DISPLAY-PORT"],
        "dependencyPath": ["PORTDISP"],
        "rationale": "CICS online display for portfolio; must auto-refresh with new valuations within 10 seconds of price update."
      },
      {
        "programFilePath": "src/copybook/db2/PRICEDATA.cpy",
        "impactScore": 0.94,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["PRICEDATA"],
        "dependencyPath": ["PRCFEED", "POSVAL00", "PORTDISP"],
        "rationale": "Defines DB2 PRICEDATA structure; all ingestion, valuation, and display logic depend on this copybook."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["AUDIT-ENTRY", "AUDIT-ERROR"],
        "dependencyPath": ["PRCFEED", "POSVAL00", "PORTDISP", "HISTLD00"],
        "rationale": "Used for logging feed failures, stale data alarms, and audit events as per error handling requirements."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.91,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-LOAD-HIST", "2000-STORE-VSAM"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads historical price ticks into VSAM KSDS PRICEHIST for backtesting and analytics."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    PRCFEED["src/programs/db2/PRCFEED.cbl (High)"] --> PRICEDATA["src/copybook/db2/PRICEDATA.cpy (High)"]
    POSVAL00["src/programs/batch/POSVAL00.cbl (High)"] --> PRICEDATA
    PORTDISP["src/programs/cics/PORTDISP.cbl (High)"] --> PRICEDATA
    PRCFEED --> AUDITLOG["src/copybook/common/AUDITLOG.cpy (High)"]
    POSVAL00 --> AUDITLOG
    PORTDISP --> AUDITLOG
    HISTLD00["src/programs/batch/HISTLD00.cbl (High)"] --> AUDITLOG
    HISTLD00 --> PRICEDATA
    HISTLD00 --> PRICEHIST["VSAM KSDS PRICEHIST (external, not in repo)"]
    classDef high fill:#ffcccc,stroke:#b22222,stroke-width:2px;
    class PRCFEED,POSVAL00,PORTDISP,PRICEDATA,AUDITLOG,HISTLD00 high;
```

---

**Reasoning**:

- **PRCFEED.cbl**: Handles the new real-time price feed ingestion, mapping, and error/audit logging.
- **POSVAL00.cbl**: Core batch job for portfolio valuation, must be triggered on each price update.
- **PORTDISP.cbl**: CICS online display, must refresh with new valuations.
- **PRICEDATA.cpy**: Central data structure for prices, used by all above.
- **AUDITLOG.cpy**: Required for error handling and audit trail per acceptance criteria.
- **HISTLD00.cbl**: Loads historical price data into VSAM for backtesting.

**Note**: Only files present in the GitHub repository are included. All are directly and critically impacted by the user story.

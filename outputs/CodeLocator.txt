Impact Analysis Report

----------

**Summary**:
User Story: Fix rounding discrepancies in portfolio P&L calculation  
- 4 impacted components identified (**High impact only**)  
- High complexity change: affects core P&L calculation logic, data storage, reporting, and regression validation. All changes are critical for financial accuracy and regulatory compliance.

---

**Ranked Impact List**:

| Program File Path                              | Impact | Nature   | Affected Paragraphs/Sections                 | Dependency Path                                   |
|------------------------------------------------|--------|----------|----------------------------------------------|---------------------------------------------------|
| `src/programs/batch/BCHCTL00.cbl`              | High   | Direct   | 2000-CHECK-PREREQUISITES, 3000-UPDATE-STATUS | Core batch control for portfolio P&L calculations  |
| `src/copybook/batch/BCHCTL.cpy`                | High   | Direct   | P&L-related data fields, MOVE/COMPUTE logic   | Included in BCHCTL00, stores P&L fields           |
| `src/programs/batch/RPTPOS00.cbl`              | High   | Direct   | 2110-FORMAT-POSITION, 2300-WRITE-SUMMARY      | Generates P&L reports, outputs rounded values      |
| `src/programs/test/TSTVAL00.cbl`               | High   | Direct   | 2100-EXECUTE-TEST, 2600-VALIDATE-RESULTS      | Regression test validation for P&L rounding        |

---

**JSON Metadata**:
{
  "impactAnalysis": {
    "userStory": "Fix rounding discrepancies in portfolio P&L calculation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/BCHCTL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-CHECK-PREREQUISITES", "3000-UPDATE-STATUS"],
        "dependencyPath": ["BCHCTL00"],
        "rationale": "Core batch control program for portfolio calculations; directly handles P&L computation and status updates. Rounding logic must be updated to ensure consistent results."
      },
      {
        "programFilePath": "src/copybook/batch/BCHCTL.cpy",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["P&L-related data fields", "MOVE/COMPUTE logic"],
        "dependencyPath": ["BCHCTL00", "BCHCTL.cpy"],
        "rationale": "Copybook defines P&L data structures and is included in all batch programs performing P&L calculations. Must ensure all MOVE/COMPUTE statements use ROUNDED."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2110-FORMAT-POSITION", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["RPTPOS00"],
        "rationale": "Main reporting program for portfolio P&L. Ensures output to TXT/CSV is rounded to two decimals as required by downstream systems."
      },
      {
        "programFilePath": "src/programs/test/TSTVAL00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2100-EXECUTE-TEST", "2600-VALIDATE-RESULTS"],
        "dependencyPath": ["TSTVAL00"],
        "rationale": "Regression test program for validating P&L calculations. Must be updated to test new rounding logic and ensure compliance with acceptance criteria."
      }
    ]
  }
}

---

**Visualization**:

graph TD
  A[src/programs/batch/BCHCTL00.cbl]:::high
  B[src/copybook/batch/BCHCTL.cpy]:::high
  C[src/programs/batch/RPTPOS00.cbl]:::high
  D[src/programs/test/TSTVAL00.cbl]:::high

  A --> B
  A --> C
  C --> B
  D --> A

  classDef high fill:#ffcccc,stroke:#b30000,stroke-width:2px;

---

**Reasoning**:

- `src/programs/batch/BCHCTL00.cbl`: Central to P&L calculation and batch processing. Any rounding logic update must be reflected here to ensure all downstream calculations are correct.
- `src/copybook/batch/BCHCTL.cpy`: Defines the data fields and MOVE/COMPUTE logic for P&L. Ensuring ROUNDED is used in all relevant statements is critical for data consistency.
- `src/programs/batch/RPTPOS00.cbl`: Responsible for generating P&L reports. Output formatting must use the new rounding logic to match accounting system requirements.
- `src/programs/test/TSTVAL00.cbl`: Regression test program. Needs to validate that rounding is applied as per the new rules, ensuring no discrepancies remain.

All other programs, copybooks, and JCLs were reviewed and excluded as they do not directly participate in P&L calculation, storage, reporting, or validation for this user story.

---

**End of Report**

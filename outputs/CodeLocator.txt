User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 7 impacted components identified (**High impact only**)  
- High complexity: Touches real-time ingestion, DB2/VSAM, batch valuation, CICS online display, audit/error, and performance-critical paths.

---

**Ranked Impact List**:

| Program File Path                          | Impact | Nature   | Affected Paragraphs/Sections          | Dependency Path                                  |
|--------------------------------------------|--------|----------|---------------------------------------|--------------------------------------------------|
| `src/programs/batch/POSVAL00.cbl`         | High   | Direct   | 1000-INGEST-PRICE, 2000-REVAL-POS, 3000-UPDATE-PNL | Real-time price feed triggers valuation engine   |
| `src/programs/online/PORTDISP.cbl`        | High   | Direct   | 1000-REFRESH-DATA, 2000-DISPLAY-PORTFOLIO | CICS screen for “View Portfolio” auto-refresh    |
| `src/programs/common/AUDPROC.cbl`         | High   | Direct   | 2000-PROCESS-AUDIT, 3000-TERMINATE    | Audit logging for stale/missing price feed       |
| `src/copybook/db2/PRICEDATA.cpy`          | High   | Direct   | N/A (data structure)                  | DB2 table mapping for real-time price ingestion  |
| `src/copybook/vsam/PRICEHIST.cpy`         | High   | Direct   | N/A (data structure)                  | VSAM KSDS for historical price persistence       |
| `src/programs/batch/HISTLD00.cbl`         | High   | Indirect | 1000-LOAD-HIST, 2000-CHK-VSAM         | Loads/maintains historical price data            |
| `src/programs/batch/BCHCTL00.cbl`         | High   | Indirect | 2000-CHECK-PREREQUISITES, 3000-UPDATE-STATUS | Batch control for performance, batch window SLA  |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/POSVAL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-INGEST-PRICE", "2000-REVAL-POS", "3000-UPDATE-PNL"],
        "dependencyPath": ["POSVAL00"],
        "rationale": "Core valuation engine: recalculates position values and P&L on each real-time price update."
      },
      {
        "programFilePath": "src/programs/online/PORTDISP.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-REFRESH-DATA", "2000-DISPLAY-PORTFOLIO"],
        "dependencyPath": ["PORTDISP"],
        "rationale": "CICS online display for portfolio; must refresh within 10 seconds of price update."
      },
      {
        "programFilePath": "src/programs/common/AUDPROC.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-AUDIT", "3000-TERMINATE"],
        "dependencyPath": ["AUDPROC"],
        "rationale": "Handles audit logging for stale/missing price feeds and UDF-level alarms."
      },
      {
        "programFilePath": "src/copybook/db2/PRICEDATA.cpy",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["PRICEDATA"],
        "rationale": "DB2 copybook for PRICEDATA table, updated with every incoming tick."
      },
      {
        "programFilePath": "src/copybook/vsam/PRICEHIST.cpy",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["PRICEHIST"],
        "rationale": "VSAM KSDS copybook for historical price persistence/backtesting."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Indirect",
        "affectedParagraphs": ["1000-LOAD-HIST", "2000-CHK-VSAM"],
        "dependencyPath": ["POSVAL00", "HISTLD00"],
        "rationale": "Batch loader for historical price data (VSAM), supports backtesting and audit."
      },
      {
        "programFilePath": "src/programs/batch/BCHCTL00.cbl",
        "impactScore": 0.90,
        "impactLevel": "High",
        "impactType": "Indirect",
        "affectedParagraphs": ["2000-CHECK-PREREQUISITES", "3000-UPDATE-STATUS"],
        "dependencyPath": ["POSVAL00", "BCHCTL00"],
        "rationale": "Batch control program, ensures batch window SLAs are not violated by new real-time workload."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    A[src/programs/batch/POSVAL00.cbl]:::highimpact --> B[src/programs/online/PORTDISP.cbl]:::highimpact
    A --> C[src/copybook/db2/PRICEDATA.cpy]:::highimpact
    A --> D[src/programs/common/AUDPROC.cbl]:::highimpact
    A --> E[src/copybook/vsam/PRICEHIST.cpy]:::highimpact
    E --> F[src/programs/batch/HISTLD00.cbl]:::highimpact
    A --> G[src/programs/batch/BCHCTL00.cbl]:::highimpact

    classDef highimpact fill:#ff6961,stroke:#333,stroke-width:2px;
```

---

**Reasoning**:
- `POSVAL00.cbl` is the valuation engine: recalculates on each price update (core of user story).
- `PORTDISP.cbl` is the CICS display, must show live values (direct user acceptance criterion).
- `AUDPROC.cbl` is the audit/error handler, required for stale/missing data alarms.
- `PRICEDATA.cpy` (DB2) and `PRICEHIST.cpy` (VSAM) are the data structures for real-time and historical prices.
- `HISTLD00.cbl` is the batch loader for historical prices, supporting audit and backtesting.
- `BCHCTL00.cbl` is the batch control, ensures new workload does not violate SLAs.

**Note:**  
- Only files present in the repository are included.
- Only HIGH impact components are listed.
- All file paths are as per the codebase structure.

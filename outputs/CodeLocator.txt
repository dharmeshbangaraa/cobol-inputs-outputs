**Summary**:
User Story: Integrate real-time market price feed for dynamic portfolio valuation

- 6 impacted components identified (**High impact only**)
- High complexity change affecting real-time data ingestion, DB2/VSAM updates, valuation engine, CICS online display, error/audit handling, and batch processing.

---

**Ranked Impact List**:

| Program File Path                           | Impact | Nature   | Affected Paragraphs/Sections              | Dependency Path                                      |
|---------------------------------------------|--------|----------|-------------------------------------------|------------------------------------------------------|
| src/programs/batch/HISTLD00.cbl             | High   | Direct   | 2300-CHECK-COMMIT, 2310-UPDATE-CHECKPOINT | HISTLD00 (DB2/VSAM historical price load, batch)     |
| src/programs/batch/RPTPOS00.cbl             | High   | Direct   | 1100-OPEN-FILES, 2110-FORMAT-POSITION     | RPTPOS00 (Portfolio valuation report, batch)         |
| src/programs/online/PORTVW00.cbl            | High   | Direct   | 1000-INITIALIZE, 2000-REFRESH-DISPLAY     | PORTVW00 (CICS “View Portfolio” online screen)       |
| src/programs/batch/POSUPDT.cbl              | High   | Direct   | (all, see rationale)                      | POSUPDT (Batch position update, valuation engine)    |
| src/programs/common/AUDPROC.cbl             | High   | Direct   | 2000-PROCESS-AUDIT, 3000-TERMINATE        | AUDPROC (Audit logging, error handling)              |
| src/copybook/common/AUDITLOG.cpy            | High   | Direct   | (entire copybook)                         | Used by audit/error handling in multiple programs    |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2300-CHECK-COMMIT", "2310-UPDATE-CHECKPOINT"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads historical price data into VSAM/DB2; must be extended for new PRICEHIST KSDS and backtesting logic."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2110-FORMAT-POSITION"],
        "dependencyPath": ["RPTPOS00"],
        "rationale": "Batch job recalculates and reports position values and P&L; must consume real-time prices and update valuation logic."
      },
      {
        "programFilePath": "src/programs/online/PORTVW00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-INITIALIZE", "2000-REFRESH-DISPLAY"],
        "dependencyPath": ["PORTVW00"],
        "rationale": "CICS online program for portfolio view; must refresh display within 10 seconds of price update."
      },
      {
        "programFilePath": "src/programs/batch/POSUPDT.cbl",
        "impactScore": 0.94,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["POSUPDT"],
        "rationale": "Batch position update logic; must recalculate position values and P&L on each price update."
      },
      {
        "programFilePath": "src/programs/common/AUDPROC.cbl",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-AUDIT", "3000-TERMINATE"],
        "dependencyPath": ["AUDPROC"],
        "rationale": "Handles audit logging; must log feed failures, stale prices, and UDF-level alarms."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["AUDPROC", "RPTAUD00", "other audit consumers"],
        "rationale": "Copybook for audit log structure; required for new audit events related to feed failures and stale data."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  subgraph Batch Processing
    HISTLD00["src/programs/batch/HISTLD00.cbl"]
    RPTPOS00["src/programs/batch/RPTPOS00.cbl"]
    POSUPDT["src/programs/batch/POSUPDT.cbl"]
  end
  subgraph Online
    PORTVW00["src/programs/online/PORTVW00.cbl"]
  end
  subgraph Audit
    AUDPROC["src/programs/common/AUDPROC.cbl"]
    AUDITLOG["src/copybook/common/AUDITLOG.cpy"]
  end

  HISTLD00 -- feeds historical price data --> POSUPDT
  POSUPDT -- updates positions --> RPTPOS00
  RPTPOS00 -- reports to --> PORTVW00
  PORTVW00 -- triggers audit on error --> AUDPROC
  AUDPROC -- uses --> AUDITLOG
  HISTLD00 -- logs to --> AUDPROC
  POSUPDT -- logs to --> AUDPROC
  RPTPOS00 -- logs to --> AUDPROC
```

---

**Notes on Reasoning**:
- Only files present in the repository are included.
- All files listed are directly responsible for price ingestion, valuation, display, or audit/error handling as per the user story and acceptance criteria.
- All are high-impact due to their central role in the new real-time pricing and valuation workflow.
- JCL files are not included as high-impact unless they directly orchestrate the above programs for real-time/batch execution (none found with direct real-time logic).
- Copybooks like `AUDITLOG.cpy` are included due to their direct involvement in error/audit flows.
- No unrelated or non-existent files are included.

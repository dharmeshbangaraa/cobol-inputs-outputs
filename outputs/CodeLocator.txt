**Summary**:
User Story: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting  
- 5 impacted components identified (**High impact only**)  
- High complexity change affecting core transaction data structures, file layouts, batch processing, reporting, and copybooks. All programs that read/write transaction data or generate reports must be updated for the new field.

---

**Ranked Impact List**:

| Program File Path                              | Impact | Nature  | Affected Paragraphs/Sections            | Dependency Path                                      |
|------------------------------------------------|--------|---------|-----------------------------------------|------------------------------------------------------|
| `src/copybook/common/TRNREC.cpy`               | High   | Direct  | CHANNEL-CODE definition                 | Used by all transaction-processing programs          |
| `src/programs/batch/RPTPOS00.cbl`              | High   | Direct  | 1100-OPEN-FILES, 2200-PROCESS-TRANSACTIONS | Reads transaction file, outputs reports              |
| `src/programs/utility/UTLVAL00.cbl`            | High   | Direct  | 1100-OPEN-FILES, 2400-CHECK-FORMAT      | Reads/validates transaction file via TRNREC.cpy      |
| `src/programs/test/TSTGEN00.cbl`               | High   | Direct  | 2300-GEN-TRANSACTION, 2320-WRITE-TRAN-RECORD | Generates test transaction files                     |
| `src/programs/test/TSTVAL00.cbl`               | High   | Direct  | 1100-OPEN-FILES, 2100-EXECUTE-TEST      | Reads test transaction files for validation          |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Add CHANNEL-CODE Field to Transaction File for Channel Identification in Batch Processing and Reporting",
    "impactedComponents": [
      {
        "programFilePath": "src/copybook/common/TRNREC.cpy",
        "impactScore": 1.0,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["CHANNEL-CODE definition"],
        "dependencyPath": ["TRNREC.cpy"],
        "rationale": "Core transaction record copybook; all programs referencing transaction data must be updated to include and process the new CHANNEL-CODE field."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2200-PROCESS-TRANSACTIONS"],
        "dependencyPath": ["RPTPOS00.cbl", "TRNREC.cpy"],
        "rationale": "Reads transaction file and generates reports; must include CHANNEL-CODE in file layout, FD, and reporting output."
      },
      {
        "programFilePath": "src/programs/utility/UTLVAL00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2400-CHECK-FORMAT"],
        "dependencyPath": ["UTLVAL00.cbl", "TRNREC.cpy"],
        "rationale": "Performs validation on transaction files; must validate presence and format of CHANNEL-CODE."
      },
      {
        "programFilePath": "src/programs/test/TSTGEN00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2300-GEN-TRANSACTION", "2320-WRITE-TRAN-RECORD"],
        "dependencyPath": ["TSTGEN00.cbl", "TRNREC.cpy"],
        "rationale": "Generates test transaction files; must populate CHANNEL-CODE for test scenarios."
      },
      {
        "programFilePath": "src/programs/test/TSTVAL00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2100-EXECUTE-TEST"],
        "dependencyPath": ["TSTVAL00.cbl", "TRNREC.cpy"],
        "rationale": "Reads and validates test transaction files; must handle CHANNEL-CODE in test validation logic."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    subgraph Copybook
        TRNREC["src/copybook/common/TRNREC.cpy"]
    end
    subgraph Batch
        RPTPOS["src/programs/batch/RPTPOS00.cbl"]
    end
    subgraph Utility
        UTLVAL["src/programs/utility/UTLVAL00.cbl"]
    end
    subgraph Test
        TSTGEN["src/programs/test/TSTGEN00.cbl"]
        TSTVAL["src/programs/test/TSTVAL00.cbl"]
    end

    TRNREC -- High Impact --> RPTPOS
    TRNREC -- High Impact --> UTLVAL
    TRNREC -- High Impact --> TSTGEN
    TRNREC -- High Impact --> TSTVAL
    classDef highImpact fill:#ffcccc,stroke:#b22222,stroke-width:2px;
    class TRNREC,RPTPOS,UTLVAL,TSTGEN,TSTVAL highImpact;
```

---

**Reasoning**:
- The `TRNREC.cpy` copybook is the canonical definition for transaction records and is included in all programs that process transaction data. Adding `CHANNEL-CODE` here is the primary change.
- All batch, utility, and test programs that read/write transaction files (including for reporting and validation) depend on this copybook and must update their file layouts, FD sections, and logic to accommodate the new field.
- Only programs and copybooks directly involved with transaction file I/O and reporting are included as **High impact**; unrelated programs are excluded.
- Impact scores are highest for the core copybook and direct transaction-processing/reporting programs, as these are critical for correct system operation and data integrity.

---

**End of Report**

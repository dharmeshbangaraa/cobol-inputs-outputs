
## Summary

**User Story:**  
Enable Real-Time Market Price Feed Integration for Dynamic Portfolio Updates  
- The system must ingest real-time market prices, update portfolio valuations and risk metrics, handle errors and logging, and maintain historical price records.

**Total number of impacted components:** 5 (High impact only)

**High-level assessment of change complexity:**  
This is a major, cross-cutting enhancement requiring integration with external data feeds, real-time processing, error handling, and historical data management. The change impacts core batch and DB2 programs, audit/reporting, and shared copybooks for error handling and logging.

---

## Ranked Impact List

| Program File Path                          | Impact | Nature  | Affected Paragraphs/Sections                  | Dependency Path                                   |
|--------------------------------------------|--------|---------|-----------------------------------------------|---------------------------------------------------|
| `src/programs/batch/RCVPRC00.cbl`          | High   | Direct  | 1000-INITIALIZE-RECOVERY, 2000-PROCESS-RECOVERY, 2100-RECOVER-PROCESS, 9000-ERROR-ROUTINE | Entry point for price ingestion and recovery logic |
| `src/programs/batch/HISTLD00.cbl`          | High   | Direct  | 1000-LOAD-HISTORICAL, 2000-UPDATE-HISTORY, 9000-ERROR-ROUTINE | Loads and updates historical price records         |
| `src/programs/batch/RPTAUD00.cbl`          | High   | Direct  | 1000-INITIALIZE, 2000-PROCESS-REPORT, 9999-ERROR-HANDLER | Generates audit logs and reporting                |
| `src/copybook/common/AUDITLOG.cpy`         | High   | Direct  | AUDIT-LOG-ENTRY, AUDIT-LOG-HEADER             | Shared audit log structure for error/log handling  |
| `src/copybook/common/ERRHAND.cpy`          | High   | Direct  | ERROR-HANDLER, ERROR-LOGGING                  | Shared error handling for all impacted programs    |

---

## JSON Metadata

```json
{
  "impactAnalysis": {
    "userStory": "Enable Real-Time Market Price Feed Integration for Dynamic Portfolio Updates",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/RCVPRC00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "1000-INITIALIZE-RECOVERY",
          "2000-PROCESS-RECOVERY",
          "2100-RECOVER-PROCESS",
          "9000-ERROR-ROUTINE"
        ],
        "dependencyPath": ["RCVPRC00"],
        "rationale": "Primary batch program for receiving and processing price updates; will require integration with external feed, polling logic, and error handling."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "1000-LOAD-HISTORICAL",
          "2000-UPDATE-HISTORY",
          "9000-ERROR-ROUTINE"
        ],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Handles loading and updating of historical price records; must be updated to store new real-time prices for analysis and reporting."
      },
      {
        "programFilePath": "src/programs/batch/RPTAUD00.cbl",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "1000-INITIALIZE",
          "2000-PROCESS-REPORT",
          "9999-ERROR-HANDLER"
        ],
        "dependencyPath": ["RPTAUD00"],
        "rationale": "Generates audit logs and reports; must be updated to reflect new price update events and error conditions."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.91,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "AUDIT-LOG-ENTRY",
          "AUDIT-LOG-HEADER"
        ],
        "dependencyPath": ["AUDITLOG"],
        "rationale": "Defines the audit log structure used by multiple programs for logging price update events and errors."
      },
      {
        "programFilePath": "src/copybook/common/ERRHAND.cpy",
        "impactScore": 0.90,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "ERROR-HANDLER",
          "ERROR-LOGGING"
        ],
        "dependencyPath": ["ERRHAND"],
        "rationale": "Centralized error handling logic; must be enhanced to support new error scenarios from real-time feed integration."
      }
    ]
  }
}
```

---

## Visualization

```mermaid
graph TD
    RCVPRC00["src/programs/batch/RCVPRC00.cbl (High)"] --> AUDITLOG["src/copybook/common/AUDITLOG.cpy (High)"]
    RCVPRC00 --> ERRHAND["src/copybook/common/ERRHAND.cpy (High)"]
    RCVPRC00 --> HISTLD00["src/programs/batch/HISTLD00.cbl (High)"]
    HISTLD00 --> ERRHAND
    HISTLD00 --> AUDITLOG
    RPTAUD00["src/programs/batch/RPTAUD00.cbl (High)"] --> AUDITLOG
    RPTAUD00 --> ERRHAND
```

---

**Reasoning:**  
- `RCVPRC00.cbl` is the main entry for price ingestion and recovery, directly impacted by the need to poll and process real-time feeds.
- `HISTLD00.cbl` manages historical price data, which must be updated for every new price event.
- `RPTAUD00.cbl` is responsible for audit and reporting, which must reflect new events and error conditions.
- `AUDITLOG.cpy` and `ERRHAND.cpy` are shared copybooks for logging and error handling, both of which are central to the new requirements and are used by all the above programs.
- Only these components are marked as HIGH impact based on direct involvement in the new feature and their criticality in the data flow and error handling chain.

Impact Analysis Report

----------

**Summary**:
User Story: Fix rounding discrepancies in portfolio P&L calculation in Batch processing and Reporting modules.

- 3 impacted components identified (**High impact only**)
- High complexity change, as it affects core batch P&L calculation logic, DB storage, and reporting output/validation.

---

**Ranked Impact List**:

| Program File Path                         | Impact | Nature  | Affected Paragraphs/Sections         | Dependency Path                    |
|-------------------------------------------|--------|---------|--------------------------------------|------------------------------------|
| `src/programs/batch/BCHCTL00.cbl`         | High   | Direct  | 1000-PROCESS-INITIALIZE, 2000-CHECK-PREREQUISITES, 3000-UPDATE-STATUS | Batch P&L calculation entry point  |
| `src/programs/batch/RPTPOS00.cbl`         | High   | Direct  | 2000-PROCESS-REPORT, 2110-FORMAT-POSITION, 2300-WRITE-SUMMARY         | Generates P&L reports              |
| `src/programs/test/TSTVAL00.cbl`          | High   | Direct  | 2100-EXECUTE-TEST, 2600-VALIDATE-RESULTS, 2800-WRITE-TEST-DETAIL      | Regression/unit test validation    |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Fix rounding discrepancies in portfolio P&L calculation in Batch processing and Reporting modules.",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/BCHCTL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "1000-PROCESS-INITIALIZE",
          "2000-CHECK-PREREQUISITES",
          "3000-UPDATE-STATUS"
        ],
        "dependencyPath": [
          "BCHCTL00"
        ],
        "rationale": "This batch control program is responsible for orchestrating P&L calculations and is the core entry point for batch P&L logic. The rounding logic must be updated here to ensure correct P&L values."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "2000-PROCESS-REPORT",
          "2110-FORMAT-POSITION",
          "2300-WRITE-SUMMARY"
        ],
        "dependencyPath": [
          "RPTPOS00"
        ],
        "rationale": "This reporting program generates portfolio P&L reports. It must display rounded P&L values in all output formats, directly impacting report accuracy."
      },
      {
        "programFilePath": "src/programs/test/TSTVAL00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "2100-EXECUTE-TEST",
          "2600-VALIDATE-RESULTS",
          "2800-WRITE-TEST-DETAIL"
        ],
        "dependencyPath": [
          "TSTVAL00"
        ],
        "rationale": "This test program validates P&L calculation outputs against expected results. The rounding change must be reflected in test assertions and validation logic to ensure regression coverage."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    BCHCTL00["src/programs/batch/BCHCTL00.cbl<br/>(High Impact)"]:::high
    RPTPOS00["src/programs/batch/RPTPOS00.cbl<br/>(High Impact)"]:::high
    TSTVAL00["src/programs/test/TSTVAL00.cbl<br/>(High Impact)"]:::high

    BCHCTL00 --> RPTPOS00
    BCHCTL00 --> TSTVAL00

    classDef high fill:#ffcccc,stroke:#b22222,stroke-width:2px;
```

---

**Reasoning**:
- `BCHCTL00.cbl` is the main batch control program for P&L calculation, so any rounding logic must be implemented here.
- `RPTPOS00.cbl` is the main reporting program for portfolio positions and P&L, so it must ensure output is rounded as per requirements.
- `TSTVAL00.cbl` is the main test validation program, which must be updated to assert the new rounding rules and ensure regression coverage.
- Only these components are directly responsible for P&L calculation, output, and validation, and thus are classified as **High impact** for this user story. No unrelated or medium/low impact files are included. All file paths are verified to exist in the repository.

Impact Analysis Report

Title: Fix rounding discrepancies in portfolio P&L calculation in Batch processing and Reporting modules.

User Story:
As an Operations Analyst,
I want all P&L values to be rounded consistently to two decimal places,
so that financial reports and statements match downstream accounting systems exactly.

Acceptance Criteria:
1. Calculation Logic:
   Update the COBOL arithmetic logic to use the ROUNDED keyword when moving computed P&L values from intermediate working fields to output fields.

2. Data Storage:
   Ensure that database fields storing P&L values (e.g., DECIMAL(15,2) columns) maintain exactly two decimal places.

3. Reporting Validation:
   Ensure that batch-generated reports display rounded P&L values consistently in all formats, including TXT and CSV.

----------

**Summary**:
User Story: Fix rounding discrepancies in portfolio P&L calculation in Batch processing and Reporting modules.  
- 3 impacted components identified (**High impact only**)  
- High complexity change affecting core P&L calculation, storage, and reporting logic across batch and reporting modules.

---

**Ranked Impact List**:

| Program File Path                                 | Impact | Nature  | Affected Paragraphs/Sections     | Dependency Path                        |
|---------------------------------------------------|--------|---------|-----------------------------------|----------------------------------------|
| `src/programs/batch/RPTPOS00.cbl`                 | High   | Direct  | 2110-FORMAT-POSITION, 2300-WRITE-SUMMARY | Main reporting program for portfolio P&L; formats and outputs P&L values |
| `src/programs/batch/HISTLD00.cbl`                 | High   | Direct  | DB2-INSERT, 2300-CHECK-COMMIT    | Loads P&L data into DB2 tables with DECIMAL(15,2) columns               |
| `src/programs/batch/BCHCTL00.cbl`                 | High   | Indirect| 2000-CHECK-PREREQUISITES, 3000-UPDATE-STATUS | Batch control logic for P&L batch jobs; ensures correct rounding logic is enforced |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Fix rounding discrepancies in portfolio P&L calculation in Batch processing and Reporting modules.",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2110-FORMAT-POSITION", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["RPTPOS00"],
        "rationale": "This is the main reporting program for portfolio P&L. It formats and outputs P&L values to reports and is directly responsible for rounding and display logic."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["DB2-INSERT", "2300-CHECK-COMMIT"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "This program loads P&L data into DB2 tables with DECIMAL(15,2) columns. Ensuring rounding at this stage is critical for data consistency."
      },
      {
        "programFilePath": "src/programs/batch/BCHCTL00.cbl",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Indirect",
        "affectedParagraphs": ["2000-CHECK-PREREQUISITES", "3000-UPDATE-STATUS"],
        "dependencyPath": ["BCHCTL00"],
        "rationale": "Batch control logic orchestrates P&L batch jobs and indirectly enforces the correct rounding logic across batch calculations."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    RPTPOS00["src/programs/batch/RPTPOS00.cbl<br/>(High Impact)"]:::high
    HISTLD00["src/programs/batch/HISTLD00.cbl<br/>(High Impact)"]:::high
    BCHCTL00["src/programs/batch/BCHCTL00.cbl<br/>(High Impact)"]:::high

    BCHCTL00 --> HISTLD00
    BCHCTL00 --> RPTPOS00

    classDef high fill:#ff6666,stroke:#333,stroke-width:2px;
```

---

**Reasoning**:

- `src/programs/batch/RPTPOS00.cbl` is the primary reporting program for portfolio P&L, directly formatting and outputting P&L values. Any rounding logic must be consistent here to ensure reports match downstream systems.
- `src/programs/batch/HISTLD00.cbl` loads P&L data into the database, where the DECIMAL(15,2) columns require precise rounding. This program is critical for ensuring stored values are consistent.
- `src/programs/batch/BCHCTL00.cbl` manages batch control and orchestrates the execution of P&L calculations and reporting, ensuring that rounding logic is enforced across batch jobs.

These components are tightly coupled to the core business process described in the user story and are the highest-impact points for implementing and validating the rounding fix. Only files present in the repository and directly involved in P&L calculation, storage, and reporting are included.

Impact Analysis Report

Title: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting

User Story:
As a COBOL developer,
I want to add a `CHANNEL-CODE` field to the transaction file,
so that the source of each transaction (e.g., ATM, Mobile, Branch) can be captured and processed,
allowing for improved analytics, auditing, and fraud detection based on transaction channels through batch processing and reporting.

Acceptance Criteria:
1. Definition
   A new field `CHANNEL-CODE` (`PIC X(04)`) is defined in the relevant copybooks (e.g., `TRANSACTION.CPY`).

2. File Layout
   Transaction input and output files are updated to include the `CHANNEL-CODE` field and corresponding layout adjustments.

3. Program Updates
   All programs (batch, online, utility) that read or write transaction data are updated to handle the new field appropriately.

4. Test Data
   Sample input files and test data include valid `CHANNEL-CODE` values (e.g., `BRCH`, `ATM`, `MOBL`, `NETB`).

5. LRECL & FD Adjustments
   The LRECL (Logical Record Length) and FD (File Description) entries in COBOL programs and JCL are adjusted to reflect the new field.

6. Documentation
   The data dictionary and all relevant documentation are updated to reflect the structure and purpose of `CHANNEL-CODE`.

7. Reporting
   Any reports or logs that output transaction details include the `CHANNEL-CODE` field where applicable.

Validation Notes:
- Structure: The story clearly outlines the requirement, acceptance criteria, and justification.
- Completeness: Covers definition, implementation, testing, documentation, and reporting.
- Spelling & Grammar: Minor refinements made for clarity and consistency.

Next Steps:
1. Repo Scan:
   Check `TRANSACTION.CPY` (or equivalent) for the presence of `CHANNEL-CODE`.
   If not present, add the field:
     05 CHANNEL-CODE PIC X(04). *> BRCH, ATM, MOBL, NETB

2. Code Changes:
   - Update relevant copybooks
   - Modify file layouts
   - Adjust LRECL and FD definitions

3. Testing:
   - Update input files
   - Include diverse test values for `CHANNEL-CODE`

4. Documentation:
   - Update README
   - Refresh the data dictionary
   - Comment changes in COBOL programs

5. Reporting:
   - Ensure reports/logs show `CHANNEL-CODE` wherever transaction details are printed

----------

**Summary**:
User Story: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting  
- 5 impacted components identified (**High impact only**)  
- High complexity change affecting transaction data structure, all batch processing, reporting, and copybook definitions

---

**Ranked Impact List**:

| Program File Path                        | Impact | Nature  | Affected Paragraphs/Sections                | Dependency Path                                            |
|------------------------------------------|--------|---------|---------------------------------------------|------------------------------------------------------------|
| `src/copybook/common/TRNREC.cpy`        | High   | Direct  | Definition Section                          | Used by all transaction-processing programs                |
| `src/programs/batch/RPTPOS00.cbl`        | High   | Direct  | 1100-OPEN-FILES, 2200-PROCESS-TRANSACTIONS  | Reads/writes transaction file via TRNREC.cpy               |
| `src/programs/batch/HISTLD00.cbl`        | High   | Direct  | 1000-INITIALIZE, 2000-PROCESS-LOAD          | Loads transactions, uses TRNREC.cpy                        |
| `src/programs/utility/UTLVAL00.cbl`      | High   | Direct  | 1100-OPEN-FILES, 2100-PROCESS-VALIDATION    | Validates transaction files, uses TRNREC.cpy               |
| `src/programs/test/TSTGEN00.cbl`         | High   | Direct  | 2300-GEN-TRANSACTION, 2320-WRITE-TRAN-RECORD| Generates test transaction files, must include CHANNEL-CODE |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Add CHANNEL-CODE Field to Transaction File for Channel Identification in Batch Processing and Reporting",
    "impactedComponents": [
      {
        "programFilePath": "src/copybook/common/TRNREC.cpy",
        "impactScore": 1.0,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["Definition Section"],
        "dependencyPath": ["All programs using TRNREC.cpy"],
        "rationale": "This copybook defines the transaction record structure. Adding CHANNEL-CODE here is foundational and impacts all programs that include it."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2200-PROCESS-TRANSACTIONS"],
        "dependencyPath": ["RPTPOS00.cbl", "TRNREC.cpy"],
        "rationale": "Reads and reports on transaction data using TRNREC.cpy; must be updated to handle new CHANNEL-CODE field."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-INITIALIZE", "2000-PROCESS-LOAD"],
        "dependencyPath": ["HISTLD00.cbl", "TRNREC.cpy"],
        "rationale": "Loads transaction history, relies on transaction record structure; must be updated for CHANNEL-CODE."
      },
      {
        "programFilePath": "src/programs/utility/UTLVAL00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2100-PROCESS-VALIDATION"],
        "dependencyPath": ["UTLVAL00.cbl", "TRNREC.cpy"],
        "rationale": "Performs validation on transaction files; must validate and process the new CHANNEL-CODE field."
      },
      {
        "programFilePath": "src/programs/test/TSTGEN00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2300-GEN-TRANSACTION", "2320-WRITE-TRAN-RECORD"],
        "dependencyPath": ["TSTGEN00.cbl", "TRNREC.cpy"],
        "rationale": "Generates test transaction files; must generate and populate valid CHANNEL-CODE values."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  subgraph Copybooks
    TRNREC["src/copybook/common/TRNREC.cpy"]
  end

  subgraph BatchPrograms
    RPTPOS00["src/programs/batch/RPTPOS00.cbl"]
    HISTLD00["src/programs/batch/HISTLD00.cbl"]
  end

  subgraph Utility
    UTLVAL00["src/programs/utility/UTLVAL00.cbl"]
  end

  subgraph Test
    TSTGEN00["src/programs/test/TSTGEN00.cbl"]
  end

  TRNREC -- High Impact --> RPTPOS00
  TRNREC -- High Impact --> HISTLD00
  TRNREC -- High Impact --> UTLVAL00
  TRNREC -- High Impact --> TSTGEN00

  style TRNREC fill:#ffcccc,stroke:#d33,stroke-width:2px
  style RPTPOS00 fill:#ffcccc,stroke:#d33,stroke-width:2px
  style HISTLD00 fill:#ffcccc,stroke:#d33,stroke-width:2px
  style UTLVAL00 fill:#ffcccc,stroke:#d33,stroke-width:2px
  style TSTGEN00 fill:#ffcccc,stroke:#d33,stroke-width:2px
```

---

**Reasoning**:
- The new `CHANNEL-CODE` field must be added to the transaction record definition (`TRNREC.cpy`), which is included by all programs that process transaction files.
- All batch, utility, and test programs that read, write, or generate transaction records (especially those referencing `TRNREC.cpy`) are directly impacted and must be updated to handle the new field.
- Reports and loaders that process transaction data must be updated to include the new field in their logic and outputs.
- Only these components are included as they have a **High** impact due to their direct dependency on the transaction record structure and file layouts. No unrelated programs are included. No extra files are added. All file paths are as per repository structure.

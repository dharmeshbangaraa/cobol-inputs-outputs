**Summary**:
User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 6 impacted components identified (**High impact only**)  
- High complexity change involving real-time data ingestion, DB2/VSAM updates, batch recalculation, CICS online refresh, and audit/error handling. Impacts core valuation, persistence, and display logic across batch, online, and database layers.

---

**Ranked Impact List**:

| Program File Path                               | Impact | Nature   | Affected Paragraphs/Sections                 | Dependency Path                                      |
|-------------------------------------------------|--------|----------|----------------------------------------------|------------------------------------------------------|
| src/programs/batch/BCHVAL00.cbl                 | High   | Direct   | 1000-INIT, 2000-INGEST-PRICE, 3000-REVALUE, 4000-UPDATE-POS, 5000-STORE-PNL | Entry point for batch valuation and price ingestion   |
| src/programs/online/CICSPRTF.cbl                | High   | Direct   | 1000-INIT, 2000-REFRESH-VAL, 3000-DISPLAY    | CICS screen for View Portfolio, triggers refresh     |
| src/programs/batch/HISTLD00.cbl                 | High   | Direct   | 1000-INIT, 2000-LOAD-HIST, 3000-COMMIT       | Loads historical price feed into VSAM PRICEHIST      |
| src/copybook/db2/PRICEDATA.cpy                  | High   | Direct   | PRICEDATA-RECORD, PRICEDATA-UPDATE           | DB2 table mapping for real-time price updates        |
| src/copybook/common/AUDITLOG.cpy                | High   | Direct   | AUDIT-ENTRY, AUDIT-ERROR                     | Used for error/audit logging on feed failures        |
| src/programs/common/AUDPROC.cbl                 | High   | Indirect | 2000-PROCESS-AUDIT, 3000-TERMINATE           | Called for audit logging from multiple programs      |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/BCHVAL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "1000-INIT",
          "2000-INGEST-PRICE",
          "3000-REVALUE",
          "4000-UPDATE-POS",
          "5000-STORE-PNL"
        ],
        "dependencyPath": ["BCHVAL00"],
        "rationale": "Main batch program for portfolio valuation; must ingest real-time prices, recalculate positions, and update DB2/VSAM."
      },
      {
        "programFilePath": "src/programs/online/CICSPRTF.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "1000-INIT",
          "2000-REFRESH-VAL",
          "3000-DISPLAY"
        ],
        "dependencyPath": ["CICSPRTF"],
        "rationale": "CICS online screen for portfolio view; must refresh and display updated valuations within 10 seconds."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "1000-INIT",
          "2000-LOAD-HIST",
          "3000-COMMIT"
        ],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads historical price ticks into VSAM PRICEHIST for backtesting and audit."
      },
      {
        "programFilePath": "src/copybook/db2/PRICEDATA.cpy",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "PRICEDATA-RECORD",
          "PRICEDATA-UPDATE"
        ],
        "dependencyPath": ["BCHVAL00", "PRICEDATA"],
        "rationale": "Defines DB2 table structure for real-time price data; must be updated to support new feed."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "AUDIT-ENTRY",
          "AUDIT-ERROR"
        ],
        "dependencyPath": ["BCHVAL00", "CICSPRTF", "AUDPROC", "AUDITLOG"],
        "rationale": "Audit log copybook; used for logging feed errors and stale data conditions."
      },
      {
        "programFilePath": "src/programs/common/AUDPROC.cbl",
        "impactScore": 0.91,
        "impactLevel": "High",
        "impactType": "Indirect",
        "affectedParagraphs": [
          "2000-PROCESS-AUDIT",
          "3000-TERMINATE"
        ],
        "dependencyPath": ["BCHVAL00", "AUDPROC"],
        "rationale": "Audit processing program; invoked for error and audit logging related to price feed and valuation."
      }
    ]
  }
}
```

---

**Visualization**:
```mermaid
graph TD
  BCHVAL00["src/programs/batch/BCHVAL00.cbl (High)"] --> PRICEDATA["src/copybook/db2/PRICEDATA.cpy (High)"]
  BCHVAL00 --> HISTLD00["src/programs/batch/HISTLD00.cbl (High)"]
  BCHVAL00 --> AUDITLOG["src/copybook/common/AUDITLOG.cpy (High)"]
  BCHVAL00 --> AUDPROC["src/programs/common/AUDPROC.cbl (High)"]
  CICSPRTF["src/programs/online/CICSPRTF.cbl (High)"] --> AUDITLOG
  HISTLD00 --> PRICEDATA
  BCHVAL00 --> CICSPRTF
  AUDPROC --> AUDITLOG
```

---

**Notes:**
- Only files present in the repository and directly/indirectly impacted by the user story are included.
- Impact scores reflect proximity to the change, business criticality, and dependency depth.
- All components listed are essential for implementing real-time price ingestion, valuation, online refresh, and audit/error handling as per the user story and acceptance criteria.


**Summary**:

User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 6 impacted components identified (**High impact only**)  
- High complexity change affecting data ingestion, valuation, online display, error handling/audit, and performance-critical batch and CICS components.

---

**Ranked Impact List**:

| Program File Path                                 | Impact | Nature  | Affected Paragraphs/Sections                  | Dependency Path                                   |
|---------------------------------------------------|--------|---------|-----------------------------------------------|---------------------------------------------------|
| `src/programs/batch/HISTLD00.cbl`                 | High   | Direct  | 0000-MAIN, 2300-CHECK-COMMIT, 2310-UPDATE-CHECKPOINT | HISTLD00 (historical price persistence, VSAM/DB2) |
| `src/programs/batch/RPTPOS00.cbl`                 | High   | Direct  | 1100-OPEN-FILES, 2000-PROCESS-REPORT, 2110-FORMAT-POSITION | RPTPOS00 (portfolio valuation reporting)           |
| `src/programs/batch/BCHCTL00.cbl`                 | High   | Direct  | 1000-PROCESS-INITIALIZE, 3000-UPDATE-STATUS   | BCHCTL00 (batch control for valuation jobs)        |
| `src/programs/common/AUDPROC.cbl`                 | High   | Direct  | 2000-PROCESS-AUDIT, 3000-TERMINATE            | AUDPROC (audit logging for feed errors/alarms)     |
| `src/copybook/common/AUDITLOG.cpy`                | High   | Direct  | AUDITLOG record definitions                   | Used by AUDPROC, RPTAUD00, error handling         |
| `src/copybook/common/POSREC.cpy`                  | High   | Direct  | POSREC structure                              | Used by valuation, reporting, and batch updates    |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["0000-MAIN", "2300-CHECK-COMMIT", "2310-UPDATE-CHECKPOINT"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Handles historical price feed persistence (VSAM/DB2), directly implements new PRICEHIST requirements and batch ingestion."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2000-PROCESS-REPORT", "2110-FORMAT-POSITION"],
        "dependencyPath": ["RPTPOS00"],
        "rationale": "Portfolio valuation reporting; must process and display up-to-date market values from real-time feed."
      },
      {
        "programFilePath": "src/programs/batch/BCHCTL00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-PROCESS-INITIALIZE", "3000-UPDATE-STATUS"],
        "dependencyPath": ["BCHCTL00"],
        "rationale": "Batch control logic for valuation and update jobs; orchestrates recalculation and status updates on price feed."
      },
      {
        "programFilePath": "src/programs/common/AUDPROC.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-AUDIT", "3000-TERMINATE"],
        "dependencyPath": ["AUDPROC"],
        "rationale": "Processes audit log entries for feed failures, stale prices, and UDF-level alarms as required by error handling criteria."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["AUDITLOG record definitions"],
        "dependencyPath": ["AUDPROC", "RPTAUD00"],
        "rationale": "Defines the audit log structure for error and event logging; critical for new audit requirements."
      },
      {
        "programFilePath": "src/copybook/common/POSREC.cpy",
        "impactScore": 0.94,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["POSREC structure"],
        "dependencyPath": ["RPTPOS00", "UTLVAL00"],
        "rationale": "Defines position record structure; used in valuation and reporting, must support new real-time value fields."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  HISTLD00["src/programs/batch/HISTLD00.cbl (High)"]:::high
  RPTPOS00["src/programs/batch/RPTPOS00.cbl (High)"]:::high
  BCHCTL00["src/programs/batch/BCHCTL00.cbl (High)"]:::high
  AUDPROC["src/programs/common/AUDPROC.cbl (High)"]:::high
  AUDITLOG["src/copybook/common/AUDITLOG.cpy (High)"]:::high
  POSREC["src/copybook/common/POSREC.cpy (High)"]:::high

  HISTLD00 --> POSREC
  RPTPOS00 --> POSREC
  BCHCTL00 --> POSREC
  AUDPROC --> AUDITLOG
  RPTPOS00 --> BCHCTL00
  BCHCTL00 --> HISTLD00
  AUDPROC --> HISTLD00

  classDef high fill:#ffcccc,stroke:#d00,stroke-width:2px;
```

---

**Notes**:

- Only components with a **High** impact score are included.
- All file paths are verified to exist in the repository.
- No unrelated or non-existent files are listed.
- The analysis focuses on direct and critical dependencies for the new real-time market price feed, valuation, audit, and reporting features as described in the user story and acceptance criteria.

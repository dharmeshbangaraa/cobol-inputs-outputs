Impact Analysis Report

---

**Summary**:
User Story: Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.  
- 3 impacted components identified (**High impact only**)  
- High complexity change affecting core P&L calculation and all downstream batch reporting outputs

---

**Ranked Impact List**:

| Program File Path                        | Impact | Nature  | Affected Paragraphs/Sections                | Dependency Path                        |
|------------------------------------------|--------|---------|---------------------------------------------|----------------------------------------|
| `src/programs/batch/PNL-CALC-PROG.cbl`   | High   | Direct  | PNL-CALC-MAIN, CALC-PNL, MOVE-TO-OUTPUT    | PNL-CALC-PROG                          |
| `src/programs/batch/RPTPOS00.cbl`        | High   | Direct  | 2000-PROCESS-REPORT, 2110-FORMAT-POSITION, 2300-WRITE-SUMMARY | RPTPOS00                               |
| `src/programs/batch/RPTAUD00.cbl`        | High   | Direct  | 2000-PROCESS-REPORT, 2100-PROCESS-AUDIT-TRAIL, 2300-WRITE-SUMMARY | RPTAUD00                               |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/PNL-CALC-PROG.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["PNL-CALC-MAIN", "CALC-PNL", "MOVE-TO-OUTPUT"],
        "dependencyPath": ["PNL-CALC-PROG"],
        "rationale": "This is the core program responsible for P&L calculation logic. All rounding logic must be updated here to ensure consistency."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-REPORT", "2110-FORMAT-POSITION", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["RPTPOS00"],
        "rationale": "Batch report program that outputs P&L values in TXT and CSV. Must ensure displayed values are rounded as per new logic."
      },
      {
        "programFilePath": "src/programs/batch/RPTAUD00.cbl",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-REPORT", "2100-PROCESS-AUDIT-TRAIL", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["RPTAUD00"],
        "rationale": "Audit report program that displays P&L values. Needs update to ensure all reported values are rounded consistently."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    subgraph Batch Processing & Reporting
        PNL[PNL-CALC-PROG.cbl]:::high
        POS[RPTPOS00.cbl]:::high
        AUD[RPTAUD00.cbl]:::high
    end

    PNL --> POS
    PNL --> AUD

    classDef high fill:#ff6666,stroke:#b22222,stroke-width:2px;
    class PNL,POS,AUD high;
```

---

**Reasoning**:
- `PNL-CALC-PROG.cbl` is the central calculation engine for P&L and is directly responsible for the arithmetic and rounding logic. Any change to rounding must be implemented here.
- `RPTPOS00.cbl` and `RPTAUD00.cbl` are the main batch reporting programs that output P&L values to TXT and CSV. They must be updated to ensure that all displayed values use the new rounding logic, and to verify that no additional formatting or post-processing introduces discrepancies.
- No indirect dependencies or copybooks were found to have a high impact for this specific rounding change, as the calculation and reporting are tightly coupled to these three programs.

**Total High Impact Components**: 3  
**Change Complexity**: High (core arithmetic logic and all downstream reporting outputs must be updated and tested for consistency)

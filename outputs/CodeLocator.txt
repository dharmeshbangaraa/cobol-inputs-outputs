Impact Analysis Report

----------

**Summary**:
User Story: Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.

- 3 impacted components identified (**High impact only**)
- High complexity change: Directly affects core P&L calculation logic and all downstream batch reporting of P&L, requiring coordinated updates to calculation, formatting, and output routines.

---

**Ranked Impact List**:

| Program File Path                        | Impact | Nature  | Affected Paragraphs/Sections         | Dependency Path                        |
|------------------------------------------|--------|---------|--------------------------------------|----------------------------------------|
| `src/programs/batch/PNL-CALC-PROG.cbl`   | High   | Direct  | All calculation paragraphs handling P&L, especially those moving WORK-DIVIDE to output fields | Entry point for P&L calculation logic  |
| `src/programs/batch/RPTPOS00.cbl`        | High   | Direct  | 2110-FORMAT-POSITION, 2300-WRITE-SUMMARY, 1200-WRITE-HEADERS | Consumes P&L values from calculation, formats and outputs to TXT/CSV         |
| `src/programs/batch/RPTAUD00.cbl`        | High   | Direct  | 2100-PROCESS-AUDIT-TRAIL, 2300-WRITE-SUMMARY, 1200-WRITE-HEADERS | Consumes P&L values from calculation, formats and outputs to TXT/CSV         |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/PNL-CALC-PROG.cbl",
        "impactScore": 0.99,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["All calculation paragraphs handling P&L, especially those moving WORK-DIVIDE to output fields"],
        "dependencyPath": ["PNL-CALC-PROG"],
        "rationale": "This is the core calculation program for P&L. All rounding logic must be updated here to ensure consistent two-decimal rounding before values are passed to reporting modules."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2110-FORMAT-POSITION", "2300-WRITE-SUMMARY", "1200-WRITE-HEADERS"],
        "dependencyPath": ["PNL-CALC-PROG", "RPTPOS00"],
        "rationale": "Batch report for positions; directly displays P&L values. Formatting and output routines must ensure rounded values are used in TXT and CSV outputs."
      },
      {
        "programFilePath": "src/programs/batch/RPTAUD00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2100-PROCESS-AUDIT-TRAIL", "2300-WRITE-SUMMARY", "1200-WRITE-HEADERS"],
        "dependencyPath": ["PNL-CALC-PROG", "RPTAUD00"],
        "rationale": "Batch audit report; directly displays P&L values. Formatting and output routines must ensure rounded values are used in TXT and CSV outputs."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    subgraph Calculation
        A[src/programs/batch/PNL-CALC-PROG.cbl]
    end
    subgraph Reporting
        B[src/programs/batch/RPTPOS00.cbl]
        C[src/programs/batch/RPTAUD00.cbl]
    end
    A -- High Impact --> B
    A -- High Impact --> C
    style A fill:#ffcccc,stroke:#d33,stroke-width:2px
    style B fill:#ffcccc,stroke:#d33,stroke-width:2px
    style C fill:#ffcccc,stroke:#d33,stroke-width:2px
```

---

**Reasoning**:
- The user story and acceptance criteria explicitly call for changes to the P&L calculation logic (requiring ROUNDED in arithmetic operations) and to the batch reporting modules that output P&L values.
- `PNL-CALC-PROG.cbl` is the central calculation program; any change to rounding must be implemented here to ensure all downstream consumers receive correctly rounded values.
- `RPTPOS00.cbl` and `RPTAUD00.cbl` are the only batch reporting programs specified in the acceptance criteria. Both directly consume and display P&L values, so their formatting/output logic must be verified and potentially updated to ensure no further rounding discrepancies occur in TXT and CSV outputs.
- No indirect or copybook-only dependencies are included, as the focus is strictly on high-impact, directly affected modules per the user story and acceptance criteria.

User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 6 impacted components identified (**High impact only**)  
- High complexity change affecting data ingestion, valuation logic, online display, audit logging, and historical price storage.  
- Changes span batch, online (CICS), DB2, and copybook layers, with critical impact on performance and business correctness.

---

**Ranked Impact List**:

| Program File Path                                 | Impact | Nature  | Affected Paragraphs/Sections           | Dependency Path                          |
|---------------------------------------------------|--------|---------|----------------------------------------|------------------------------------------|
| `src/programs/batch/POSVAL00.cbl`                | High   | Direct  | 2000-APPLY-PRICE-UPDATE, 2100-RECALC-POSITION, 2200-UPDATE-PNL | Entry point for batch position valuation and P&L update |
| `src/programs/online/PORTDISP.cbl`               | High   | Direct  | 1000-REFRESH-DISPLAY, 1100-GET-PORTFOLIO-VALUES | CICS screen for “View Portfolio” auto-refresh |
| `src/programs/batch/HISTLD00.cbl`                | High   | Direct  | 2000-PROCESS-HISTORICAL, 2100-STORE-PRICE-HIST | Loads historical price feeds into VSAM PRICEHIST |
| `src/copybook/common/POSREC.cpy`                 | High   | Direct  | POS-RECORD, PNL-FIELDS, TIMESTAMP-FIELD | Shared structure for position & P&L, used by valuation and reporting |
| `src/copybook/common/AUDITLOG.cpy`               | High   | Direct  | AUDIT-ENTRY, ERROR-LOGGING             | Used for audit trail and error logging on stale/failure |
| `src/programs/common/AUDPROC.cbl`                | High   | Indirect| 2000-PROCESS-AUDIT, 3000-TERMINATE     | Called for writing audit entries on feed errors |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/POSVAL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-APPLY-PRICE-UPDATE", "2100-RECALC-POSITION", "2200-UPDATE-PNL"],
        "dependencyPath": ["POSVAL00"],
        "rationale": "Batch program recalculates position values and P&L on each price update; core of valuation logic."
      },
      {
        "programFilePath": "src/programs/online/PORTDISP.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-REFRESH-DISPLAY", "1100-GET-PORTFOLIO-VALUES"],
        "dependencyPath": ["PORTDISP"],
        "rationale": "CICS online display for 'View Portfolio' must refresh with new valuations within 10 seconds."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-PROCESS-HISTORICAL", "2100-STORE-PRICE-HIST"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads and persists historical price feeds into new VSAM KSDS PRICEHIST for backtesting."
      },
      {
        "programFilePath": "src/copybook/common/POSREC.cpy",
        "impactScore": 0.94,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["POS-RECORD", "PNL-FIELDS", "TIMESTAMP-FIELD"],
        "dependencyPath": ["POSVAL00", "PORTDISP", "RPTPOS00", "UTLVAL00"],
        "rationale": "Core data structure for position and P&L, must be updated for new fields (timestamp, real-time value)."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["AUDIT-ENTRY", "ERROR-LOGGING"],
        "dependencyPath": ["AUDPROC", "RPTAUD00"],
        "rationale": "Audit log structure for recording feed failures, stale prices, and alarms."
      },
      {
        "programFilePath": "src/programs/common/AUDPROC.cbl",
        "impactScore": 0.91,
        "impactLevel": "High",
        "impactType": "Indirect",
        "affectedParagraphs": ["2000-PROCESS-AUDIT", "3000-TERMINATE"],
        "dependencyPath": ["POSVAL00", "AUDPROC"],
        "rationale": "Called to write audit entries when feed fails or prices are stale, ensuring compliance with error handling."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  POSVAL00["src/programs/batch/POSVAL00.cbl\n(High)"]
  PORTDISP["src/programs/online/PORTDISP.cbl\n(High)"]
  HISTLD00["src/programs/batch/HISTLD00.cbl\n(High)"]
  POSREC["src/copybook/common/POSREC.cpy\n(High)"]
  AUDITLOG["src/copybook/common/AUDITLOG.cpy\n(High)"]
  AUDPROC["src/programs/common/AUDPROC.cbl\n(High)"]

  POSVAL00 -- uses --> POSREC
  POSVAL00 -- calls --> AUDPROC
  POSVAL00 -- writes --> HISTLD00
  PORTDISP -- uses --> POSREC
  HISTLD00 -- uses --> POSREC
  HISTLD00 -- uses --> AUDITLOG
  AUDPROC -- uses --> AUDITLOG
```

---

**Notes**:
- Only files present in the repository are listed.
- All listed components are **High impact** due to their direct involvement in real-time valuation, display, audit, or data structure changes.
- No unrelated or non-existent files are included.
- JCL files are not listed as high impact unless they orchestrate the above programs directly for this feature (none identified as such in the dependency map for this user story).

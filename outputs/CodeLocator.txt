
---

**Summary**:

User Story: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting

- **Total impacted components (High impact only): 5**
- **High-level assessment:** This is a high-complexity, cross-cutting change affecting the core transaction data structure, file layouts, batch processing, reporting, and all programs that read/write or report on transaction data. It requires coordinated updates to copybooks, batch programs, validation utilities, and reporting modules.

---

**Ranked Impact List**:

| Program File Path                                 | Impact | Nature  | Affected Paragraphs/Sections                | Dependency Path                                  |
|---------------------------------------------------|--------|---------|---------------------------------------------|--------------------------------------------------|
| src/copybook/common/TRNREC.cpy                    | High   | Direct  | CHANNEL-CODE field definition               | Used by all transaction-processing programs      |
| src/programs/batch/RPTPOS00.cbl                   | High   | Direct  | 1100-OPEN-FILES, 2200-PROCESS-TRANSACTIONS | Reads/writes transaction file via TRNREC         |
| src/programs/utility/UTLVAL00.cbl                 | High   | Direct  | 1100-OPEN-FILES, 2400-CHECK-FORMAT         | Validates transaction file via TRNREC            |
| src/programs/test/TSTGEN00.cbl                    | High   | Direct  | 2300-GEN-TRANSACTION, 2320-WRITE-TRAN-RECORD| Generates test transaction files                 |
| src/programs/test/TSTVAL00.cbl                    | High   | Direct  | 1100-OPEN-FILES, 2100-EXECUTE-TEST         | Reads test transaction files for validation      |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Add CHANNEL-CODE Field to Transaction File for Channel Identification in Batch Processing and Reporting",
    "impactedComponents": [
      {
        "programFilePath": "src/copybook/common/TRNREC.cpy",
        "impactScore": 0.99,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["CHANNEL-CODE field definition"],
        "dependencyPath": ["All programs using TRNREC"],
        "rationale": "Central copybook for transaction record structure; adding CHANNEL-CODE here propagates to all transaction-processing programs."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2200-PROCESS-TRANSACTIONS"],
        "dependencyPath": ["RPTPOS00", "TRNREC"],
        "rationale": "Batch report program that reads/writes transaction files and outputs transaction details; must include CHANNEL-CODE in reports."
      },
      {
        "programFilePath": "src/programs/utility/UTLVAL00.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2400-CHECK-FORMAT"],
        "dependencyPath": ["UTLVAL00", "TRNREC"],
        "rationale": "Utility program for validating transaction file structure and content; must validate new CHANNEL-CODE field."
      },
      {
        "programFilePath": "src/programs/test/TSTGEN00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2300-GEN-TRANSACTION", "2320-WRITE-TRAN-RECORD"],
        "dependencyPath": ["TSTGEN00", "TRNREC"],
        "rationale": "Test data generator for transaction files; must generate valid CHANNEL-CODE values in test records."
      },
      {
        "programFilePath": "src/programs/test/TSTVAL00.cbl",
        "impactScore": 0.94,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2100-EXECUTE-TEST"],
        "dependencyPath": ["TSTVAL00", "TRNREC"],
        "rationale": "Test validation program that reads test transaction files and validates content; must validate new CHANNEL-CODE field."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    A[src/copybook/common/TRNREC.cpy]:::highimpact
    B[src/programs/batch/RPTPOS00.cbl]:::highimpact
    C[src/programs/utility/UTLVAL00.cbl]:::highimpact
    D[src/programs/test/TSTGEN00.cbl]:::highimpact
    E[src/programs/test/TSTVAL00.cbl]:::highimpact

    B --> A
    C --> A
    D --> A
    E --> A

    classDef highimpact fill:#ffcccc,stroke:#b22222,stroke-width:2px;
```

---

**Key Notes**:

- Only files present in the repository and directly impacted by the user story are included.
- All listed programs either directly define, read, write, validate, or report on the transaction file structure, and thus must be updated to handle the new `CHANNEL-CODE` field.
- The central copybook (`TRNREC.cpy`) is the primary propagation point for this change.
- No unrelated or non-existent files are included; all paths are as per the repository structure.

User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 6 impacted components identified (**High impact only**)  
- High complexity: Touches real-time data ingestion, valuation engine, CICS online display, error/audit handling, and new historical price persistence. Impacts both batch and online COBOL programs, JCL, and copybooks.

---

**Ranked Impact List**:

| Program File Path                             | Impact | Nature  | Affected Paragraphs/Sections         | Dependency Path                                            |
|-----------------------------------------------|--------|---------|--------------------------------------|------------------------------------------------------------|
| src/programs/batch/BCHVAL00.cbl              | High   | Direct  | 1000-INIT, 2000-INGEST, 3000-REVAL   | Entry point for batch valuation, receives price feed        |
| src/programs/online/CICSPF00.cbl             | High   | Direct  | 1100-REFRESH, 2100-DISPLAY           | CICS "View Portfolio" screen, refreshes on price update    |
| src/programs/batch/HISTLD00.cbl              | High   | Direct  | 1000-LOAD, 2000-STORE-HIST           | Loads/persists historical prices to VSAM PRICEHIST         |
| src/copybook/common/POSREC.cpy               | High   | Direct  | POS-RECORD, PNL-FIELDS               | Shared position record structure, updated with new fields   |
| src/copybook/common/AUDITLOG.cpy             | High   | Direct  | AUDIT-ENTRY, ERROR-LOG               | Used for error/audit logging on stale feed or failure       |
| JCL/BCHVAL00.jcl                             | High   | Direct  | N/A                                  | Batch job JCL for valuation engine, triggers on price feed  |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/BCHVAL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-INIT", "2000-INGEST", "3000-REVAL"],
        "dependencyPath": ["BCHVAL00"],
        "rationale": "Core batch program for portfolio valuation; must consume real-time price feed, recalculate positions, and update P&L."
      },
      {
        "programFilePath": "src/programs/online/CICSPF00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-REFRESH", "2100-DISPLAY"],
        "dependencyPath": ["CICSPF00"],
        "rationale": "CICS online program for 'View Portfolio'; must refresh display within 10 seconds of price update."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-LOAD", "2000-STORE-HIST"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads and persists historical price feeds into new VSAM KSDS PRICEHIST for backtesting."
      },
      {
        "programFilePath": "src/copybook/common/POSREC.cpy",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["POS-RECORD", "PNL-FIELDS"],
        "dependencyPath": ["BCHVAL00", "CICSPF00", "POSREC.cpy"],
        "rationale": "Position record structure used across valuation and display; requires new fields for real-time price and timestamp."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["AUDIT-ENTRY", "ERROR-LOG"],
        "dependencyPath": ["BCHVAL00", "HISTLD00", "AUDITLOG.cpy"],
        "rationale": "Audit log copybook for error handling and logging stale/failure events as per acceptance criteria."
      },
      {
        "programFilePath": "JCL/BCHVAL00.jcl",
        "impactScore": 0.90,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["BCHVAL00.jcl"],
        "rationale": "JCL for batch valuation job; must be updated for new scheduling and throughput requirements."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  A[src/programs/batch/BCHVAL00.cbl]:::high
  B[src/programs/online/CICSPF00.cbl]:::high
  C[src/programs/batch/HISTLD00.cbl]:::high
  D[src/copybook/common/POSREC.cpy]:::high
  E[src/copybook/common/AUDITLOG.cpy]:::high
  F[JCL/BCHVAL00.jcl]:::high

  A --> D
  B --> D
  A --> E
  C --> E
  F --> A
  C --> D

  classDef high fill:#ff6666,stroke:#333,stroke-width:2px;
```

---

**Notes on Reasoning**:
- **BCHVAL00.cbl**: Central to batch valuation, directly consumes the feed, recalculates, and persists results.
- **CICSPF00.cbl**: The CICS online program for portfolio display, must now refresh based on new feed.
- **HISTLD00.cbl**: Handles historical price persistence, required for backtesting.
- **POSREC.cpy**: Shared copybook for position records, must be extended for new fields (real-time price, timestamp, P&L).
- **AUDITLOG.cpy**: Used for error/audit logging, required for new error handling requirements.
- **BCHVAL00.jcl**: Batch job control, must be updated for new performance and scheduling requirements.

**No extra files were added; all paths are from the actual repository. Only high-impact components are listed.**

## Summary

**User Story:**  
Title: Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.  
As an Operations Analyst, I want all P&L values to be rounded consistently to two decimal places so that financial reports and statements match downstream accounting systems exactly.

**Acceptance Criteria:**
1. Update COBOL arithmetic in PNL-CALC-PROG (or relevant copybook routines) to use ROUNDED when moving computed P&L from WORK-DIVIDE fields to output fields.
2. Verify that batch reports (RPTPOS00 and RPTAUD00) display P&L amounts correctly rounded in both TXT and CSV outputs.

**Total impacted components:** 5  
**High-level assessment:**  
This is a medium-complexity change. It directly affects the core P&L calculation logic and the batch reporting modules, with indirect impact on shared copybooks and data structures. The change is isolated to batch and reporting modules, minimizing risk to online and unrelated batch processes.

---

## Ranked Impact List

| Program/Copybook      | Impact  | Nature   | Affected Paragraphs/Sections           | Dependency Path                        |
|-----------------------|---------|----------|----------------------------------------|----------------------------------------|
| PNL-CALC-PROG         | High    | Direct   | PNL-CALC-LOGIC, MOVE-TO-OUTPUT         | [PNL-CALC-PROG]                        |
| RPTPOS00              | High    | Direct   | 2100-READ-POSITIONS, 2110-FORMAT-POSITION, 2300-WRITE-SUMMARY | [RPTPOS00]                             |
| RPTAUD00              | High    | Direct   | 2100-PROCESS-AUDIT-TRAIL, 2300-WRITE-SUMMARY | [RPTAUD00]                             |
| POSREC (copybook)     | Medium  | Indirect | P&L fields definition                  | [RPTPOS00, POSREC]                     |
| AUDITLOG (copybook)   | Medium  | Indirect | P&L fields definition                  | [RPTAUD00, AUDITLOG]                   |

---

## JSON Metadata

```json
{
  "impactAnalysis": {
    "userStory": "Fix rounding discrepancies in portfolio P&L calculation in Batch Processing and Reporting modules only.",
    "impactedComponents": [
      {
        "programName": "PNL-CALC-PROG",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["PNL-CALC-LOGIC", "MOVE-TO-OUTPUT"],
        "dependencyPath": ["PNL-CALC-PROG"],
        "rationale": "Core calculation logic for P&L; must ensure ROUNDED is used when moving computed values to output fields."
      },
      {
        "programName": "RPTPOS00",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2100-READ-POSITIONS", "2110-FORMAT-POSITION", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["RPTPOS00"],
        "rationale": "Batch report program displaying P&L; must ensure output is rounded in TXT and CSV formats."
      },
      {
        "programName": "RPTAUD00",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2100-PROCESS-AUDIT-TRAIL", "2300-WRITE-SUMMARY"],
        "dependencyPath": ["RPTAUD00"],
        "rationale": "Batch audit report program displaying P&L; must ensure output is rounded in TXT and CSV formats."
      },
      {
        "programName": "POSREC",
        "impactScore": 0.75,
        "impactLevel": "Medium",
        "impactType": "Indirect",
        "affectedParagraphs": ["P&L fields definition"],
        "dependencyPath": ["RPTPOS00", "POSREC"],
        "rationale": "Copybook defining P&L fields used in RPTPOS00; changes may be needed if field definitions or rounding logic is centralized."
      },
      {
        "programName": "AUDITLOG",
        "impactScore": 0.70,
        "impactLevel": "Medium",
        "impactType": "Indirect",
        "affectedParagraphs": ["P&L fields definition"],
        "dependencyPath": ["RPTAUD00", "AUDITLOG"],
        "rationale": "Copybook defining P&L fields used in RPTAUD00; changes may be needed if field definitions or rounding logic is centralized."
      }
    ]
  }
}
```

---

## Visualization

```mermaid
graph TD
  subgraph High Impact
    PNL-CALC-PROG
    RPTPOS00
    RPTAUD00
  end
  subgraph Medium Impact
    POSREC
    AUDITLOG
  end

  PNL-CALC-PROG -- supplies P&L --> RPTPOS00
  PNL-CALC-PROG -- supplies P&L --> RPTAUD00
  RPTPOS00 -- uses fields --> POSREC
  RPTAUD00 -- uses fields --> AUDITLOG
```

- **Red (High Impact):** PNL-CALC-PROG, RPTPOS00, RPTAUD00  
- **Orange (Medium Impact):** POSREC, AUDITLOG

---

### Reasoning

- **PNL-CALC-PROG** is the core calculation routine for P&L, directly responsible for the arithmetic and the use of ROUNDED.
- **RPTPOS00** and **RPTAUD00** are the batch reporting programs that output P&L values; both must display rounded values in all formats.
- **POSREC** and **AUDITLOG** are copybooks included in the reporting programs, likely defining the P&L fields. If rounding logic or field definitions are centralized here, they must be reviewed and possibly updated.
- No unrelated batch, online, or utility programs are impacted, as per the user story and dependency map.

---

**End of Impact Analysis Report**

**Summary**:

User Story: Integrate real-time market price feed for dynamic portfolio valuation  
- 6 impacted components identified (**High impact only**)  
- High complexity: Touches core batch valuation, online display, error/audit, and new data persistence logic. Impacts batch, CICS, copybooks, and JCL for end-to-end real-time valuation.

---

**Ranked Impact List**:

| Program File Path                               | Impact | Nature   | Affected Paragraphs/Sections         | Dependency Path                                  |
|-------------------------------------------------|--------|----------|--------------------------------------|--------------------------------------------------|
| src/programs/batch/BCHVAL00.cbl                 | High   | Direct   | 2000-UPDATE-VALUATIONS, 2100-PRICE-INGEST, 2200-RECALC-POSITIONS | Real-time price ingestion and valuation engine   |
| src/programs/online/CICSPRTF.cbl                | High   | Direct   | 1000-REFRESH-SCREEN, 1100-GET-PORTFOLIO | CICS "View Portfolio" screen, auto-refresh logic |
| src/copybook/common/POSREC.cpy                  | High   | Direct   | POS-RECORD, POS-CURRENT-VALUE, POS-PNL | Shared position/P&L structure updated by batch/CICS |
| src/copybook/common/AUDITLOG.cpy                | High   | Direct   | AUDIT-ENTRY, AUDIT-TIMESTAMP         | Used for error/audit logging on stale/failure    |
| src/programs/batch/HISTLD00.cbl                 | High   | Direct   | 2100-LOAD-PRICE-HISTORY, 2200-ARCHIVE | Loads historical price feed to VSAM PRICEHIST    |
| JCL/PORTVAL.jcl                                 | High   | Direct   | N/A (Job steps: BCHVAL00, HISTLD00)  | Batch job orchestration for valuation and history|

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Integrate real-time market price feed for dynamic portfolio valuation",
    "impactedComponents": [
      {
        "programFilePath": "src/programs/batch/BCHVAL00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2000-UPDATE-VALUATIONS", "2100-PRICE-INGEST", "2200-RECALC-POSITIONS"],
        "dependencyPath": ["BCHVAL00"],
        "rationale": "Central batch program for portfolio valuation; must consume real-time prices, recalculate positions and P&L, and update records every 5 seconds."
      },
      {
        "programFilePath": "src/programs/online/CICSPRTF.cbl",
        "impactScore": 0.96,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1000-REFRESH-SCREEN", "1100-GET-PORTFOLIO"],
        "dependencyPath": ["CICSPRTF"],
        "rationale": "CICS online program for 'View Portfolio' screen; requires logic to auto-refresh with current valuations within 10 seconds of price update."
      },
      {
        "programFilePath": "src/copybook/common/POSREC.cpy",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["POS-RECORD", "POS-CURRENT-VALUE", "POS-PNL"],
        "dependencyPath": ["BCHVAL00", "CICSPRTF", "POSREC.cpy"],
        "rationale": "Position record structure is updated with new fields (current value, P&L, timestamp) and is shared by batch and online programs."
      },
      {
        "programFilePath": "src/copybook/common/AUDITLOG.cpy",
        "impactScore": 0.93,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["AUDIT-ENTRY", "AUDIT-TIMESTAMP"],
        "dependencyPath": ["BCHVAL00", "CICSPRTF", "AUDITLOG.cpy"],
        "rationale": "Used for error handling and audit logging when feed fails or prices are stale; required by both batch and online for UDF-level alarms."
      },
      {
        "programFilePath": "src/programs/batch/HISTLD00.cbl",
        "impactScore": 0.92,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["2100-LOAD-PRICE-HISTORY", "2200-ARCHIVE"],
        "dependencyPath": ["HISTLD00"],
        "rationale": "Loads and persists historical price feeds into new VSAM KSDS PRICEHIST for backtesting; new logic required for real-time ingestion."
      },
      {
        "programFilePath": "JCL/PORTVAL.jcl",
        "impactScore": 0.90,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [],
        "dependencyPath": ["PORTVAL.jcl", "BCHVAL00", "HISTLD00"],
        "rationale": "JCL orchestrates the batch valuation and history load jobs; must be updated to support new frequency, error handling, and throughput."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
  A[src/programs/batch/BCHVAL00.cbl]:::high --> B[src/copybook/common/POSREC.cpy]:::high
  A --> C[src/copybook/common/AUDITLOG.cpy]:::high
  A --> D[src/programs/batch/HISTLD00.cbl]:::high
  E[src/programs/online/CICSPRTF.cbl]:::high --> B
  E --> C
  F[JCL/PORTVAL.jcl]:::high --> A
  F --> D

  classDef high fill:#ffcccc,stroke:#d00,stroke-width:2px;
```

---

**Notes**:
- Only **existing files** in the repository are included.
- All components listed are **High impact**â€”they are either directly responsible for real-time price ingestion, portfolio valuation, online display, audit/error handling, or batch orchestration.
- Copybooks are included where they are directly modified or referenced by multiple high-impact programs.
- JCL included only if it orchestrates or triggers the impacted batch jobs.


Current Task: As a Developer Assistant Agent, your task is to facilitate the process of checking in code to GitHub repositories. Follow these instructions to ensure the task is completed accurately:
INSTRUCTIONS:
1. STRICTLY take the output from the previous Agentic AI ONLY (Ignore the Impact Analysis Report).
2. Call the 'Cobol_GitHub Code Check-In Tool' with the extracted inputs to perform the code check-in.
3. Handle any errors or exceptions that may arise during the process, such as authentication failures or invalid repository details.
4. STRICTLY write the content from the previous agent to this file in the GitHub: https://github.com/dharmeshbangaraa/cobol-inputs-outputs/outputs/CobolCodeModifier.txt
5. Don't change any other files.


You have access to the the tool 'GitHubCodeCheckInTool'. It is advised to use this tool when you have access to it irrespective of whether it has been asked to be used explicitly.

This is the expected criteria for your final answer: A JSON response like this:
{
"outputUrl": "https://github.com/dharmeshbangaraa/cobol-inputs-outputs/tree/master/outputs"
}
you MUST return the actual complete content as the final answer, not a summary.

This is the context you're working with:
**outputs/CodeLocator.txt**
**Summary**:
User Story: Add `CHANNEL-CODE` Field to Transaction File for Channel Identification in Batch Processing and Reporting

- 3 high-impact components identified (COBOL programs and copybooks directly handling transaction file structure and processing)
- High complexity: Change affects transaction data structure, file layouts, batch processing, reporting, and all programs that read/write transaction records.

---

**Ranked Impact List**:

| Program File Path                           | Impact | Nature  | Affected Paragraphs/Sections           | Dependency Path                                 |
|---------------------------------------------|--------|---------|----------------------------------------|-------------------------------------------------|
| src/copybook/common/TRNREC.cpy              | High   | Direct  | All (copybook structure)               | Used by all transaction-processing programs     |
| src/programs/batch/RPTPOS00.cbl             | High   | Direct  | 1100-OPEN-FILES, 2200-PROCESS-TRANSACTIONS | Reads/writes transaction file, includes TRNREC  |
| src/programs/utility/UTLVAL00.cbl           | High   | Direct  | 1100-OPEN-FILES, 2400-CHECK-FORMAT    | Reads/writes transaction file, includes TRNREC  |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Add CHANNEL-CODE Field to Transaction File for Channel Identification in Batch Processing and Reporting",
    "impactedComponents": [
      {
        "programFilePath": "src/copybook/common/TRNREC.cpy",
        "impactScore": 1.0,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["COPYBOOK STRUCTURE"],
        "dependencyPath": ["TRNREC.cpy"],
        "rationale": "Primary copybook for transaction record structure; adding CHANNEL-CODE here propagates to all programs using transaction data."
      },
      {
        "programFilePath": "src/programs/batch/RPTPOS00.cbl",
        "impactScore": 0.98,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2200-PROCESS-TRANSACTIONS"],
        "dependencyPath": ["RPTPOS00.cbl", "TRNREC.cpy"],
        "rationale": "Batch report program that reads transaction file and outputs reports; must be updated for new CHANNEL-CODE field in layout and logic."
      },
      {
        "programFilePath": "src/programs/utility/UTLVAL00.cbl",
        "impactScore": 0.97,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["1100-OPEN-FILES", "2400-CHECK-FORMAT"],
        "dependencyPath": ["UTLVAL00.cbl", "TRNREC.cpy"],
        "rationale": "Utility validation program that reads/writes transaction data; must be updated for new field in file definition and validation logic."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    subgraph High Impact
        A[src/copybook/common/TRNREC.cpy]:::high
        B[src/programs/batch/RPTPOS00.cbl]:::high
        C[src/programs/utility/UTLVAL00.cbl]:::high
    end

    B --> A
    C --> A

    classDef high fill:#ffcccc,stroke:#d33,stroke-width:2px;
```

---

**Reasoning**:

- `src/copybook/common/TRNREC.cpy` is the central copybook defining the transaction record. Adding `CHANNEL-CODE` here is the root change that propagates to all programs using transaction data.
- `src/programs/batch/RPTPOS00.cbl` is a batch reporting program that reads transaction files using the TRNREC copybook and outputs transaction reports. It must be updated to handle the new field in both file layout and reporting logic.
- `src/programs/utility/UTLVAL00.cbl` is a utility program that validates transaction data, also using the TRNREC copybook. It must be updated for the new field in file definitions, LRECL, and validation logic.
- Other programs and copybooks were analyzed but did not meet the high-impact threshold for direct transaction file handling or were not directly related to the transaction data structure.

**Note:** JCL files invoking these programs would require updates to LRECL and file definitions, but the highest direct impact is on the COBOL and copybook components listed above.

----------

```
[File 1] TRNREC.CPY src/copybook/common/TRNREC.cpy

*****************************************************************
* TRANSACTION RECORD STRUCTURE
* VERSION: 1.0
* DATE: 2024
*****************************************************************
 01  TRANSACTION-RECORD.
     05  TRN-KEY.
         10  TRN-DATE           PIC X(08).
         10  TRN-TIME           PIC X(06).
         10  TRN-PORTFOLIO-ID   PIC X(08).
         10  TRN-SEQUENCE-NO    PIC X(06).
*-- Change: Added CHANNEL-CODE field for channel identification in batch processing and reporting
         10  TRN-CHANNEL-CODE   PIC X(04).
     05  TRN-DATA.
         10  TRN-INVESTMENT-ID  PIC X(10).
         10  TRN-TYPE           PIC X(02).
             88  TRN-TYPE-BUY     VALUE 'BU'.
             88  TRN-TYPE-SELL    VALUE 'SL'.
             88  TRN-TYPE-TRANS   VALUE 'TR'.
             88  TRN-TYPE-FEE     VALUE 'FE'.
         10  TRN-QUANTITY       PIC S9(11)V9(4) COMP-3.
         10  TRN-PRICE         PIC S9(11)V9(4) COMP-3.
         10  TRN-AMOUNT        PIC S9(13)V9(2) COMP-3.
         10  TRN-CURRENCY      PIC X(03).
         10  TRN-STATUS        PIC X(01).
             88  TRN-STATUS-PEND   VALUE 'P'.
             88  TRN-STATUS-DONE   VALUE 'D'.
             88  TRN-STATUS-FAIL   VALUE 'F'.
             88  TRN-STATUS-REV    VALUE 'R'.
     05  TRN-AUDIT.
         10  TRN-PROCESS-DATE  PIC X(26).
         10  TRN-PROCESS-USER  PIC X(08).
     05  TRN-FILLER           PIC X(50).
*****************************************************************
* FIELD DESCRIPTIONS:
* TRN-DATE        : TRANSACTION DATE (YYYYMMDD)
* TRN-TIME        : TRANSACTION TIME (HHMMSS)
* TRN-PORTFOLIO-ID: PORTFOLIO IDENTIFIER
* TRN-SEQUENCE-NO : SEQUENCE NUMBER FOR MULTIPLE TRANS
* TRN-CHANNEL-CODE: CHANNEL IDENTIFICATION CODE (NEW FIELD)
* TRN-TYPE        : BU=BUY, SL=SELL, TR=TRANSFER, FE=FEE
* TRN-STATUS      : P=PENDING, D=DONE, F=FAILED, R=REVERSED
*****************************************************************

[Summary Change Report]
- Added `TRN-CHANNEL-CODE PIC X(04)` to the transaction record structure after TRN-SEQUENCE-NO, as per the impact analysis for channel identification.
- Updated field descriptions to document the new field.

[File 2] RPTPOS00.CBL src/programs/batch/RPTPOS00.cbl

 IDENTIFICATION DIVISION.
 PROGRAM-ID. RPTPOS00.
 AUTHOR. CLAUDE.
 DATE-WRITTEN. 2024-04-09.
*****************************************************************
* Daily Position Report Generator                                 *
*                                                               *
* This program generates the daily position report including:    *
* - Portfolio position summary                                   *
* - Transaction activity                                         *
* - Exception reporting                                          *
* - Performance metrics                                          *
*****************************************************************
 ENVIRONMENT DIVISION.
 INPUT-OUTPUT SECTION.
 FILE-CONTROL.
     SELECT POSITION-MASTER ASSIGN TO POSMSTRE
         ORGANIZATION IS INDEXED
         ACCESS MODE IS SEQUENTIAL
         RECORD KEY IS POS-KEY
         FILE STATUS IS WS-POSITION-STATUS.

     SELECT TRANSACTION-HISTORY ASSIGN TO TRANHIST
         ORGANIZATION IS INDEXED
         ACCESS MODE IS SEQUENTIAL
         RECORD KEY IS TRAN-KEY
         FILE STATUS IS WS-TRAN-STATUS.

     SELECT REPORT-FILE ASSIGN TO RPTFILE
         ORGANIZATION IS SEQUENTIAL
         FILE STATUS IS WS-REPORT-STATUS.

 DATA DIVISION.
 FILE SECTION.
     COPY POSREC.
     COPY TRNREC.
     
 FD  REPORT-FILE
     RECORDING MODE IS F
     BLOCK CONTAINS 0 RECORDS.
 01  REPORT-RECORD             PIC X(132).

 WORKING-STORAGE SECTION.
     COPY RTNCODE.
     COPY ERRHAND.

 01  WS-FILE-STATUS.
     05  WS-POSITION-STATUS    PIC XX.
     05  WS-TRAN-STATUS        PIC XX.
     05  WS-REPORT-STATUS      PIC XX.

 01  WS-REPORT-HEADERS.
     05  WS-HEADER1.
         10  FILLER            PIC X(132) VALUE ALL '*'.
     05  WS-HEADER2.
         10  FILLER            PIC X(40) VALUE SPACES.
         10  FILLER            PIC X(52) 
             VALUE 'DAILY POSITION REPORT'.
         10  FILLER            PIC X(40) VALUE SPACES.
     05  WS-HEADER3.
         10  FILLER            PIC X(15) VALUE 'REPORT DATE:'.
         10  WS-REPORT-DATE    PIC X(10).
         10  FILLER            PIC X(107) VALUE SPACES.

 01  WS-POSITION-DETAIL.
     05  WS-POS-PORTFOLIO     PIC X(10).
     05  FILLER               PIC X(2) VALUE SPACES.
     05  WS-POS-DESCRIPTION   PIC X(30).
     05  FILLER               PIC X(2) VALUE SPACES.
     05  WS-POS-QUANTITY      PIC ZZZ,ZZZ,ZZ9.99.
     05  FILLER               PIC X(2) VALUE SPACES.
     05  WS-POS-VALUE         PIC $$$$,$$$,$$9.99.
     05  FILLER               PIC X(2) VALUE SPACES.
     05  WS-POS-CHANGE-PCT    PIC +ZZ9.99.
     05  FILLER               PIC X(40) VALUE SPACES.

*-- Change: Added working-storage for new CHANNEL-CODE field for reporting
 01  WS-TRAN-CHANNEL-CODE     PIC X(04).

 PROCEDURE DIVISION.
 0000-MAIN.
     PERFORM 1000-INITIALIZE
     PERFORM 2000-PROCESS-REPORT
     PERFORM 3000-CLEANUP
     GOBACK.

 1000-INITIALIZE.
     PERFORM 1100-OPEN-FILES
     PERFORM 1200-WRITE-HEADERS.

 1100-OPEN-FILES.
     OPEN INPUT POSITION-MASTER
     IF WS-POSITION-STATUS NOT = '00'
         MOVE 'ERROR OPENING POSITION MASTER'
           TO WS-ERROR-MESSAGE
         PERFORM 9999-ERROR-HANDLER
     END-IF

     OPEN INPUT TRANSACTION-HISTORY
     IF WS-TRAN-STATUS NOT = '00'
         MOVE 'ERROR OPENING TRANSACTION HISTORY'
           TO WS-ERROR-MESSAGE
         PERFORM 9999-ERROR-HANDLER
     END-IF

     OPEN OUTPUT REPORT-FILE
     IF WS-REPORT-STATUS NOT = '00'
         MOVE 'ERROR OPENING REPORT FILE'
           TO WS-ERROR-MESSAGE
         PERFORM 9999-ERROR-HANDLER
     END-IF.

 1200-WRITE-HEADERS.
     ACCEPT WS-REPORT-DATE FROM DATE
     WRITE REPORT-RECORD FROM WS-HEADER1
     WRITE REPORT-RECORD FROM WS-HEADER2
     WRITE REPORT-RECORD FROM WS-HEADER3.

 2000-PROCESS-REPORT.
     PERFORM 2100-READ-POSITIONS
     PERFORM 2200-PROCESS-TRANSACTIONS
     PERFORM 2300-WRITE-SUMMARY.

 2100-READ-POSITIONS.
     READ POSITION-MASTER
         AT END SET END-OF-POSITIONS TO TRUE
     END-READ
     
     PERFORM UNTIL END-OF-POSITIONS
         PERFORM 2110-FORMAT-POSITION
         READ POSITION-MASTER
             AT END SET END-OF-POSITIONS TO TRUE
         END-READ
     END-PERFORM.

 2110-FORMAT-POSITION.
     MOVE POS-PORTFOLIO-ID   TO WS-POS-PORTFOLIO
     MOVE POS-DESCRIPTION    TO WS-POS-DESCRIPTION
     MOVE POS-QUANTITY       TO WS-POS-QUANTITY
     MOVE POS-CURRENT-VALUE  TO WS-POS-VALUE
     COMPUTE WS-POS-CHANGE-PCT = 
         (POS-CURRENT-VALUE - POS-PREVIOUS-VALUE) /
          POS-PREVIOUS-VALUE * 100
     WRITE REPORT-RECORD FROM WS-POSITION-DETAIL.

 2200-PROCESS-TRANSACTIONS.
     PERFORM 2210-READ-TRANSACTIONS
     PERFORM 2220-SUMMARIZE-ACTIVITY.

*-- Change: Extract and store CHANNEL-CODE for each transaction for reporting/traceability
 2210-READ-TRANSACTIONS.
     READ TRANSACTION-HISTORY
         AT END
             SET END-OF-TRANSACTIONS TO TRUE
         NOT AT END
*-- Change: Store CHANNEL-CODE from transaction record
             MOVE TRN-CHANNEL-CODE TO WS-TRAN-CHANNEL-CODE
         END-READ.

*-- Change: Example usage of CHANNEL-CODE in reporting (add to summary or log as needed)
 2220-SUMMARIZE-ACTIVITY.
     IF WS-TRAN-CHANNEL-CODE NOT = SPACES
         DISPLAY 'CHANNEL-CODE: ' WS-TRAN-CHANNEL-CODE
     END-IF.

 2300-WRITE-SUMMARY.
     PERFORM 2310-WRITE-TOTALS
     PERFORM 2320-WRITE-EXCEPTIONS
     PERFORM 2330-WRITE-METRICS.

 3000-CLEANUP.
     CLOSE POSITION-MASTER
          TRANSACTION-HISTORY
          REPORT-FILE.

 9999-ERROR-HANDLER.
     DISPLAY WS-ERROR-MESSAGE
     MOVE 12 TO RETURN-CODE
     GOBACK.

[Summary Change Report]
- Added `WS-TRAN-CHANNEL-CODE` field in WORKING-STORAGE for new CHANNEL-CODE.
- In 2210-READ-TRANSACTIONS, moved TRN-CHANNEL-CODE from transaction record to WS-TRAN-CHANNEL-CODE for use in reporting.
- In 2220-SUMMARIZE-ACTIVITY, added logic to display CHANNEL-CODE for traceability (can be extended to report output as needed).
- All changes are inline-commented and minimally invasive.

[File 3] UTLVAL00.CBL src/programs/utility/UTLVAL00.cbl

 IDENTIFICATION DIVISION.
 PROGRAM-ID. UTLVAL00.
 AUTHOR. CLAUDE.
 DATE-WRITTEN. 2024-04-09.
*****************************************************************
* Data Validation Utility                                        *
*                                                               *
* Performs comprehensive data validation:                       *
* - Data integrity checks                                      *
* - Cross-reference validation                                 *
* - Format verification                                        *
* - Balance reconciliation                                     *
*****************************************************************
 ENVIRONMENT DIVISION.
 CONFIGURATION SECTION.
 SPECIAL-NAMES.
     CONSOLE IS CONS.
     
 INPUT-OUTPUT SECTION.
 FILE-CONTROL.
     SELECT VALIDATION-CONTROL ASSIGN TO VALCTL
         ORGANIZATION IS SEQUENTIAL
         ACCESS MODE IS SEQUENTIAL
         FILE STATUS IS WS-VAL-STATUS.

     SELECT POSITION-MASTER ASSIGN TO POSMSTRE
         ORGANIZATION IS INDEXED
         ACCESS MODE IS DYNAMIC
         RECORD KEY IS POS-KEY
         FILE STATUS IS WS-POS-STATUS.

     SELECT TRANSACTION-HISTORY ASSIGN TO TRANHIST
         ORGANIZATION IS INDEXED
         ACCESS MODE IS DYNAMIC
         RECORD KEY IS TRAN-KEY
         FILE STATUS IS WS-TRAN-STATUS.

     SELECT ERROR-REPORT ASSIGN TO ERRRPT
         ORGANIZATION IS SEQUENTIAL
         FILE STATUS IS WS-RPT-STATUS.

 DATA DIVISION.
 FILE SECTION.
     COPY POSREC.
     COPY TRNREC.
     
 FD  VALIDATION-CONTROL
     RECORDING MODE IS F
     BLOCK CONTAINS 0 RECORDS.
 01  VALIDATION-RECORD.
     05  VAL-TYPE             PIC X(10).
     05  VAL-PARAMETERS       PIC X(70).

 FD  ERROR-REPORT
     RECORDING MODE IS F
     BLOCK CONTAINS 0 RECORDS.
 01  ERROR-RECORD            PIC X(132).

 WORKING-STORAGE SECTION.
     COPY RTNCODE.
     COPY ERRHAND.

 01  WS-FILE-STATUS.
     05  WS-VAL-STATUS        PIC XX.
     05  WS-POS-STATUS        PIC XX.
     05  WS-TRAN-STATUS       PIC XX.
     05  WS-RPT-STATUS        PIC XX.

 01  WS-VALIDATION-TYPES.
     05  WS-INTEGRITY         PIC X(10) VALUE 'INTEGRITY'.
     05  WS-XREF              PIC X(10) VALUE 'XREF'.
     05  WS-FORMAT            PIC X(10) VALUE 'FORMAT'.
     05  WS-BALANCE           PIC X(10) VALUE 'BALANCE'.

 01  WS-PROCESSING-FLAGS.
     05  WS-END-OF-VAL        PIC X VALUE 'N'.
         88  END-OF-VALIDATION VALUE 'Y'.
     05  WS-ERROR-FOUND       PIC X VALUE 'N'.
         88  ERROR-FOUND      VALUE 'Y'.

 01  WS-VALIDATION-TOTALS.
     05  WS-RECORDS-READ      PIC 9(9) VALUE ZERO.
     05  WS-RECORDS-VALID     PIC 9(9) VALUE ZERO.
     05  WS-RECORDS-ERROR     PIC 9(9) VALUE ZERO.
     05  WS-TOTAL-AMOUNT      PIC S9(15)V99 VALUE ZERO.
     05  WS-CONTROL-TOTAL     PIC S9(15)V99 VALUE ZERO.

 01  WS-ERROR-LINE.
     05  WS-ERR-TYPE          PIC X(10).
     05  FILLER               PIC X(2) VALUE SPACES.
     05  WS-ERR-KEY           PIC X(20).
     05  FILLER               PIC X(2) VALUE SPACES.
     05  WS-ERR-DESC          PIC X(98).

*-- Change: Added working-storage for CHANNEL-CODE validation
 01  WS-TRAN-CHANNEL-CODE     PIC X(04).

 PROCEDURE DIVISION.
 0000-MAIN.
     PERFORM 1000-INITIALIZE
     PERFORM 2000-PROCESS
     PERFORM 3000-CLEANUP
     GOBACK.

 1000-INITIALIZE.
     PERFORM 1100-OPEN-FILES
     PERFORM 1200-INIT-PROCESSING.

 1100-OPEN-FILES.
     OPEN INPUT VALIDATION-CONTROL
     IF WS-VAL-STATUS NOT = '00'
         MOVE 'ERROR OPENING VALIDATION CONTROL'
           TO WS-ERROR-MESSAGE
         PERFORM 9999-ERROR-HANDLER
     END-IF

     OPEN INPUT POSITION-MASTER
     IF WS-POS-STATUS NOT = '00'
         MOVE 'ERROR OPENING POSITION MASTER'
           TO WS-ERROR-MESSAGE
         PERFORM 9999-ERROR-HANDLER
     END-IF

     OPEN INPUT TRANSACTION-HISTORY
     IF WS-TRAN-STATUS NOT = '00'
         MOVE 'ERROR OPENING TRANSACTION HISTORY'
           TO WS-ERROR-MESSAGE
         PERFORM 9999-ERROR-HANDLER
     END-IF

     OPEN OUTPUT ERROR-REPORT
     IF WS-RPT-STATUS NOT = '00'
         MOVE 'ERROR OPENING ERROR REPORT'
           TO WS-ERROR-MESSAGE
         PERFORM 9999-ERROR-HANDLER
     END-IF.

 1200-INIT-PROCESSING.
     INITIALIZE WS-VALIDATION-TOTALS.

 2000-PROCESS.
     PERFORM UNTIL END-OF-VALIDATION
         READ VALIDATION-CONTROL
             AT END
                 SET END-OF-VALIDATION TO TRUE
             NOT AT END
                 PERFORM 2100-PROCESS-VALIDATION
         END-READ
     END-PERFORM.

 2100-PROCESS-VALIDATION.
     EVALUATE VAL-TYPE
         WHEN WS-INTEGRITY
             PERFORM 2200-CHECK-INTEGRITY
         WHEN WS-XREF
             PERFORM 2300-CHECK-XREF
         WHEN WS-FORMAT
             PERFORM 2400-CHECK-FORMAT
         WHEN WS-BALANCE
             PERFORM 2500-CHECK-BALANCE
         WHEN OTHER
             MOVE 'INVALID VALIDATION TYPE'
               TO WS-ERROR-MESSAGE
             PERFORM 9999-ERROR-HANDLER
     END-EVALUATE.

 2200-CHECK-INTEGRITY.
     PERFORM 2210-CHECK-POSITION-INTEGRITY
     PERFORM 2220-CHECK-TRANSACTION-INTEGRITY.

 2300-CHECK-XREF.
     PERFORM 2310-CHECK-POSITION-XREF
     PERFORM 2320-CHECK-TRANSACTION-XREF.

 2400-CHECK-FORMAT.
     PERFORM 2410-CHECK-POSITION-FORMAT
     PERFORM 2420-CHECK-TRANSACTION-FORMAT.

*-- Change: Add validation for CHANNEL-CODE in transaction format check
 2420-CHECK-TRANSACTION-FORMAT.
     READ TRANSACTION-HISTORY
         AT END
             SET END-OF-TRANSACTIONS TO TRUE
         NOT AT END
*-- Change: Store CHANNEL-CODE from transaction record
             MOVE TRN-CHANNEL-CODE TO WS-TRAN-CHANNEL-CODE
*-- Change: Validate CHANNEL-CODE is not spaces (basic check, can be extended)
             IF WS-TRAN-CHANNEL-CODE = SPACES
                 MOVE 'CHANNEL-CODE MISSING' TO WS-ERR-DESC
                 WRITE ERROR-RECORD FROM WS-ERROR-LINE
             END-IF
         END-READ.

 2500-CHECK-BALANCE.
     PERFORM 2510-ACCUMULATE-POSITIONS
     PERFORM 2520-VERIFY-BALANCES.

 3000-CLEANUP.
     CLOSE VALIDATION-CONTROL
          POSITION-MASTER
          TRANSACTION-HISTORY
          ERROR-REPORT.

 9999-ERROR-HANDLER.
     ADD 1 TO WS-RECORDS-ERROR
     SET ERROR-FOUND TO TRUE
     MOVE WS-ERROR-MESSAGE TO WS-ERR-DESC
     WRITE ERROR-RECORD FROM WS-ERROR-LINE.

[Summary Change Report]
- Added `WS-TRAN-CHANNEL-CODE` to WORKING-STORAGE for channel field validation.
- In 2420-CHECK-TRANSACTION-FORMAT, moved TRN-CHANNEL-CODE to WS-TRAN-CHANNEL-CODE and added validation to ensure it is not missing (basic check, can be extended).
- All changes are inline-commented and preserve original logic and formatting.
```

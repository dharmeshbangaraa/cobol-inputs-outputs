[File 1] src/programs/batch/RPTPOS00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTPOS00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Daily Position Report Generator                                 *
      *                                                               *
      * This program generates the daily position report including:    *
      * - Portfolio position summary                                   *
      * - Transaction activity                                         *
      * - Exception reporting                                          *
      * - Performance metrics                                          *
      *****************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT POSITION-MASTER ASSIGN TO POSMSTRE
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS POS-KEY
               FILE STATUS IS WS-POSITION-STATUS.

           SELECT TRANSACTION-HISTORY ASSIGN TO TRANHIST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS TRAN-KEY
               FILE STATUS IS WS-TRAN-STATUS.

           SELECT REPORT-FILE ASSIGN TO RPTFILE
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-REPORT-STATUS.

       DATA DIVISION.
       FILE SECTION.
           COPY POSREC.
           COPY TRNREC.
           
       FD  REPORT-FILE
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  REPORT-RECORD             PIC X(132).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.
           COPY ERRHAND.

       01  WS-FILE-STATUS.
           05  WS-POSITION-STATUS    PIC XX.
           05  WS-TRAN-STATUS        PIC XX.
           05  WS-REPORT-STATUS      PIC XX.

       01  WS-REPORT-HEADERS.
           05  WS-HEADER1.
               10  FILLER            PIC X(132) VALUE ALL '*'.
           05  WS-HEADER2.
               10  FILLER            PIC X(40) VALUE SPACES.
               10  FILLER            PIC X(52) 
                   VALUE 'DAILY POSITION REPORT'.
               10  FILLER            PIC X(40) VALUE SPACES.
           05  WS-HEADER3.
               10  FILLER            PIC X(15) VALUE 'REPORT DATE:'.
               10  WS-REPORT-DATE    PIC X(10).
               10  FILLER            PIC X(107) VALUE SPACES.

       01  WS-POSITION-DETAIL.
           05  WS-POS-PORTFOLIO     PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-DESCRIPTION   PIC X(30).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-QUANTITY      PIC ZZZ,ZZZ,ZZ9.99.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-VALUE         PIC $$$$,$$$,$$9.99.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-CHANGE-PCT    PIC +ZZ9.99.
           05  FILLER               PIC X(40) VALUE SPACES.

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS-REPORT
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-WRITE-HEADERS.

       1100-OPEN-FILES.
           OPEN INPUT POSITION-MASTER
           IF WS-POSITION-STATUS NOT = '00'
               MOVE 'ERROR OPENING POSITION MASTER'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT TRANSACTION-HISTORY
           IF WS-TRAN-STATUS NOT = '00'
               MOVE 'ERROR OPENING TRANSACTION HISTORY'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT REPORT-FILE
           IF WS-REPORT-STATUS NOT = '00'
               MOVE 'ERROR OPENING REPORT FILE'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-WRITE-HEADERS.
           ACCEPT WS-REPORT-DATE FROM DATE
           WRITE REPORT-RECORD FROM WS-HEADER1
           WRITE REPORT-RECORD FROM WS-HEADER2
           WRITE REPORT-RECORD FROM WS-HEADER3.

       2000-PROCESS-REPORT.
           PERFORM 2100-READ-POSITIONS
           PERFORM 2200-PROCESS-TRANSACTIONS
           PERFORM 2300-WRITE-SUMMARY.

       2100-READ-POSITIONS.
           READ POSITION-MASTER
               AT END SET END-OF-POSITIONS TO TRUE
           END-READ
           
           PERFORM UNTIL END-OF-POSITIONS
               PERFORM 2110-FORMAT-POSITION
               READ POSITION-MASTER
                   AT END SET END-OF-POSITIONS TO TRUE
               END-READ
           END-PERFORM.

       2110-FORMAT-POSITION.
           MOVE POS-PORTFOLIO-ID   TO WS-POS-PORTFOLIO
           MOVE POS-DESCRIPTION    TO WS-POS-DESCRIPTION
           MOVE POS-QUANTITY       TO WS-POS-QUANTITY
           MOVE POS-CURRENT-VALUE  TO WS-POS-VALUE
           COMPUTE WS-POS-CHANGE-PCT = 
               (POS-CURRENT-VALUE - POS-PREVIOUS-VALUE) /
                POS-PREVIOUS-VALUE * 100
           *-- Begin Change: Ensure P&L values are rounded to two decimals
           MOVE POS-CURRENT-VALUE TO WS-POS-VALUE ROUNDED
           *-- End Change
           WRITE REPORT-RECORD FROM WS-POSITION-DETAIL.

       2200-PROCESS-TRANSACTIONS.
           PERFORM 2210-READ-TRANSACTIONS
           PERFORM 2220-SUMMARIZE-ACTIVITY.

       2300-WRITE-SUMMARY.
           PERFORM 2310-WRITE-TOTALS
           PERFORM 2320-WRITE-EXCEPTIONS
           PERFORM 2330-WRITE-METRICS.

       3000-CLEANUP.
           CLOSE POSITION-MASTER
                TRANSACTION-HISTORY
                REPORT-FILE.

       9999-ERROR-HANDLER.
           DISPLAY WS-ERROR-MESSAGE
           MOVE 12 TO RETURN-CODE
           GOBACK. 

[Summary of the modification]
File 1: src/programs/batch/RPTPOS00.cbl
- Added ROUNDED to the MOVE of POS-CURRENT-VALUE to WS-POS-VALUE in 2110-FORMAT-POSITION to ensure P&L values are rounded to two decimals for reporting, as per new business requirements.

[File 2] src/programs/batch/RPTAUD00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTAUD00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Audit Report Generator                                         *
      *                                                               *
      * Generates comprehensive audit report including:                *
      * - Security audit trails                                       *
      * - Process audit reporting                                     *
      * - Error summary reporting                                     *
      * - Control verification                                        *
      *****************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT AUDIT-FILE ASSIGN TO AUDITLOG
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS AUD-KEY
               FILE STATUS IS WS-AUDIT-STATUS.

           SELECT ERROR-FILE ASSIGN TO ERRLOG
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS ERR-KEY
               FILE STATUS IS WS-ERROR-STATUS.

           SELECT REPORT-FILE ASSIGN TO RPTFILE
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-REPORT-STATUS.

       DATA DIVISION.
       FILE SECTION.
           COPY AUDITLOG.
           COPY ERRHAND.
           
       FD  REPORT-FILE
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  REPORT-RECORD             PIC X(132).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.

       01  WS-FILE-STATUS.
           05  WS-AUDIT-STATUS       PIC XX.
           05  WS-ERROR-STATUS       PIC XX.
           05  WS-REPORT-STATUS      PIC XX.

       01  WS-REPORT-HEADERS.
           05  WS-HEADER1.
               10  FILLER            PIC X(132) VALUE ALL '*'.
           05  WS-HEADER2.
               10  FILLER            PIC X(40) VALUE SPACES.
               10  FILLER            PIC X(52) 
                   VALUE 'SYSTEM AUDIT REPORT'.
               10  FILLER            PIC X(40) VALUE SPACES.
           05  WS-HEADER3.
               10  FILLER            PIC X(15) VALUE 'REPORT DATE:'.
               10  WS-REPORT-DATE    PIC X(10).
               10  FILLER            PIC X(107) VALUE SPACES.

       01  WS-AUDIT-DETAIL.
           05  WS-AUD-TIMESTAMP     PIC X(26).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-AUD-PROGRAM       PIC X(8).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-AUD-TYPE          PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-AUD-MESSAGE       PIC X(80).

       01  WS-ERROR-DETAIL.
           05  WS-ERR-TIMESTAMP     PIC X(26).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-ERR-PROGRAM       PIC X(8).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-ERR-CODE          PIC X(4).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-ERR-MESSAGE       PIC X(80).

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS-REPORT
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-WRITE-HEADERS.

       1100-OPEN-FILES.
           OPEN INPUT AUDIT-FILE
           IF WS-AUDIT-STATUS NOT = '00'
               MOVE 'ERROR OPENING AUDIT FILE'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT ERROR-FILE
           IF WS-ERROR-STATUS NOT = '00'
               MOVE 'ERROR OPENING ERROR FILE'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT REPORT-FILE
           IF WS-REPORT-STATUS NOT = '00'
               MOVE 'ERROR OPENING REPORT FILE'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-WRITE-HEADERS.
           ACCEPT WS-REPORT-DATE FROM DATE
           WRITE REPORT-RECORD FROM WS-HEADER1
           WRITE REPORT-RECORD FROM WS-HEADER2
           WRITE REPORT-RECORD FROM WS-HEADER3.

       2000-PROCESS-REPORT.
           PERFORM 2100-PROCESS-AUDIT-TRAIL
           PERFORM 2200-PROCESS-ERROR-LOG
           PERFORM 2300-WRITE-SUMMARY.

       2100-PROCESS-AUDIT-TRAIL.
           PERFORM 2110-READ-AUDIT-RECORDS
           PERFORM 2120-SUMMARIZE-AUDIT.

       2200-PROCESS-ERROR-LOG.
           PERFORM 2210-READ-ERROR-RECORDS
           PERFORM 2220-SUMMARIZE-ERRORS.

       2300-WRITE-SUMMARY.
           PERFORM 2310-WRITE-AUDIT-SUMMARY
           PERFORM 2320-WRITE-ERROR-SUMMARY
           PERFORM 2330-WRITE-CONTROL-SUMMARY.

       3000-CLEANUP.
           CLOSE AUDIT-FILE
                ERROR-FILE
                REPORT-FILE.

       9999-ERROR-HANDLER.
           DISPLAY WS-ERROR-MESSAGE
           MOVE 12 TO RETURN-CODE
           GOBACK.

[Summary of the modification]
File 2: src/programs/batch/RPTAUD00.cbl
- No explicit P&L rounding logic was found in the provided code. If P&L fields are added to the report, ensure to use ROUNDED in any MOVE or COMPUTE statements involving P&L values. No code change was made as no such logic was present.

[File 3] src/programs/test/TSTVAL00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. TSTVAL00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Test Validation Suite                                         *
      *                                                               *
      * Validates test results and system behavior:                   *
      * - Test case execution                                        *
      * - Result validation                                          *
      * - Error condition testing                                    *
      * - Performance benchmarking                                   *
      *****************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CONSOLE IS CONS.
           
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TEST-CASES ASSIGN TO TESTCASE
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-TEST-STATUS.

           SELECT EXPECTED-RESULTS ASSIGN TO EXPECTED
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-EXP-STATUS.

           SELECT ACTUAL-RESULTS ASSIGN TO ACTUAL
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-ACT-STATUS.

           SELECT TEST-REPORT ASSIGN TO TESTRPT
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-RPT-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD  TEST-CASES
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  TEST-CASE-RECORD.
           05  TEST-ID              PIC X(10).
           05  TEST-TYPE            PIC X(10).
           05  TEST-DESCRIPTION     PIC X(50).
           05  TEST-PARAMETERS      PIC X(100).

       FD  EXPECTED-RESULTS
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  EXPECTED-RECORD         PIC X(200).

       FD  ACTUAL-RESULTS
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  ACTUAL-RECORD          PIC X(200).

       FD  TEST-REPORT
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  REPORT-RECORD          PIC X(132).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.
           COPY ERRHAND.

       01  WS-FILE-STATUS.
           05  WS-TEST-STATUS       PIC XX.
           05  WS-EXP-STATUS        PIC XX.
           05  WS-ACT-STATUS        PIC XX.
           05  WS-RPT-STATUS        PIC XX.

       01  WS-TEST-TYPES.
           05  WS-FUNCTIONAL        PIC X(10) VALUE 'FUNCTIONAL'.
           05  WS-INTEGRATION       PIC X(10) VALUE 'INTEGRATE'.
           05  WS-PERFORMANCE       PIC X(10) VALUE 'PERFORM'.
           05  WS-ERROR            PIC X(10) VALUE 'ERROR'.

       01  WS-PROCESSING-FLAGS.
           05  WS-END-OF-TESTS      PIC X VALUE 'N'.
               88  END-OF-TESTS     VALUE 'Y'.
           05  WS-TEST-PASSED       PIC X VALUE 'N'.
               88  TEST-PASSED      VALUE 'Y'.

       01  WS-TEST-METRICS.
           05  WS-TOTAL-TESTS       PIC 9(5) VALUE ZERO.
           05  WS-TESTS-PASSED      PIC 9(5) VALUE ZERO.
           05  WS-TESTS-FAILED      PIC 9(5) VALUE ZERO.
           05  WS-START-TIME        PIC 9(8) VALUE ZERO.
           05  WS-END-TIME          PIC 9(8) VALUE ZERO.
           05  WS-ELAPSED-TIME      PIC 9(8) VALUE ZERO.

       01  WS-REPORT-HEADERS.
           05  WS-HEADER1.
               10  FILLER           PIC X(132) VALUE ALL '*'.
           05  WS-HEADER2.
               10  FILLER           PIC X(30) VALUE SPACES.
               10  FILLER           PIC X(72) 
                   VALUE 'TEST VALIDATION REPORT'.
               10  FILLER           PIC X(30) VALUE SPACES.

       01  WS-TEST-DETAIL.
           05  WS-TEST-ID-OUT       PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TEST-TYPE-OUT     PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TEST-DESC-OUT     PIC X(50).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TEST-STATUS-OUT   PIC X(4).
           05  FILLER               PIC X(52) VALUE SPACES.

       01  WS-SUMMARY-LINE.
           05  FILLER               PIC X(15) VALUE 'TOTAL TESTS:'.
           05  WS-TOTAL-OUT         PIC ZZ,ZZ9.
           05  FILLER               PIC X(15) VALUE '  PASSED:'.
           05  WS-PASSED-OUT        PIC ZZ,ZZ9.
           05  FILLER               PIC X(15) VALUE '  FAILED:'.
           05  WS-FAILED-OUT        PIC ZZ,ZZ9.
           05  FILLER               PIC X(15) VALUE '  SUCCESS:'.
           05  WS-SUCCESS-RATE      PIC ZZ9.99.
           05  FILLER               PIC X(1) VALUE '%'.
           05  FILLER               PIC X(40) VALUE SPACES.

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-WRITE-HEADERS
           PERFORM 1300-INIT-METRICS.

       1100-OPEN-FILES.
           OPEN INPUT TEST-CASES
           IF WS-TEST-STATUS NOT = '00'
               MOVE 'ERROR OPENING TEST CASES'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT EXPECTED-RESULTS
           IF WS-EXP-STATUS NOT = '00'
               MOVE 'ERROR OPENING EXPECTED RESULTS'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT ACTUAL-RESULTS
           IF WS-ACT-STATUS NOT = '00'
               MOVE 'ERROR OPENING ACTUAL RESULTS'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT TEST-REPORT
           IF WS-RPT-STATUS NOT = '00'
               MOVE 'ERROR OPENING TEST REPORT'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-WRITE-HEADERS.
           WRITE REPORT-RECORD FROM WS-HEADER1
           WRITE REPORT-RECORD FROM WS-HEADER2.

       1300-INIT-METRICS.
           INITIALIZE WS-TEST-METRICS
           ACCEPT WS-START-TIME FROM TIME.

       2000-PROCESS.
           PERFORM UNTIL END-OF-TESTS
               READ TEST-CASES
                   AT END
                       SET END-OF-TESTS TO TRUE
                   NOT AT END
                       PERFORM 2100-EXECUTE-TEST
               END-READ
           END-PERFORM
           PERFORM 2900-WRITE-SUMMARY.

       2100-EXECUTE-TEST.
           EVALUATE TEST-TYPE
               WHEN WS-FUNCTIONAL
                   PERFORM 2200-RUN-FUNCTIONAL-TEST
               WHEN WS-INTEGRATION
                   PERFORM 2300-RUN-INTEGRATION-TEST
               WHEN WS-PERFORMANCE
                   PERFORM 2400-RUN-PERFORMANCE-TEST
               WHEN WS-ERROR
                   PERFORM 2500-RUN-ERROR-TEST
               WHEN OTHER
                   MOVE 'INVALID TEST TYPE'
                     TO WS-ERROR-MESSAGE
                   PERFORM 9999-ERROR-HANDLER
           END-EVALUATE
           PERFORM 2600-VALIDATE-RESULTS
           PERFORM 2700-UPDATE-METRICS
           PERFORM 2800-WRITE-TEST-DETAIL.

       2900-WRITE-SUMMARY.
           ACCEPT WS-END-TIME FROM TIME
           COMPUTE WS-ELAPSED-TIME = WS-END-TIME - WS-START-TIME
           MOVE WS-TOTAL-TESTS TO WS-TOTAL-OUT
           MOVE WS-TESTS-PASSED TO WS-PASSED-OUT
           MOVE WS-TESTS-FAILED TO WS-FAILED-OUT
           COMPUTE WS-SUCCESS-RATE = 
               (WS-TESTS-PASSED / WS-TOTAL-TESTS) * 100
           WRITE REPORT-RECORD FROM WS-SUMMARY-LINE.

       3000-CLEANUP.
           CLOSE TEST-CASES
                EXPECTED-RESULTS
                ACTUAL-RESULTS
                TEST-REPORT.

       9999-ERROR-HANDLER.
           DISPLAY WS-ERROR-MESSAGE UPON CONS
           MOVE 12 TO RETURN-CODE
           GOBACK. 

[Summary of the modification]
File 3: src/programs/test/TSTVAL00.cbl
- No explicit P&L calculation or rounding logic was found in the provided code. If P&L test cases are added, ensure to validate that actual results are rounded to two decimals. No code change was made as no such logic was present.

[File 4] src/jcl/test/TSTVAL.jcl

//TSTVAL00 JOB (ACCT#),'TEST VALIDATION',
//             CLASS=A,MSGCLASS=X,MSGLEVEL=(1,1)
//*
//* Test Validation Suite
//*
//STEP01   EXEC PGM=TSTVAL00
//STEPLIB  DD   DSN=TEST.LOAD.LIBRARY,DISP=SHR
//TESTCASE DD   DSN=TEST.CASE.FILE,DISP=SHR
//EXPECTED DD   DSN=TEST.EXPECTED.RESULTS,DISP=SHR
//ACTUAL   DD   DSN=TEST.ACTUAL.RESULTS,DISP=SHR
//TESTRPT  DD   DSN=TEST.VALIDATION.REPORT,
//             DISP=(NEW,CATLG,DELETE),
//             SPACE=(CYL,(10,5),RLSE),
//             DCB=(RECFM=FB,LRECL=132,BLKSIZE=0)
//SYSOUT   DD   SYSOUT=*
//SYSUDUMP DD   SYSOUT=*
//SYSPRINT DD   SYSOUT=* 

[Summary of the modification]
File 4: src/jcl/test/TSTVAL.jcl
- No changes required. Ensure that test cases and expected results validate rounding to two decimals for P&L values.

[File 5] src/copybook/common/POSREC.cpy

      *****************************************************************
      * POSITION RECORD STRUCTURE
      * VERSION: 1.0
      * DATE: 2024
      *****************************************************************
       01  POSITION-RECORD.
           05  POS-KEY.
               10  POS-PORTFOLIO-ID   PIC X(08).
               10  POS-DATE           PIC X(08).
               10  POS-INVESTMENT-ID  PIC X(10).
           05  POS-DATA.
               10  POS-QUANTITY       PIC S9(11)V9(4) COMP-3.
               10  POS-COST-BASIS     PIC S9(13)V9(2) COMP-3.
               10  POS-MARKET-VALUE   PIC S9(13)V9(2) COMP-3.
               10  POS-CURRENCY       PIC X(03).
               10  POS-STATUS         PIC X(01).
                   88  POS-STATUS-ACTIVE  VALUE 'A'.
                   88  POS-STATUS-CLOSED  VALUE 'C'.
                   88  POS-STATUS-PEND    VALUE 'P'.
           05  POS-AUDIT.
               10  POS-LAST-MAINT-DATE   PIC X(26).
               10  POS-LAST-MAINT-USER   PIC X(08).
           05  POS-FILLER               PIC X(50).
      *****************************************************************
      * FIELD DESCRIPTIONS:
      * POS-PORTFOLIO-ID : PORTFOLIO IDENTIFIER
      * POS-DATE         : POSITION DATE (YYYYMMDD)
      * POS-INVESTMENT-ID: INVESTMENT IDENTIFIER
      * POS-QUANTITY     : HOLDING QUANTITY
      * POS-COST-BASIS   : TOTAL COST BASIS
      * POS-MARKET-VALUE : CURRENT MARKET VALUE
      * POS-STATUS       : A=ACTIVE, C=CLOSED, P=PENDING
      ***************************************************************** 

[Summary of the modification]
File 5: src/copybook/common/POSREC.cpy
- No changes required. The P&L-related fields (POS-MARKET-VALUE, POS-COST-BASIS) are already defined with two decimal places. Ensure all programs using this copybook apply ROUNDED when moving or displaying these fields.

[File 6] src/copybook/common/PORTVAL.cpy

     *================================================================*
     * Copybook Name: PORTVAL
     * Description: Portfolio Validation Rules and Error Messages
     * Author: [Author name]
     * Date Written: 2024-03-20
     *================================================================*
     
     *----------------------------------------------------------------*
     * Validation Return Codes
     *----------------------------------------------------------------*
      01  VAL-RETURN-CODES.
          05  VAL-SUCCESS         PIC S9(4) VALUE +0.
          05  VAL-INVALID-ID      PIC S9(4) VALUE +1.
          05  VAL-INVALID-ACCT    PIC S9(4) VALUE +2.
          05  VAL-INVALID-TYPE    PIC S9(4) VALUE +3.
          05  VAL-INVALID-AMT     PIC S9(4) VALUE +4.
          
     *----------------------------------------------------------------*
     * Validation Error Messages
     *----------------------------------------------------------------*
      01  VAL-ERROR-MESSAGES.
          05  VAL-ERR-ID         PIC X(50) VALUE
              'Invalid Portfolio ID format'.
          05  VAL-ERR-ACCT       PIC X(50) VALUE
              'Invalid Account Number format'.
          05  VAL-ERR-TYPE       PIC X(50) VALUE
              'Invalid Investment Type'.
          05  VAL-ERR-AMT        PIC X(50) VALUE
              'Amount outside valid range'.
          
     *----------------------------------------------------------------*
     * Validation Constants
     *----------------------------------------------------------------*
      01  VAL-CONSTANTS.
          05  VAL-MIN-AMOUNT     PIC S9(13)V99 VALUE -9999999999999.99.
          05  VAL-MAX-AMOUNT     PIC S9(13)V99 VALUE +9999999999999.99.
          05  VAL-ID-PREFIX      PIC X(4)      VALUE 'PORT'.
          
     *----------------------------------------------------------------*
     * Validation Working Storage
     *----------------------------------------------------------------*
      01  VAL-WORK-AREAS.
          05  VAL-NUMERIC-CHECK  PIC X(10).
          05  VAL-TEMP-NUM       PIC S9(13)V99.
          05  VAL-ERROR-CODE     PIC S9(4).
          05  VAL-ERROR-MSG      PIC X(50).

[Summary of the modification]
File 6: src/copybook/common/PORTVAL.cpy
- No changes required. No P&L calculation or storage logic present.

[File 1] TRNREC.CPY src/copybook/common/TRNREC.cpy

      *****************************************************************
      * TRANSACTION RECORD STRUCTURE
      * VERSION: 1.1
      * DATE: 2024
      *****************************************************************
       01  TRANSACTION-RECORD.
           05  TRN-KEY.
               10  TRN-DATE           PIC X(08).
               10  TRN-TIME           PIC X(06).
               10  TRN-PORTFOLIO-ID   PIC X(08).
               10  TRN-SEQUENCE-NO    PIC X(06).
           05  TRN-DATA.
               10  TRN-INVESTMENT-ID  PIC X(10).
               10  TRN-TYPE           PIC X(02).
                   88  TRN-TYPE-BUY     VALUE 'BU'.
                   88  TRN-TYPE-SELL    VALUE 'SL'.
                   88  TRN-TYPE-TRANS   VALUE 'TR'.
                   88  TRN-TYPE-FEE     VALUE 'FE'.
               10  TRN-QUANTITY       PIC S9(11)V9(4) COMP-3.
               10  TRN-PRICE         PIC S9(11)V9(4) COMP-3.
               10  TRN-AMOUNT        PIC S9(13)V9(2) COMP-3.
               10  TRN-CURRENCY      PIC X(03).
               10  TRN-STATUS        PIC X(01).
                   88  TRN-STATUS-PEND   VALUE 'P'.
                   88  TRN-STATUS-DONE   VALUE 'D'.
                   88  TRN-STATUS-FAIL   VALUE 'F'.
                   88  TRN-STATUS-REV    VALUE 'R'.
               10  CHANNEL-CODE      PIC X(04).        *-- Change: Added CHANNEL-CODE for channel identification
           05  TRN-AUDIT.
               10  TRN-PROCESS-DATE  PIC X(26).
               10  TRN-PROCESS-USER  PIC X(08).
           05  TRN-FILLER           PIC X(46).         *-- Change: Reduced filler size by 4 to accommodate CHANNEL-CODE
      *****************************************************************
      * FIELD DESCRIPTIONS:
      * TRN-DATE        : TRANSACTION DATE (YYYYMMDD)
      * TRN-TIME        : TRANSACTION TIME (HHMMSS)
      * TRN-PORTFOLIO-ID: PORTFOLIO IDENTIFIER
      * TRN-SEQUENCE-NO : SEQUENCE NUMBER FOR MULTIPLE TRANS
      * TRN-TYPE        : BU=BUY, SL=SELL, TR=TRANSFER, FE=FEE
      * TRN-STATUS      : P=PENDING, D=DONE, F=FAILED, R=REVERSED
      * CHANNEL-CODE    : CHANNEL IDENTIFIER (e.g., 'BRCH', 'ONLN', 'IVR', etc.) *-- Change: Description for new field
      *****************************************************************

[Summary Change Report]
- Added CHANNEL-CODE (PIC X(04)) to TRN-DATA group in TRANSACTION-RECORD.
- Reduced TRN-FILLER by 4 bytes to preserve record length.
- Updated field descriptions to document CHANNEL-CODE.
- All formatting, indentation, and sequence preserved.

[File 2] RPTPOS00.CBL src/programs/batch/RPTPOS00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTPOS00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Daily Position Report Generator                                 *
      *                                                               *
      * This program generates the daily position report including:    *
      * - Portfolio position summary                                   *
      * - Transaction activity                                         *
      * - Exception reporting                                          *
      * - Performance metrics                                          *
      *****************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT POSITION-MASTER ASSIGN TO POSMSTRE
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS POS-KEY
               FILE STATUS IS WS-POSITION-STATUS.

           SELECT TRANSACTION-HISTORY ASSIGN TO TRANHIST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS TRAN-KEY
               FILE STATUS IS WS-TRAN-STATUS.

           SELECT REPORT-FILE ASSIGN TO RPTFILE
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-REPORT-STATUS.

       DATA DIVISION.
       FILE SECTION.
           COPY POSREC.
           COPY TRNREC.
           
       FD  REPORT-FILE
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  REPORT-RECORD             PIC X(132).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.
           COPY ERRHAND.

       01  WS-FILE-STATUS.
           05  WS-POSITION-STATUS    PIC XX.
           05  WS-TRAN-STATUS        PIC XX.
           05  WS-REPORT-STATUS      PIC XX.

       01  WS-REPORT-HEADERS.
           05  WS-HEADER1.
               10  FILLER            PIC X(132) VALUE ALL '*'.
           05  WS-HEADER2.
               10  FILLER            PIC X(40) VALUE SPACES.
               10  FILLER            PIC X(52) 
                   VALUE 'DAILY POSITION REPORT'.
               10  FILLER            PIC X(40) VALUE SPACES.
           05  WS-HEADER3.
               10  FILLER            PIC X(15) VALUE 'REPORT DATE:'.
               10  WS-REPORT-DATE    PIC X(10).
               10  FILLER            PIC X(107) VALUE SPACES.

       01  WS-POSITION-DETAIL.
           05  WS-POS-PORTFOLIO     PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-DESCRIPTION   PIC X(30).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-QUANTITY      PIC ZZZ,ZZZ,ZZ9.99.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-VALUE         PIC $$$$,$$$,$$9.99.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-CHANGE-PCT    PIC +ZZ9.99.
           05  FILLER               PIC X(40) VALUE SPACES.

       01  WS-TRANSACTION-DETAIL.
           05  WS-TRAN-DATE         PIC X(08).
           05  WS-TRAN-TIME         PIC X(06).
           05  WS-TRAN-PORTFOLIO    PIC X(08).
           05  WS-TRAN-TYPE         PIC X(02).
           05  WS-TRAN-AMOUNT       PIC ZZZ,ZZZ,ZZ9.99.
           05  WS-TRAN-CHANNEL      PIC X(04).        *-- Change: Added for CHANNEL-CODE reporting
           05  FILLER               PIC X(92) VALUE SPACES.

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS-REPORT
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-WRITE-HEADERS.

       1100-OPEN-FILES.
           OPEN INPUT POSITION-MASTER
           IF WS-POSITION-STATUS NOT = '00'
               MOVE 'ERROR OPENING POSITION MASTER'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT TRANSACTION-HISTORY
           IF WS-TRAN-STATUS NOT = '00'
               MOVE 'ERROR OPENING TRANSACTION HISTORY'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT REPORT-FILE
           IF WS-REPORT-STATUS NOT = '00'
               MOVE 'ERROR OPENING REPORT FILE'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-WRITE-HEADERS.
           ACCEPT WS-REPORT-DATE FROM DATE
           WRITE REPORT-RECORD FROM WS-HEADER1
           WRITE REPORT-RECORD FROM WS-HEADER2
           WRITE REPORT-RECORD FROM WS-HEADER3.

       2000-PROCESS-REPORT.
           PERFORM 2100-READ-POSITIONS
           PERFORM 2200-PROCESS-TRANSACTIONS
           PERFORM 2300-WRITE-SUMMARY.

       2100-READ-POSITIONS.
           READ POSITION-MASTER
               AT END SET END-OF-POSITIONS TO TRUE
           END-READ
           
           PERFORM UNTIL END-OF-POSITIONS
               PERFORM 2110-FORMAT-POSITION
               READ POSITION-MASTER
                   AT END SET END-OF-POSITIONS TO TRUE
               END-READ
           END-PERFORM.

       2110-FORMAT-POSITION.
           MOVE POS-PORTFOLIO-ID   TO WS-POS-PORTFOLIO
           MOVE POS-DESCRIPTION    TO WS-POS-DESCRIPTION
           MOVE POS-QUANTITY       TO WS-POS-QUANTITY
           MOVE POS-CURRENT-VALUE  TO WS-POS-VALUE
           COMPUTE WS-POS-CHANGE-PCT = 
               (POS-CURRENT-VALUE - POS-PREVIOUS-VALUE) /
                POS-PREVIOUS-VALUE * 100
           WRITE REPORT-RECORD FROM WS-POSITION-DETAIL.

       2200-PROCESS-TRANSACTIONS.
           PERFORM 2210-READ-TRANSACTIONS
           PERFORM 2220-SUMMARIZE-ACTIVITY.

       2210-READ-TRANSACTIONS.
           READ TRANSACTION-HISTORY
               AT END SET END-OF-TRANSACTIONS TO TRUE
           END-READ
           PERFORM UNTIL END-OF-TRANSACTIONS
               MOVE TRN-DATE           TO WS-TRAN-DATE
               MOVE TRN-TIME           TO WS-TRAN-TIME
               MOVE TRN-PORTFOLIO-ID   TO WS-TRAN-PORTFOLIO
               MOVE TRN-TYPE           TO WS-TRAN-TYPE
               MOVE TRN-AMOUNT         TO WS-TRAN-AMOUNT
               MOVE CHANNEL-CODE       TO WS-TRAN-CHANNEL    *-- Change: Map new field for reporting
               WRITE REPORT-RECORD FROM WS-TRANSACTION-DETAIL
               READ TRANSACTION-HISTORY
                   AT END SET END-OF-TRANSACTIONS TO TRUE
               END-READ
           END-PERFORM.

       2220-SUMMARIZE-ACTIVITY.
           CONTINUE.

       2300-WRITE-SUMMARY.
           PERFORM 2310-WRITE-TOTALS
           PERFORM 2320-WRITE-EXCEPTIONS
           PERFORM 2330-WRITE-METRICS.

       3000-CLEANUP.
           CLOSE POSITION-MASTER
                TRANSACTION-HISTORY
                REPORT-FILE.

       9999-ERROR-HANDLER.
           DISPLAY WS-ERROR-MESSAGE
           MOVE 12 TO RETURN-CODE
           GOBACK.

[Summary Change Report]
- Added WS-TRAN-CHANNEL (PIC X(04)) to WS-TRANSACTION-DETAIL for CHANNEL-CODE.
- In 2210-READ-TRANSACTIONS, mapped CHANNEL-CODE from transaction record to WS-TRAN-CHANNEL.
- Ensured reporting logic includes new field.
- All formatting and indentation preserved.

[File 3] UTLVAL00.CBL src/programs/utility/UTLVAL00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. UTLVAL00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Data Validation Utility                                        *
      *                                                               *
      * Performs comprehensive data validation:                       *
      * - Data integrity checks                                      *
      * - Cross-reference validation                                 *
      * - Format verification                                        *
      * - Balance reconciliation                                     *
      *****************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CONSOLE IS CONS.
           
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT VALIDATION-CONTROL ASSIGN TO VALCTL
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-VAL-STATUS.

           SELECT POSITION-MASTER ASSIGN TO POSMSTRE
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS POS-KEY
               FILE STATUS IS WS-POS-STATUS.

           SELECT TRANSACTION-HISTORY ASSIGN TO TRANHIST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS DYNAMIC
               RECORD KEY IS TRAN-KEY
               FILE STATUS IS WS-TRAN-STATUS.

           SELECT ERROR-REPORT ASSIGN TO ERRRPT
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-RPT-STATUS.

       DATA DIVISION.
       FILE SECTION.
           COPY POSREC.
           COPY TRNREC.
           
       FD  VALIDATION-CONTROL
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  VALIDATION-RECORD.
           05  VAL-TYPE             PIC X(10).
           05  VAL-PARAMETERS       PIC X(70).

       FD  ERROR-REPORT
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  ERROR-RECORD            PIC X(132).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.
           COPY ERRHAND.

       01  WS-FILE-STATUS.
           05  WS-VAL-STATUS        PIC XX.
           05  WS-POS-STATUS        PIC XX.
           05  WS-TRAN-STATUS       PIC XX.
           05  WS-RPT-STATUS        PIC XX.

       01  WS-VALIDATION-TYPES.
           05  WS-INTEGRITY         PIC X(10) VALUE 'INTEGRITY'.
           05  WS-XREF              PIC X(10) VALUE 'XREF'.
           05  WS-FORMAT            PIC X(10) VALUE 'FORMAT'.
           05  WS-BALANCE           PIC X(10) VALUE 'BALANCE'.

       01  WS-PROCESSING-FLAGS.
           05  WS-END-OF-VAL        PIC X VALUE 'N'.
               88  END-OF-VALIDATION VALUE 'Y'.
           05  WS-ERROR-FOUND       PIC X VALUE 'N'.
               88  ERROR-FOUND      VALUE 'Y'.

       01  WS-VALIDATION-TOTALS.
           05  WS-RECORDS-READ      PIC 9(9) VALUE ZERO.
           05  WS-RECORDS-VALID     PIC 9(9) VALUE ZERO.
           05  WS-RECORDS-ERROR     PIC 9(9) VALUE ZERO.
           05  WS-TOTAL-AMOUNT      PIC S9(15)V99 VALUE ZERO.
           05  WS-CONTROL-TOTAL     PIC S9(15)V99 VALUE ZERO.

       01  WS-ERROR-LINE.
           05  WS-ERR-TYPE          PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-ERR-KEY           PIC X(20).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-ERR-DESC          PIC X(98).

       01  WS-TRAN-CHANNEL-CODE     PIC X(04).        *-- Change: For validation of CHANNEL-CODE

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-INIT-PROCESSING.

       1100-OPEN-FILES.
           OPEN INPUT VALIDATION-CONTROL
           IF WS-VAL-STATUS NOT = '00'
               MOVE 'ERROR OPENING VALIDATION CONTROL'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT POSITION-MASTER
           IF WS-POS-STATUS NOT = '00'
               MOVE 'ERROR OPENING POSITION MASTER'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT TRANSACTION-HISTORY
           IF WS-TRAN-STATUS NOT = '00'
               MOVE 'ERROR OPENING TRANSACTION HISTORY'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT ERROR-REPORT
           IF WS-RPT-STATUS NOT = '00'
               MOVE 'ERROR OPENING ERROR REPORT'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-INIT-PROCESSING.
           INITIALIZE WS-VALIDATION-TOTALS.

       2000-PROCESS.
           PERFORM UNTIL END-OF-VALIDATION
               READ VALIDATION-CONTROL
                   AT END
                       SET END-OF-VALIDATION TO TRUE
                   NOT AT END
                       PERFORM 2100-PROCESS-VALIDATION
               END-READ
           END-PERFORM.

       2100-PROCESS-VALIDATION.
           EVALUATE VAL-TYPE
               WHEN WS-INTEGRITY
                   PERFORM 2200-CHECK-INTEGRITY
               WHEN WS-XREF
                   PERFORM 2300-CHECK-XREF
               WHEN WS-FORMAT
                   PERFORM 2400-CHECK-FORMAT
               WHEN WS-BALANCE
                   PERFORM 2500-CHECK-BALANCE
               WHEN OTHER
                   MOVE 'INVALID VALIDATION TYPE'
                     TO WS-ERROR-MESSAGE
                   PERFORM 9999-ERROR-HANDLER
           END-EVALUATE.

       2200-CHECK-INTEGRITY.
           PERFORM 2210-CHECK-POSITION-INTEGRITY
           PERFORM 2220-CHECK-TRANSACTION-INTEGRITY.

       2220-CHECK-TRANSACTION-INTEGRITY.
           READ TRANSACTION-HISTORY
               AT END
                   EXIT
           END-READ
           PERFORM UNTIL WS-TRAN-STATUS = '10'
               MOVE CHANNEL-CODE TO WS-TRAN-CHANNEL-CODE    *-- Change: Validate new field
               IF WS-TRAN-CHANNEL-CODE = SPACES OR WS-TRAN-CHANNEL-CODE = LOW-VALUES
                   MOVE 'CHANNEL-CODE MISSING' TO WS-ERR-DESC
                   WRITE ERROR-RECORD FROM WS-ERROR-LINE
               END-IF
               READ TRANSACTION-HISTORY
                   AT END
                       MOVE '10' TO WS-TRAN-STATUS
               END-READ
           END-PERFORM.

       2300-CHECK-XREF.
           PERFORM 2310-CHECK-POSITION-XREF
           PERFORM 2320-CHECK-TRANSACTION-XREF.

       2400-CHECK-FORMAT.
           PERFORM 2410-CHECK-POSITION-FORMAT
           PERFORM 2420-CHECK-TRANSACTION-FORMAT.

       2500-CHECK-BALANCE.
           PERFORM 2510-ACCUMULATE-POSITIONS
           PERFORM 2520-VERIFY-BALANCES.

       3000-CLEANUP.
           CLOSE VALIDATION-CONTROL
                POSITION-MASTER
                TRANSACTION-HISTORY
                ERROR-REPORT.

       9999-ERROR-HANDLER.
           ADD 1 TO WS-RECORDS-ERROR
           SET ERROR-FOUND TO TRUE
           MOVE WS-ERROR-MESSAGE TO WS-ERR-DESC
           WRITE ERROR-RECORD FROM WS-ERROR-LINE.

[Summary Change Report]
- Added WS-TRAN-CHANNEL-CODE (PIC X(04)) to Working-Storage.
- In 2220-CHECK-TRANSACTION-INTEGRITY, added validation for presence of CHANNEL-CODE.
- Error written if CHANNEL-CODE is missing or blank.
- All formatting and indentation preserved.

[File 4] TSTGEN00.CBL src/programs/test/TSTGEN00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. TSTGEN00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Test Data Generator                                           *
      *                                                               *
      * Generates test data for system testing:                      *
      * - Portfolio test data                                        *
      * - Transaction test scenarios                                 *
      * - Error condition data                                       *
      * - Performance test volumes                                   *
      *****************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CONSOLE IS CONS.
           
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TEST-CONFIG ASSIGN TO TSTCFG
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-CFG-STATUS.

           SELECT PORTFOLIO-OUT ASSIGN TO PORTOUT
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-PORT-STATUS.

           SELECT TRANSACTION-OUT ASSIGN TO TRANOUT
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-TRAN-STATUS.

           SELECT RANDOM-SEED ASSIGN TO RANDSEED
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-RAND-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD  TEST-CONFIG
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  CONFIG-RECORD.
           05  CFG-TEST-TYPE        PIC X(10).
           05  CFG-VOLUME           PIC 9(6).
           05  CFG-PARAMETERS       PIC X(64).

       FD  PORTFOLIO-OUT
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  PORTFOLIO-RECORD.
           COPY PORTFLIO REPLACING ==:PREFIX:== BY ==PORT==.

       FD  TRANSACTION-OUT
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  TRANSACTION-RECORD.
           COPY TRNREC REPLACING ==:PREFIX:== BY ==TRAN==.

       FD  RANDOM-SEED
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  SEED-RECORD             PIC 9(9).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.
           COPY ERRHAND.

       01  WS-FILE-STATUS.
           05  WS-CFG-STATUS        PIC XX.
           05  WS-PORT-STATUS       PIC XX.
           05  WS-TRAN-STATUS       PIC XX.
           05  WS-RAND-STATUS       PIC XX.

       01  WS-TEST-TYPES.
           05  WS-PORTFOLIO         PIC X(10) VALUE 'PORTFOLIO'.
           05  WS-TRANSACTION       PIC X(10) VALUE 'TRANSACTN'.
           05  WS-ERROR-TEST        PIC X(10) VALUE 'ERROR'.
           05  WS-VOLUME-TEST       PIC X(10) VALUE 'VOLUME'.

       01  WS-PROCESSING-FLAGS.
           05  WS-END-OF-CONFIG     PIC X VALUE 'N'.
               88  END-OF-CONFIG    VALUE 'Y'.

       01  WS-COUNTERS.
           05  WS-RECORDS-WRITTEN   PIC 9(9) VALUE ZERO.
           05  WS-ERROR-COUNT       PIC 9(9) VALUE ZERO.

       01  WS-RANDOM-VALUES.
           05  WS-RANDOM-SEED       PIC 9(9).
           05  WS-RANDOM-NUM        PIC 9(9).
           05  WS-RANDOM-DECIMAL    PIC 9(9)V99.

       01  WS-PORTFOLIO-DATA.
           05  WS-PORT-ID           PIC X(10).
           05  WS-PORT-NAME         PIC X(30).
           05  WS-PORT-TYPE         PIC X(2).
           05  WS-PORT-STATUS       PIC X(1).
           05  WS-PORT-BALANCE      PIC 9(15)V99.

       01  WS-TRANSACTION-DATA.
           05  WS-TRAN-ID           PIC X(12).
           05  WS-TRAN-TYPE         PIC X(2).
           05  WS-TRAN-AMOUNT       PIC 9(15)V99.
           05  WS-TRAN-DATE         PIC X(8).
           05  WS-TRAN-STATUS       PIC X(1).
           05  WS-TRAN-CHANNEL      PIC X(04).        *-- Change: For test data generation of CHANNEL-CODE

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-INIT-RANDOM
           PERFORM 1300-INIT-COUNTERS.

       1100-OPEN-FILES.
           OPEN INPUT TEST-CONFIG
           IF WS-CFG-STATUS NOT = '00'
               MOVE 'ERROR OPENING CONFIG FILE'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT PORTFOLIO-OUT
           IF WS-PORT-STATUS NOT = '00'
               MOVE 'ERROR OPENING PORTFOLIO OUTPUT'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT TRANSACTION-OUT
           IF WS-TRAN-STATUS NOT = '00'
               MOVE 'ERROR OPENING TRANSACTION OUTPUT'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT RANDOM-SEED
           IF WS-RAND-STATUS NOT = '00'
               MOVE 'ERROR OPENING RANDOM SEED'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-INIT-RANDOM.
           READ RANDOM-SEED
           MOVE SEED-RECORD TO WS-RANDOM-SEED.

       1300-INIT-COUNTERS.
           INITIALIZE WS-COUNTERS.

       2000-PROCESS.
           PERFORM UNTIL END-OF-CONFIG
               READ TEST-CONFIG
                   AT END
                       SET END-OF-CONFIG TO TRUE
                   NOT AT END
                       PERFORM 2100-GENERATE-TEST-DATA
               END-READ
           END-PERFORM.

       2100-GENERATE-TEST-DATA.
           EVALUATE CFG-TEST-TYPE
               WHEN WS-PORTFOLIO
                   PERFORM 2200-GEN-PORTFOLIO
               WHEN WS-TRANSACTION
                   PERFORM 2300-GEN-TRANSACTION
               WHEN WS-ERROR-TEST
                   PERFORM 2400-GEN-ERROR-DATA
               WHEN WS-VOLUME-TEST
                   PERFORM 2500-GEN-VOLUME-DATA
               WHEN OTHER
                   MOVE 'INVALID TEST TYPE'
                     TO WS-ERROR-MESSAGE
                   PERFORM 9999-ERROR-HANDLER
           END-EVALUATE.

       2200-GEN-PORTFOLIO.
           PERFORM VARYING WS-RECORDS-WRITTEN FROM 1 BY 1
                   UNTIL WS-RECORDS-WRITTEN > CFG-VOLUME
               PERFORM 2210-GEN-PORT-DATA
               PERFORM 2220-WRITE-PORT-RECORD
           END-PERFORM.

       2300-GEN-TRANSACTION.
           PERFORM VARYING WS-RECORDS-WRITTEN FROM 1 BY 1
                   UNTIL WS-RECORDS-WRITTEN > CFG-VOLUME
               PERFORM 2310-GEN-TRAN-DATA
               PERFORM 2320-WRITE-TRAN-RECORD
           END-PERFORM.

       2310-GEN-TRAN-DATA.
           * Existing logic to populate transaction fields
           MOVE 'ONLN' TO WS-TRAN-CHANNEL         *-- Change: Populate CHANNEL-CODE for test data
           CONTINUE.

       2320-WRITE-TRAN-RECORD.
           MOVE WS-TRAN-CHANNEL TO CHANNEL-CODE   *-- Change: Map test field to copybook for output
           CONTINUE.

       2400-GEN-ERROR-DATA.
           PERFORM 2410-GEN-DATA-ERRORS
           PERFORM 2420-GEN-PROCESS-ERRORS.

       2500-GEN-VOLUME-DATA.
           PERFORM 2510-GEN-LARGE-PORTFOLIO
           PERFORM 2520-GEN-LARGE-TRANSACTION.

       3000-CLEANUP.
           CLOSE TEST-CONFIG
                PORTFOLIO-OUT
                TRANSACTION-OUT
                RANDOM-SEED.

       9999-ERROR-HANDLER.
           ADD 1 TO WS-ERROR-COUNT
           DISPLAY WS-ERROR-MESSAGE UPON CONS
           IF WS-ERROR-COUNT > 100
               MOVE 12 TO RETURN-CODE
               GOBACK
           END-IF.

[Summary Change Report]
- Added WS-TRAN-CHANNEL (PIC X(04)) to Working-Storage.
- In 2310-GEN-TRAN-DATA, populated WS-TRAN-CHANNEL with a test value ('ONLN').
- In 2320-WRITE-TRAN-RECORD, mapped WS-TRAN-CHANNEL to CHANNEL-CODE in the copybook.
- All formatting and indentation preserved.

[File 5] TSTVAL00.CBL src/programs/test/TSTVAL00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. TSTVAL00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Test Validation Suite                                         *
      *                                                               *
      * Validates test results and system behavior:                   *
      * - Test case execution                                        *
      * - Result validation                                          *
      * - Error condition testing                                    *
      * - Performance benchmarking                                   *
      *****************************************************************
       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SPECIAL-NAMES.
           CONSOLE IS CONS.
           
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TEST-CASES ASSIGN TO TESTCASE
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-TEST-STATUS.

           SELECT EXPECTED-RESULTS ASSIGN TO EXPECTED
               ORGANIZATION IS SEQUENTIAL
               ACCESS MODE IS SEQUENTIAL
               FILE STATUS IS WS-EXP-STATUS.

           SELECT ACTUAL-RESULTS ASSIGN TO ACTUAL
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-ACT-STATUS.

           SELECT TEST-REPORT ASSIGN TO TESTRPT
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-RPT-STATUS.

       DATA DIVISION.
       FILE SECTION.
       FD  TEST-CASES
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  TEST-CASE-RECORD.
           05  TEST-ID              PIC X(10).
           05  TEST-TYPE            PIC X(10).
           05  TEST-DESCRIPTION     PIC X(50).
           05  TEST-PARAMETERS      PIC X(100).

       FD  EXPECTED-RESULTS
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  EXPECTED-RECORD         PIC X(200).

       FD  ACTUAL-RESULTS
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  ACTUAL-RECORD          PIC X(200).

       FD  TEST-REPORT
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  REPORT-RECORD          PIC X(132).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.
           COPY ERRHAND.

       01  WS-FILE-STATUS.
           05  WS-TEST-STATUS       PIC XX.
           05  WS-EXP-STATUS        PIC XX.
           05  WS-ACT-STATUS        PIC XX.
           05  WS-RPT-STATUS        PIC XX.

       01  WS-TEST-TYPES.
           05  WS-FUNCTIONAL        PIC X(10) VALUE 'FUNCTIONAL'.
           05  WS-INTEGRATION       PIC X(10) VALUE 'INTEGRATE'.
           05  WS-PERFORMANCE       PIC X(10) VALUE 'PERFORM'.
           05  WS-ERROR            PIC X(10) VALUE 'ERROR'.

       01  WS-PROCESSING-FLAGS.
           05  WS-END-OF-TESTS      PIC X VALUE 'N'.
               88  END-OF-TESTS     VALUE 'Y'.
           05  WS-TEST-PASSED       PIC X VALUE 'N'.
               88  TEST-PASSED      VALUE 'Y'.

       01  WS-TEST-METRICS.
           05  WS-TOTAL-TESTS       PIC 9(5) VALUE ZERO.
           05  WS-TESTS-PASSED      PIC 9(5) VALUE ZERO.
           05  WS-TESTS-FAILED      PIC 9(5) VALUE ZERO.
           05  WS-START-TIME        PIC 9(8) VALUE ZERO.
           05  WS-END-TIME          PIC 9(8) VALUE ZERO.
           05  WS-ELAPSED-TIME      PIC 9(8) VALUE ZERO.

       01  WS-REPORT-HEADERS.
           05  WS-HEADER1.
               10  FILLER           PIC X(132) VALUE ALL '*'.
           05  WS-HEADER2.
               10  FILLER           PIC X(30) VALUE SPACES.
               10  FILLER           PIC X(72) 
                   VALUE 'TEST VALIDATION REPORT'.
               10  FILLER           PIC X(30) VALUE SPACES.

       01  WS-TEST-DETAIL.
           05  WS-TEST-ID-OUT       PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TEST-TYPE-OUT     PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TEST-DESC-OUT     PIC X(50).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TEST-STATUS-OUT   PIC X(4).
           05  FILLER               PIC X(52) VALUE SPACES.

       01  WS-SUMMARY-LINE.
           05  FILLER               PIC X(15) VALUE 'TOTAL TESTS:'.
           05  WS-TOTAL-OUT         PIC ZZ,ZZ9.
           05  FILLER               PIC X(15) VALUE '  PASSED:'.
           05  WS-PASSED-OUT        PIC ZZ,ZZ9.
           05  FILLER               PIC X(15) VALUE '  FAILED:'.
           05  WS-FAILED-OUT        PIC ZZ,ZZ9.
           05  FILLER               PIC X(15) VALUE '  SUCCESS:'.
           05  WS-SUCCESS-RATE      PIC ZZ9.99.
           05  FILLER               PIC X(1) VALUE '%'.
           05  FILLER               PIC X(40) VALUE SPACES.

       01  WS-TRAN-CHANNEL-CODE     PIC X(04).        *-- Change: For test validation of CHANNEL-CODE

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-WRITE-HEADERS
           PERFORM 1300-INIT-METRICS.

       1100-OPEN-FILES.
           OPEN INPUT TEST-CASES
           IF WS-TEST-STATUS NOT = '00'
               MOVE 'ERROR OPENING TEST CASES'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT EXPECTED-RESULTS
           IF WS-EXP-STATUS NOT = '00'
               MOVE 'ERROR OPENING EXPECTED RESULTS'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT ACTUAL-RESULTS
           IF WS-ACT-STATUS NOT = '00'
               MOVE 'ERROR OPENING ACTUAL RESULTS'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT TEST-REPORT
           IF WS-RPT-STATUS NOT = '00'
               MOVE 'ERROR OPENING TEST REPORT'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-WRITE-HEADERS.
           WRITE REPORT-RECORD FROM WS-HEADER1
           WRITE REPORT-RECORD FROM WS-HEADER2.

       1300-INIT-METRICS.
           INITIALIZE WS-TEST-METRICS
           ACCEPT WS-START-TIME FROM TIME.

       2000-PROCESS.
           PERFORM UNTIL END-OF-TESTS
               READ TEST-CASES
                   AT END
                       SET END-OF-TESTS TO TRUE
                   NOT AT END
                       PERFORM 2100-EXECUTE-TEST
               END-READ
           END-PERFORM
           PERFORM 2900-WRITE-SUMMARY.

       2100-EXECUTE-TEST.
           * Existing logic
           MOVE CHANNEL-CODE TO WS-TRAN-CHANNEL-CODE   *-- Change: Validate new field in test case
           IF WS-TRAN-CHANNEL-CODE = SPACES OR WS-TRAN-CHANNEL-CODE = LOW-VALUES
               MOVE 'CHANNEL-CODE MISSING IN TEST' TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF
           EVALUATE TEST-TYPE
               WHEN WS-FUNCTIONAL
                   PERFORM 2200-RUN-FUNCTIONAL-TEST
               WHEN WS-INTEGRATION
                   PERFORM 2300-RUN-INTEGRATION-TEST
               WHEN WS-PERFORMANCE
                   PERFORM 2400-RUN-PERFORMANCE-TEST
               WHEN WS-ERROR
                   PERFORM 2500-RUN-ERROR-TEST
               WHEN OTHER
                   MOVE 'INVALID TEST TYPE'
                     TO WS-ERROR-MESSAGE
                   PERFORM 9999-ERROR-HANDLER
           END-EVALUATE
           PERFORM 2600-VALIDATE-RESULTS
           PERFORM 2700-UPDATE-METRICS
           PERFORM 2800-WRITE-TEST-DETAIL.

       2900-WRITE-SUMMARY.
           ACCEPT WS-END-TIME FROM TIME
           COMPUTE WS-ELAPSED-TIME = WS-END-TIME - WS-START-TIME
           MOVE WS-TOTAL-TESTS TO WS-TOTAL-OUT
           MOVE WS-TESTS-PASSED TO WS-PASSED-OUT
           MOVE WS-TESTS-FAILED TO WS-FAILED-OUT
           COMPUTE WS-SUCCESS-RATE = 
               (WS-TESTS-PASSED / WS-TOTAL-TESTS) * 100
           WRITE REPORT-RECORD FROM WS-SUMMARY-LINE.

       3000-CLEANUP.
           CLOSE TEST-CASES
                EXPECTED-RESULTS
                ACTUAL-RESULTS
                TEST-REPORT.

       9999-ERROR-HANDLER.
           DISPLAY WS-ERROR-MESSAGE UPON CONS
           MOVE 12 TO RETURN-CODE
           GOBACK.

[Summary Change Report]
- Added WS-TRAN-CHANNEL-CODE (PIC X(04)) to Working-Storage.
- In 2100-EXECUTE-TEST, added validation for CHANNEL-CODE presence in test records.
- Error handling if CHANNEL-CODE is missing or blank.
- All formatting and indentation preserved.

**inputs/IARLegacyBenchmarkSuit.txt**
**Summary**:
User Story: Add Transaction Type Field to Batch Processing and Reporting  
- 3 impacted components identified  
- High complexity change affecting transaction data structure, processing, and reporting

---

**Ranked Impact List**:

| Program         | Impact | Nature  | Affected Paragraphs/Sections      | Dependency Path                |
|-----------------|--------|---------|-----------------------------------|-------------------------------|
| TRNREC.cpy      | High   | Direct  | TRANSACTION-RECORD                | [TRNREC.cpy]                  |
| PORTTRAN.cbl    | High   | Direct  | 2100-VALIDATE-TRANSACTION, 2120-CHECK-TRANSACTION-TYPE, 2200-UPDATE-POSITIONS, 2210-PROCESS-BUY, 2220-PROCESS-SELL, 2230-PROCESS-TRANSFER, 2240-PROCESS-FEE, 2300-UPDATE-AUDIT-TRAIL | [PORTTRAN.cbl → TRNREC.cpy]   |
| RPTPOS00.cbl    | High   | Direct  | 2200-PROCESS-TRANSACTIONS, 2110-FORMAT-POSITION, 2000-PROCESS-REPORT | [RPTPOS00.cbl → TRNREC.cpy]   |

---

**JSON Metadata**:
```json
{
  "impactAnalysis": {
    "userStory": "Add Transaction Type Field to Batch Processing and Reporting",
    "impactedComponents": [
      {
        "programName": "TRNREC.cpy",
        "impactScore": 1.0,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": ["TRANSACTION-RECORD"],
        "dependencyPath": ["TRNREC.cpy"],
        "rationale": "Primary transaction record data structure; will have new TRANSACTION-TYPE field added, affecting all consumers."
      },
      {
        "programName": "PORTTRAN.cbl",
        "impactScore": 0.95,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "2100-VALIDATE-TRANSACTION",
          "2120-CHECK-TRANSACTION-TYPE",
          "2200-UPDATE-POSITIONS",
          "2210-PROCESS-BUY",
          "2220-PROCESS-SELL",
          "2230-PROCESS-TRANSFER",
          "2240-PROCESS-FEE",
          "2300-UPDATE-AUDIT-TRAIL"
        ],
        "dependencyPath": ["PORTTRAN.cbl", "TRNREC.cpy"],
        "rationale": "Batch transaction processing program; must read, validate, and process the new TRANSACTION-TYPE field."
      },
      {
        "programName": "RPTPOS00.cbl",
        "impactScore": 0.90,
        "impactLevel": "High",
        "impactType": "Direct",
        "affectedParagraphs": [
          "2200-PROCESS-TRANSACTIONS",
          "2110-FORMAT-POSITION",
          "2000-PROCESS-REPORT"
        ],
        "dependencyPath": ["RPTPOS00.cbl", "TRNREC.cpy"],
        "rationale": "Reporting program; must read and display the new TRANSACTION-TYPE field in summary reports."
      }
    ]
  }
}
```

---

**Visualization**:

```mermaid
graph TD
    TRNREC[TRNREC.cpy]:::high
    PORTTRAN[PORTTRAN.cbl]:::high
    RPTPOS00[RPTPOS00.cbl]:::high

    PORTTRAN --> TRNREC
    RPTPOS00 --> TRNREC

    classDef high fill:#ffcccc,stroke:#b22222,stroke-width:2px;
    class TRNREC,PORTTRAN,RPTPOS00 high;
```

---

**Reasoning**:
- **TRNREC.cpy** is the central copybook for transaction records and will be directly modified to add the new field. All programs using this copybook are potentially impacted.
- **PORTTRAN.cbl** is the main batch program for transaction processing and directly uses TRNREC.cpy, so it must be updated to handle the new field in all relevant logic and validation.
- **RPTPOS00.cbl** is the reporting program that generates transaction reports using TRNREC.cpy, so it must be updated to read and display the new field.
- Other batch programs in the batch directory do not reference TRNREC.cpy and are not directly impacted.
- The impact is ranked high for all three components due to the direct nature of the change and its effect on core business logic and reporting.

----------

```

```
[1] TRNREC.cpy /copybooks/TRNREC.cpy

       01  TRANSACTION-RECORD.
           05  TRANSACTION-ID            PIC X(10).
           05  TRANSACTION-DATE          PIC 9(8).
           05  TRANSACTION-AMOUNT        PIC S9(9)V99 COMP-3.
           05  TRANSACTION-ACCOUNT       PIC X(12).
           05  TRANSACTION-DESCRIPTION   PIC X(30).
*          Added TRANSACTION-TYPE field for batch processing and reporting (2024-06-XX)
           05  TRANSACTION-TYPE          PIC X(04).
           05  TRANSACTION-STATUS        PIC X(01).

Summary of the modification:
Added a new field TRANSACTION-TYPE (PIC X(04)) to the TRANSACTION-RECORD structure to support new batch processing and reporting requirements. Inline comment documents the change.

```

```
[2] PORTTRAN.cbl /batch/PORTTRAN.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. PORTTRAN.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT.DAT'
               ORGANIZATION IS LINE SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  TRANSACTION-FILE.
       COPY TRNREC.

       WORKING-STORAGE SECTION.
       77  WS-EOF              PIC X VALUE 'N'.
       77  WS-RETURN-CODE      PIC 9(4) VALUE ZERO.
       77  WS-TRANSACTION-COUNT PIC 9(6) VALUE ZERO.
*      Working storage for TRANSACTION-TYPE validation
       77  WS-VALID-TYPES      PIC X(20) VALUE 'BUY SELL TRAN FEE '.

       PROCEDURE DIVISION.
       MAIN-LOGIC.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS-TRANSACTIONS UNTIL WS-EOF = 'Y'
           PERFORM 3000-FINALIZE
           STOP RUN.

       1000-INITIALIZE.
           OPEN INPUT TRANSACTION-FILE.
           READ TRANSACTION-FILE
               AT END
                   MOVE 'Y' TO WS-EOF
               NOT AT END
                   CONTINUE
           END-READ.

       2000-PROCESS-TRANSACTIONS.
           IF WS-EOF = 'Y'
               EXIT PARAGRAPH
           END-IF
           PERFORM 2100-VALIDATE-TRANSACTION
           PERFORM 2200-UPDATE-POSITIONS
           READ TRANSACTION-FILE
               AT END
                   MOVE 'Y' TO WS-EOF
               NOT AT END
                   ADD 1 TO WS-TRANSACTION-COUNT
           END-READ.

*      Added TRANSACTION-TYPE validation logic (2024-06-XX)
       2100-VALIDATE-TRANSACTION.
           IF TRANSACTION-ID = SPACES OR TRANSACTION-AMOUNT = ZERO
               DISPLAY 'INVALID TRANSACTION RECORD: MISSING ID OR AMOUNT'
               GO TO 2999-EXIT
           END-IF
           PERFORM 2120-CHECK-TRANSACTION-TYPE.

       2120-CHECK-TRANSACTION-TYPE.
*          Check if TRANSACTION-TYPE is valid (BUY, SELL, TRAN, FEE)
           IF TRANSACTION-TYPE = SPACES
               DISPLAY 'INVALID TRANSACTION: MISSING TYPE'
               GO TO 2999-EXIT
           END-IF
           IF TRANSACTION-TYPE NOT = 'BUY ' AND
              TRANSACTION-TYPE NOT = 'SELL' AND
              TRANSACTION-TYPE NOT = 'TRAN' AND
              TRANSACTION-TYPE NOT = 'FEE '
               DISPLAY 'INVALID TRANSACTION TYPE: ' TRANSACTION-TYPE
               GO TO 2999-EXIT
           END-IF.

       2200-UPDATE-POSITIONS.
*          Update logic based on TRANSACTION-TYPE
           EVALUATE TRANSACTION-TYPE
               WHEN 'BUY '
                   PERFORM 2210-PROCESS-BUY
               WHEN 'SELL'
                   PERFORM 2220-PROCESS-SELL
               WHEN 'TRAN'
                   PERFORM 2230-PROCESS-TRANSFER
               WHEN 'FEE '
                   PERFORM 2240-PROCESS-FEE
               WHEN OTHER
                   DISPLAY 'UNKNOWN TRANSACTION TYPE: ' TRANSACTION-TYPE
           END-EVALUATE.

       2210-PROCESS-BUY.
*          Process BUY transaction
           DISPLAY 'PROCESSING BUY TRANSACTION: ' TRANSACTION-ID.

       2220-PROCESS-SELL.
*          Process SELL transaction
           DISPLAY 'PROCESSING SELL TRANSACTION: ' TRANSACTION-ID.

       2230-PROCESS-TRANSFER.
*          Process TRANSFER transaction
           DISPLAY 'PROCESSING TRANSFER TRANSACTION: ' TRANSACTION-ID.

       2240-PROCESS-FEE.
*          Process FEE transaction
           DISPLAY 'PROCESSING FEE TRANSACTION: ' TRANSACTION-ID.

       2300-UPDATE-AUDIT-TRAIL.
*          Audit trail now includes TRANSACTION-TYPE
           DISPLAY 'AUDIT: ' TRANSACTION-ID ' TYPE: ' TRANSACTION-TYPE.

       2999-EXIT.
           EXIT.

       3000-FINALIZE.
           CLOSE TRANSACTION-FILE.
           DISPLAY 'TOTAL TRANSACTIONS PROCESSED: ' WS-TRANSACTION-COUNT.

Summary of the modification:
- Updated to process new TRANSACTION-TYPE field from the copybook.
- Added validation for TRANSACTION-TYPE in 2100-VALIDATE-TRANSACTION and 2120-CHECK-TRANSACTION-TYPE.
- Updated 2200-UPDATE-POSITIONS to branch logic based on TRANSACTION-TYPE using EVALUATE.
- Updated audit trail to include TRANSACTION-TYPE.
- Inline comments document all changes.

```

```
[3] RPTPOS00.cbl /reports/RPTPOS00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTPOS00.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT.DAT'
               ORGANIZATION IS LINE SEQUENTIAL.
           SELECT REPORT-FILE ASSIGN TO 'REPORT.OUT'
               ORGANIZATION IS LINE SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  TRANSACTION-FILE.
       COPY TRNREC.

       FD  REPORT-FILE.
       01  REPORT-RECORD         PIC X(132).

       WORKING-STORAGE SECTION.
       77  WS-EOF                PIC X VALUE 'N'.
       77  WS-TRANSACTION-COUNT  PIC 9(6) VALUE ZERO.

       PROCEDURE DIVISION.
       MAIN-LOGIC.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS-REPORT UNTIL WS-EOF = 'Y'
           PERFORM 3000-FINALIZE
           STOP RUN.

       1000-INITIALIZE.
           OPEN INPUT TRANSACTION-FILE
           OPEN OUTPUT REPORT-FILE
           READ TRANSACTION-FILE
               AT END
                   MOVE 'Y' TO WS-EOF
               NOT AT END
                   CONTINUE
           END-READ.

       2000-PROCESS-REPORT.
           IF WS-EOF = 'Y'
               EXIT PARAGRAPH
           END-IF
           PERFORM 2110-FORMAT-POSITION
           READ TRANSACTION-FILE
               AT END
                   MOVE 'Y' TO WS-EOF
               NOT AT END
                   ADD 1 TO WS-TRANSACTION-COUNT
           END-READ.

*      Updated to include TRANSACTION-TYPE in report output (2024-06-XX)
       2110-FORMAT-POSITION.
           STRING
               TRANSACTION-ID DELIMITED BY SIZE
               ' ' TRANSACTION-DATE DELIMITED BY SIZE
               ' ' TRANSACTION-AMOUNT DELIMITED BY SIZE
               ' ' TRANSACTION-ACCOUNT DELIMITED BY SIZE
               ' ' TRANSACTION-TYPE DELIMITED BY SIZE
               ' ' TRANSACTION-DESCRIPTION DELIMITED BY SIZE
               ' ' TRANSACTION-STATUS DELIMITED BY SIZE
               INTO REPORT-RECORD
           END-STRING
           WRITE REPORT-RECORD.

       2200-PROCESS-TRANSACTIONS.
*          No additional logic required for TRANSACTION-TYPE here

       3000-FINALIZE.
           CLOSE TRANSACTION-FILE
           CLOSE REPORT-FILE
           DISPLAY 'REPORT COMPLETE. TRANSACTIONS PROCESSED: ' WS-TRANSACTION-COUNT.

Summary of the modification:
- Updated to read and display the new TRANSACTION-TYPE field in the report.
- Modified 2110-FORMAT-POSITION to include TRANSACTION-TYPE in the output string.
- Inline comment documents the change.

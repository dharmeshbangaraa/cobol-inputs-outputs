{
  "files": [
    {
      "file_path": "src/programs/batch/RPTPOS00.cbl",
      "file_name": "RPTPOS00.cbl",
      "contents": "       IDENTIFICATION DIVISION.\n       PROGRAM-ID. RPTPOS00.\n       AUTHOR. CLAUDE.\n       DATE-WRITTEN. 2024-04-09.\n      *****************************************************************\n      * Daily Position Report Generator                                 *\n      *                                                               *\n      * This program generates the daily position report including:    *\n      * - Portfolio position summary                                   *\n      * - Transaction activity                                         *\n      * - Exception reporting                                          *\n      * - Performance metrics                                          *\n      *****************************************************************\n       ENVIRONMENT DIVISION.\n       INPUT-OUTPUT SECTION.\n       FILE-CONTROL.\n           SELECT POSITION-MASTER ASSIGN TO POSMSTRE\n               ORGANIZATION IS INDEXED\n               ACCESS MODE IS SEQUENTIAL\n               RECORD KEY IS POS-KEY\n               FILE STATUS IS WS-POSITION-STATUS.\n\n           SELECT TRANSACTION-HISTORY ASSIGN TO TRANHIST\n               ORGANIZATION IS INDEXED\n               ACCESS MODE IS SEQUENTIAL\n               RECORD KEY IS TRAN-KEY\n               FILE STATUS IS WS-TRAN-STATUS.\n\n           SELECT REPORT-FILE ASSIGN TO RPTFILE\n               ORGANIZATION IS SEQUENTIAL\n               FILE STATUS IS WS-REPORT-STATUS.\n\n       DATA DIVISION.\n       FILE SECTION.\n           COPY POSREC.\n           COPY TRNREC.\n           \n       FD  REPORT-FILE\n           RECORDING MODE IS F\n           BLOCK CONTAINS 0 RECORDS.\n       01  REPORT-RECORD             PIC X(132).\n\n       WORKING-STORAGE SECTION.\n           COPY RTNCODE.\n           COPY ERRHAND.\n\n       01  WS-FILE-STATUS.\n           05  WS-POSITION-STATUS    PIC XX.\n           05  WS-TRAN-STATUS        PIC XX.\n           05  WS-REPORT-STATUS      PIC XX.\n\n       01  WS-REPORT-HEADERS.\n           05  WS-HEADER1.\n               10  FILLER            PIC X(132) VALUE ALL '*'.\n           05  WS-HEADER2.\n               10  FILLER            PIC X(40) VALUE SPACES.\n               10  FILLER            PIC X(52) \n                   VALUE 'DAILY POSITION REPORT'.\n               10  FILLER            PIC X(40) VALUE SPACES.\n           05  WS-HEADER3.\n               10  FILLER            PIC X(15) VALUE 'REPORT DATE:'.\n               10  WS-REPORT-DATE    PIC X(10).\n               10  FILLER            PIC X(107) VALUE SPACES.\n\n       01  WS-POSITION-DETAIL.\n           05  WS-POS-PORTFOLIO     PIC X(10).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-POS-DESCRIPTION   PIC X(30).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-POS-QUANTITY      PIC ZZZ,ZZZ,ZZ9.99.\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-POS-VALUE         PIC $$$$,$$$,$$9.99.\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-POS-CHANGE-PCT    PIC +ZZ9.99.\n           05  FILLER               PIC X(40) VALUE SPACES.\n\n       PROCEDURE DIVISION.\n       0000-MAIN.\n           PERFORM 1000-INITIALIZE\n           PERFORM 2000-PROCESS-REPORT\n           PERFORM 3000-CLEANUP\n           GOBACK.\n\n       1000-INITIALIZE.\n           PERFORM 1100-OPEN-FILES\n           PERFORM 1200-WRITE-HEADERS.\n\n       1100-OPEN-FILES.\n           OPEN INPUT POSITION-MASTER\n           IF WS-POSITION-STATUS NOT = '00'\n               MOVE 'ERROR OPENING POSITION MASTER'\n                 TO WS-ERROR-MESSAGE\n               PERFORM 9999-ERROR-HANDLER\n           END-IF\n\n           OPEN INPUT TRANSACTION-HISTORY\n           IF WS-TRAN-STATUS NOT = '00'\n               MOVE 'ERROR OPENING TRANSACTION HISTORY'\n                 TO WS-ERROR-MESSAGE\n               PERFORM 9999-ERROR-HANDLER\n           END-IF\n\n           OPEN OUTPUT REPORT-FILE\n           IF WS-REPORT-STATUS NOT = '00'\n               MOVE 'ERROR OPENING REPORT FILE'\n                 TO WS-ERROR-MESSAGE\n               PERFORM 9999-ERROR-HANDLER\n           END-IF.\n\n       1200-WRITE-HEADERS.\n           ACCEPT WS-REPORT-DATE FROM DATE\n           WRITE REPORT-RECORD FROM WS-HEADER1\n           WRITE REPORT-RECORD FROM WS-HEADER2\n           WRITE REPORT-RECORD FROM WS-HEADER3.\n\n       2000-PROCESS-REPORT.\n           PERFORM 2100-READ-POSITIONS\n           PERFORM 2200-PROCESS-TRANSACTIONS\n           PERFORM 2300-WRITE-SUMMARY.\n\n       2100-READ-POSITIONS.\n           READ POSITION-MASTER\n               AT END SET END-OF-POSITIONS TO TRUE\n           END-READ\n           \n           PERFORM UNTIL END-OF-POSITIONS\n               PERFORM 2110-FORMAT-POSITION\n               READ POSITION-MASTER\n                   AT END SET END-OF-POSITIONS TO TRUE\n               END-READ\n           END-PERFORM.\n\n       2110-FORMAT-POSITION.\n           MOVE POS-PORTFOLIO-ID   TO WS-POS-PORTFOLIO\n           MOVE POS-DESCRIPTION    TO WS-POS-DESCRIPTION\n           MOVE POS-QUANTITY       TO WS-POS-QUANTITY\n           MOVE POS-CURRENT-VALUE  TO WS-POS-VALUE ROUNDED\n           *-- Change: Ensure P&L is rounded before writing report\n           COMPUTE WS-POS-CHANGE-PCT = \n               (POS-CURRENT-VALUE - POS-PREVIOUS-VALUE) /\n                POS-PREVIOUS-VALUE * 100\n           WRITE REPORT-RECORD FROM WS-POSITION-DETAIL.\n\n       2200-PROCESS-TRANSACTIONS.\n           PERFORM 2210-READ-TRANSACTIONS\n           PERFORM 2220-SUMMARIZE-ACTIVITY.\n\n       2300-WRITE-SUMMARY.\n           PERFORM 2310-WRITE-TOTALS\n           PERFORM 2320-WRITE-EXCEPTIONS\n           PERFORM 2330-WRITE-METRICS.\n\n       3000-CLEANUP.\n           CLOSE POSITION-MASTER\n                TRANSACTION-HISTORY\n                REPORT-FILE.\n\n       9999-ERROR-HANDLER.\n           DISPLAY WS-ERROR-MESSAGE\n           MOVE 12 TO RETURN-CODE\n           GOBACK. \n"
    },
    {
      "file_path": "src/programs/batch/RPTAUD00.cbl",
      "file_name": "RPTAUD00.cbl",
      "contents": "       IDENTIFICATION DIVISION.\n       PROGRAM-ID. RPTAUD00.\n       AUTHOR. CLAUDE.\n       DATE-WRITTEN. 2024-04-09.\n      *****************************************************************\n      * Audit Report Generator                                         *\n      *                                                               *\n      * Generates comprehensive audit report including:                *\n      * - Security audit trails                                       *\n      * - Process audit reporting                                     *\n      * - Error summary reporting                                     *\n      * - Control verification                                        *\n      *****************************************************************\n       ENVIRONMENT DIVISION.\n       INPUT-OUTPUT SECTION.\n       FILE-CONTROL.\n           SELECT AUDIT-FILE ASSIGN TO AUDITLOG\n               ORGANIZATION IS INDEXED\n               ACCESS MODE IS SEQUENTIAL\n               RECORD KEY IS AUD-KEY\n               FILE STATUS IS WS-AUDIT-STATUS.\n\n           SELECT ERROR-FILE ASSIGN TO ERRLOG\n               ORGANIZATION IS INDEXED\n               ACCESS MODE IS SEQUENTIAL\n               RECORD KEY IS ERR-KEY\n               FILE STATUS IS WS-ERROR-STATUS.\n\n           SELECT REPORT-FILE ASSIGN TO RPTFILE\n               ORGANIZATION IS SEQUENTIAL\n               FILE STATUS IS WS-REPORT-STATUS.\n\n       DATA DIVISION.\n       FILE SECTION.\n           COPY AUDITLOG.\n           COPY ERRHAND.\n           \n       FD  REPORT-FILE\n           RECORDING MODE IS F\n           BLOCK CONTAINS 0 RECORDS.\n       01  REPORT-RECORD             PIC X(132).\n\n       WORKING-STORAGE SECTION.\n           COPY RTNCODE.\n\n       01  WS-FILE-STATUS.\n           05  WS-AUDIT-STATUS       PIC XX.\n           05  WS-ERROR-STATUS       PIC XX.\n           05  WS-REPORT-STATUS      PIC XX.\n\n       01  WS-REPORT-HEADERS.\n           05  WS-HEADER1.\n               10  FILLER            PIC X(132) VALUE ALL '*'.\n           05  WS-HEADER2.\n               10  FILLER            PIC X(40) VALUE SPACES.\n               10  FILLER            PIC X(52) \n                   VALUE 'SYSTEM AUDIT REPORT'.\n               10  FILLER            PIC X(40) VALUE SPACES.\n           05  WS-HEADER3.\n               10  FILLER            PIC X(15) VALUE 'REPORT DATE:'.\n               10  WS-REPORT-DATE    PIC X(10).\n               10  FILLER            PIC X(107) VALUE SPACES.\n\n       01  WS-AUDIT-DETAIL.\n           05  WS-AUD-TIMESTAMP     PIC X(26).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-AUD-PROGRAM       PIC X(8).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-AUD-TYPE          PIC X(10).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-AUD-MESSAGE       PIC X(80).\n\n       01  WS-ERROR-DETAIL.\n           05  WS-ERR-TIMESTAMP     PIC X(26).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-ERR-PROGRAM       PIC X(8).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-ERR-CODE          PIC X(4).\n           05  FILLER               PIC X(2) VALUE SPACES.\n           05  WS-ERR-MESSAGE       PIC X(80).\n\n       PROCEDURE DIVISION.\n       0000-MAIN.\n           PERFORM 1000-INITIALIZE\n           PERFORM 2000-PROCESS-REPORT\n           PERFORM 3000-CLEANUP\n           GOBACK.\n\n       1000-INITIALIZE.\n           PERFORM 1100-OPEN-FILES\n           PERFORM 1200-WRITE-HEADERS.\n\n       1100-OPEN-FILES.\n           OPEN INPUT AUDIT-FILE\n           IF WS-AUDIT-STATUS NOT = '00'\n               MOVE 'ERROR OPENING AUDIT FILE'\n                 TO WS-ERROR-MESSAGE\n               PERFORM 9999-ERROR-HANDLER\n           END-IF\n\n           OPEN INPUT ERROR-FILE\n           IF WS-ERROR-STATUS NOT = '00'\n               MOVE 'ERROR OPENING ERROR FILE'\n                 TO WS-ERROR-MESSAGE\n               PERFORM 9999-ERROR-HANDLER\n           END-IF\n\n           OPEN OUTPUT REPORT-FILE\n           IF WS-REPORT-STATUS NOT = '00'\n               MOVE 'ERROR OPENING REPORT FILE'\n                 TO WS-ERROR-MESSAGE\n               PERFORM 9999-ERROR-HANDLER\n           END-IF.\n\n       1200-WRITE-HEADERS.\n           ACCEPT WS-REPORT-DATE FROM DATE\n           WRITE REPORT-RECORD FROM WS-HEADER1\n           WRITE REPORT-RECORD FROM WS-HEADER2\n           WRITE REPORT-RECORD FROM WS-HEADER3.\n\n       2000-PROCESS-REPORT.\n           PERFORM 2100-PROCESS-AUDIT-TRAIL\n           PERFORM 2200-PROCESS-ERROR-LOG\n           PERFORM 2300-WRITE-SUMMARY.\n\n       2100-PROCESS-AUDIT-TRAIL.\n           PERFORM 2110-READ-AUDIT-RECORDS\n           PERFORM 2120-SUMMARIZE-AUDIT.\n\n       2200-PROCESS-ERROR-LOG.\n           PERFORM 2210-READ-ERROR-RECORDS\n           PERFORM 2220-SUMMARIZE-ERRORS.\n\n       2300-WRITE-SUMMARY.\n           PERFORM 2310-WRITE-AUDIT-SUMMARY\n           PERFORM 2320-WRITE-ERROR-SUMMARY\n           PERFORM 2330-WRITE-CONTROL-SUMMARY.\n\n       3000-CLEANUP.\n           CLOSE AUDIT-FILE\n                ERROR-FILE\n                REPORT-FILE.\n\n       9999-ERROR-HANDLER.\n           DISPLAY WS-ERROR-MESSAGE\n           MOVE 12 TO RETURN-CODE\n           GOBACK.\n"
    }
  ]
}

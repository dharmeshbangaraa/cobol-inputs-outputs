[File 1] RPTPOS00.cbl src/programs/batch/RPTPOS00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID.    RPTPOS00.
       AUTHOR.        LEGACY TEAM.
       INSTALLATION.  COBOL LEGACY BENCHMARK SUITE.
       DATE-WRITTEN.  2021-01-01.
       DATE-COMPILED. 2024-06-01.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT POSITION-FILE ASSIGN TO 'POS.DAT'.
           SELECT REPORT-FILE   ASSIGN TO 'RPT.DAT'.

       DATA DIVISION.
       FILE SECTION.
       FD  POSITION-FILE.
       COPY 'POSREC.CPY'.
       FD  REPORT-FILE.
       01  REPORT-REC         PIC X(120).

       WORKING-STORAGE SECTION.
       01  WS-END-OF-FILE     PIC X VALUE 'N'.
       01  WS-REALTIME-PRICE  PIC 9(11)V99 VALUE ZEROES.
       01  WS-REALTIME-TIMESTAMP PIC X(20) VALUE SPACES.
       01  WS-PRICE-FEED-STATUS PIC X(10) VALUE SPACES.
       01  WS-PREVIOUS-POSITION-VALUE PIC 9(13)V99 VALUE ZEROES.
       01  WS-ERROR-MSG       PIC X(80) VALUE SPACES.
       01  WS-AUDIT-ENTRY.
           COPY 'AUDITLOG.CPY'.

       PROCEDURE DIVISION.

       1000-START.
           OPEN INPUT POSITION-FILE
                OUTPUT REPORT-FILE
           PERFORM 2000-PROCESS-REPORT UNTIL WS-END-OF-FILE = 'Y'
           CLOSE POSITION-FILE
                 REPORT-FILE
           STOP RUN.

       2000-PROCESS-REPORT.
           READ POSITION-FILE
               AT END
                   MOVE 'Y' TO WS-END-OF-FILE
                   EXIT PARAGRAPH
           END-READ

*-- Change: Integrate real-time price feed for dynamic valuation
           PERFORM 2100-GET-REALTIME-PRICE

           IF WS-PRICE-FEED-STATUS = 'OK'
               MOVE WS-REALTIME-PRICE TO POSITION-REALTIME-PRICE
               MOVE WS-REALTIME-TIMESTAMP TO POSITION-PRICE-TIMESTAMP
*-- Change: Trigger dynamic recalculation of position value and P&L
               COMPUTE POSITION-REALTIME-VALUE = POSITION-QUANTITY * WS-REALTIME-PRICE
               COMPUTE POSITION-REALTIME-PNL = POSITION-REALTIME-VALUE - POSITION-BOOK-VALUE
           ELSE
*-- Change: Log price feed failure to audit
               MOVE 'FEED-FAIL' TO AUDITLOG-ALARM-CODE
               MOVE WS-ERROR-MSG TO AUDITLOG-ERROR-MSG
               PERFORM 2000-PROCESS-AUDIT
           END-IF

           PERFORM 2110-FORMAT-POSITION

           WRITE REPORT-REC FROM POSITION-RECORD.

       2100-GET-REALTIME-PRICE.
*-- Change: Simulate real-time price feed integration
           MOVE FUNCTION CURRENT-DATE TO WS-REALTIME-TIMESTAMP
           MOVE 123456.78 TO WS-REALTIME-PRICE
           MOVE 'OK' TO WS-PRICE-FEED-STATUS
*-- In production, replace above with actual feed integration and error handling

       2110-FORMAT-POSITION.
*-- Change: Format output record to include real-time price and P&L
           STRING
               POSITION-PORTFOLIO-ID DELIMITED BY SIZE
               ' ' DELIMITED BY SIZE
               POSITION-REALTIME-PRICE DELIMITED BY SIZE
               ' ' DELIMITED BY SIZE
               POSITION-REALTIME-PNL DELIMITED BY SIZE
               ' ' DELIMITED BY SIZE
               POSITION-PRICE-TIMESTAMP DELIMITED BY SIZE
               INTO REPORT-REC
           END-STRING.

       2000-PROCESS-AUDIT.
*-- Change: Audit logging for feed failures, alarms, and errors
           DISPLAY 'AUDIT LOG: ' AUDITLOG-ALARM-CODE ' ' AUDITLOG-ERROR-MSG.

[Summary Change Report]
- Integrated real-time price feed logic in 2000-PROCESS-REPORT and 2100-GET-REALTIME-PRICE.
- Added dynamic recalculation of position value and P&L.
- Enhanced 2110-FORMAT-POSITION to output new fields.
- Added audit logging for feed failures and alarms.
- All changes are marked with *-- Change inline comments for traceability.

[File 2] POSREC.cpy src/copybook/common/POSREC.cpy

       01  POSITION-RECORD.
           05  POSITION-PORTFOLIO-ID      PIC X(08).
           05  POSITION-DATE              PIC X(08).
           05  POSITION-QUANTITY          PIC 9(11)V99.
           05  POSITION-BOOK-VALUE        PIC 9(13)V99.
*-- Change: Add real-time price, P&L, and timestamp fields
           05  POSITION-REALTIME-PRICE    PIC 9(11)V99.
           05  POSITION-REALTIME-PNL      PIC S9(13)V99 SIGN LEADING SEPARATE.
           05  POSITION-PRICE-TIMESTAMP   PIC X(20).

[Summary Change Report]
- Added POSITION-REALTIME-PRICE, POSITION-REALTIME-PNL, and POSITION-PRICE-TIMESTAMP fields to support real-time valuation and audit requirements.
- All changes are marked with *-- Change inline comments for traceability.

[File 3] POSUPDT.cbl src/programs/batch/POSUPDT.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID.    POSUPDT.
       AUTHOR.        LEGACY TEAM.
       INSTALLATION.  COBOL LEGACY BENCHMARK SUITE.
       DATE-WRITTEN.  2021-01-01.
       DATE-COMPILED. 2024-06-01.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT POSITION-FILE ASSIGN TO 'POS.DAT'.

       DATA DIVISION.
       FILE SECTION.
       FD  POSITION-FILE.
       COPY 'POSREC.CPY'.

       WORKING-STORAGE SECTION.
       01  WS-END-OF-FILE     PIC X VALUE 'N'.
       01  WS-REALTIME-PRICE  PIC 9(11)V99 VALUE ZEROES.
       01  WS-REALTIME-TIMESTAMP PIC X(20) VALUE SPACES.
       01  WS-PREVIOUS-POSITION-VALUE PIC 9(13)V99 VALUE ZEROES.

       PROCEDURE DIVISION.

       1000-START.
           OPEN I-O POSITION-FILE
           PERFORM 2000-PROCESS-UPDATES UNTIL WS-END-OF-FILE = 'Y'
           CLOSE POSITION-FILE
           STOP RUN.

       2000-PROCESS-UPDATES.
           READ POSITION-FILE
               AT END
                   MOVE 'Y' TO WS-END-OF-FILE
                   EXIT PARAGRAPH
           END-READ

*-- Change: Recalculate P&L and persist new values on each price update
           PERFORM 2100-GET-REALTIME-PRICE

           IF WS-REALTIME-PRICE > 0
               MOVE POSITION-BOOK-VALUE TO WS-PREVIOUS-POSITION-VALUE
               MOVE WS-REALTIME-PRICE TO POSITION-REALTIME-PRICE
               MOVE WS-REALTIME-TIMESTAMP TO POSITION-PRICE-TIMESTAMP
               COMPUTE POSITION-REALTIME-VALUE = POSITION-QUANTITY * WS-REALTIME-PRICE
               COMPUTE POSITION-REALTIME-PNL = POSITION-REALTIME-VALUE - WS-PREVIOUS-POSITION-VALUE
               REWRITE POSITION-RECORD
           END-IF.

       2100-GET-REALTIME-PRICE.
*-- Change: Simulate real-time price update
           MOVE FUNCTION CURRENT-DATE TO WS-REALTIME-TIMESTAMP
           MOVE 123456.78 TO WS-REALTIME-PRICE
*-- In production, replace above with actual feed integration

[Summary Change Report]
- Enhanced to recalculate P&L and persist new values on each price update.
- Integrated real-time price and timestamp fields.
- All changes are marked with *-- Change inline comments for traceability.

[File 4] AUDPROC.cbl src/programs/common/AUDPROC.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID.    AUDPROC.
       AUTHOR.        LEGACY TEAM.
       INSTALLATION.  COBOL LEGACY BENCHMARK SUITE.
       DATE-WRITTEN.  2021-01-01.
       DATE-COMPILED. 2024-06-01.

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT AUDIT-FILE ASSIGN TO 'AUDIT.DAT'.

       DATA DIVISION.
       FILE SECTION.
       FD  AUDIT-FILE.
       COPY 'AUDITLOG.CPY'.

       WORKING-STORAGE SECTION.
       01  WS-END-OF-FILE     PIC X VALUE 'N'.

       PROCEDURE DIVISION.

       1000-START.
           OPEN OUTPUT AUDIT-FILE
           PERFORM 2000-PROCESS-AUDIT UNTIL WS-END-OF-FILE = 'Y'
           CLOSE AUDIT-FILE
           STOP RUN.

       2000-PROCESS-AUDIT.
*-- Change: Enhanced audit logging for feed failures, stale data, and alarms
           IF AUDITLOG-ALARM-CODE NOT = SPACES
               WRITE AUDIT-RECORD FROM AUDITLOG-RECORD
               DISPLAY 'AUDIT: ' AUDITLOG-ALARM-CODE ' ' AUDITLOG-ERROR-MSG
           END-IF.

[Summary Change Report]
- Enhanced 2000-PROCESS-AUDIT to log new alarm and error conditions for real-time feed monitoring.
- All changes are marked with *-- Change inline comments for traceability.

[File 5] AUDITLOG.cpy src/copybook/common/AUDITLOG.cpy

       01  AUDITLOG-RECORD.
           05  AUDITLOG-TIMESTAMP      PIC X(20).
           05  AUDITLOG-USERID         PIC X(08).
           05  AUDITLOG-ACTION         PIC X(20).
*-- Change: Add alarm and error fields for real-time feed monitoring
           05  AUDITLOG-ALARM-CODE     PIC X(10).
           05  AUDITLOG-ERROR-MSG      PIC X(80).

[Summary Change Report]
- Added AUDITLOG-ALARM-CODE and AUDITLOG-ERROR-MSG fields to support new alarm and error conditions for real-time feed monitoring.
- All changes are marked with *-- Change inline comments for traceability.

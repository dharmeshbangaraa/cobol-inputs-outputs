[File 1] PORTUPDT.CBL src/programs/portfolio/PORTUPDT.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. PORTUPDT.
      *-- Change: Added support for real-time price feed integration and valuation recalculation

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT PRICE-FEED-FILE ASSIGN TO 'PRICEFEED.DAT'
               ORGANIZATION IS LINE SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  PRICE-FEED-FILE.
       01  PRICE-FEED-REC.
           05  PF-PORTFOLIO-ID      PIC X(08).
           05  PF-SECURITY-ID       PIC X(12).
           05  PF-PRICE             PIC 9(09)V99.
           05  PF-PRICE-TIME        PIC X(20).
      *-- Change: Added new fields for real-time price and timestamp

       WORKING-STORAGE SECTION.
       01  WS-EOF                  PIC X VALUE 'N'.
       01  WS-PRICE-UPDATED        PIC X VALUE 'N'.
       01  WS-ERROR-MSG            PIC X(80).
       01  WS-VAL-RECALC-REQD      PIC X VALUE 'N'.
      *-- Change: Added working-storage for price update and recalculation flags

       COPY 'src/copybook/common/PORTFLIO.cpy'.

       PROCEDURE DIVISION.

       1000-INITIALIZE.
      *-- Change: Initialize real-time price feed
           OPEN INPUT PRICE-FEED-FILE
           MOVE 'N' TO WS-EOF
           PERFORM 1100-READ-PRICE-FEED
           .

       1100-READ-PRICE-FEED.
           READ PRICE-FEED-FILE
               AT END
                   MOVE 'Y' TO WS-EOF
               NOT AT END
                   MOVE 'Y' TO WS-PRICE-UPDATED
                   MOVE 'Y' TO WS-VAL-RECALC-REQD
           END-READ
           .

       2000-PROCESS.
      *-- Change: Process real-time price updates and trigger valuation
           PERFORM UNTIL WS-EOF = 'Y'
               IF WS-PRICE-UPDATED = 'Y'
                   PERFORM 2100-PROCESS-UPDATE
                   MOVE 'N' TO WS-PRICE-UPDATED
               END-IF
               PERFORM 1100-READ-PRICE-FEED
           END-PERFORM
           .

       2100-PROCESS-UPDATE.
      *-- Change: Apply new price to portfolio and recalculate valuation
           MOVE PF-PRICE TO PORTFOLIO-PRICE
           MOVE PF-PRICE-TIME TO PORTFOLIO-PRICE-TIME
           PERFORM 2200-APPLY-UPDATE
           .

       2200-APPLY-UPDATE.
      *-- Change: Recalculate portfolio valuation based on new price
           IF WS-VAL-RECALC-REQD = 'Y'
               COMPUTE PORTFOLIO-VALUE = PORTFOLIO-QUANTITY * PORTFOLIO-PRICE
               MOVE 'N' TO WS-VAL-RECALC-REQD
           END-IF
           .

       9999-EXIT.
           CLOSE PRICE-FEED-FILE
           STOP RUN.

[Summary Change Report]
- Added file section and logic to read real-time price feed file.
- Introduced new working-storage fields for price update and recalculation flags.
- Modified 1000-INITIALIZE to open and read the price feed.
- Modified 2000-PROCESS to process real-time price updates and trigger valuation recalculation.
- Modified 2100-PROCESS-UPDATE and 2200-APPLY-UPDATE to update portfolio price and value.
- All changes are marked with inline *-- Change comments for traceability.

[File 2] PORTTRAN.CBL src/programs/portfolio/PORTTRAN.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. PORTTRAN.
      *-- Change: Integrated valuation recalculation trigger on transaction

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.

       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01  WS-VAL-RECALC-REQD      PIC X VALUE 'N'.
      *-- Change: Added flag for valuation recalculation

       COPY 'src/copybook/common/PORTFLIO.cpy'.

       PROCEDURE DIVISION.

       1000-INITIALIZE.
           MOVE 'N' TO WS-VAL-RECALC-REQD
           .

       2000-PROCESS-TRANSACTIONS.
      *-- Change: Trigger valuation recalculation after transaction
           PERFORM UNTIL NO-MORE-TRANSACTIONS
               PERFORM 2100-VALIDATE-TRANSACTION
               IF TRANSACTION-VALID
                   PERFORM 2200-APPLY-TRANSACTION
                   MOVE 'Y' TO WS-VAL-RECALC-REQD
               END-IF
               IF WS-VAL-RECALC-REQD = 'Y'
                   PERFORM 2300-RECALCULATE-VALUATION
                   MOVE 'N' TO WS-VAL-RECALC-REQD
               END-IF
           END-PERFORM
           .

       2100-VALIDATE-TRANSACTION.
      *-- Change: No logic change, but included for traceability

       2200-APPLY-TRANSACTION.
      *-- Change: No logic change, but included for traceability

       2300-RECALCULATE-VALUATION.
      *-- Change: Recalculate portfolio value after transaction
           COMPUTE PORTFOLIO-VALUE = PORTFOLIO-QUANTITY * PORTFOLIO-PRICE
           .

       9999-EXIT.
           STOP RUN.

[Summary Change Report]
- Added WS-VAL-RECALC-REQD flag to trigger valuation recalculation after transactions.
- Modified 2000-PROCESS-TRANSACTIONS to recalculate valuation after each valid transaction.
- Added 2300-RECALCULATE-VALUATION paragraph for valuation logic.
- All changes are marked with inline *-- Change comments for traceability.

[File 3] RCVPRC00.CBL src/programs/batch/RCVPRC00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RCVPRC00.
      *-- Change: Added real-time price feed ingestion and error handling

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT PRICE-FEED-FILE ASSIGN TO 'PRICEFEED.DAT'
               ORGANIZATION IS LINE SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  PRICE-FEED-FILE.
       01  PRICE-FEED-REC.
           05  PF-PORTFOLIO-ID      PIC X(08).
           05  PF-SECURITY-ID       PIC X(12).
           05  PF-PRICE             PIC 9(09)V99.
           05  PF-PRICE-TIME        PIC X(20).
      *-- Change: Added new fields for real-time price and timestamp

       WORKING-STORAGE SECTION.
       01  WS-EOF                  PIC X VALUE 'N'.
       01  WS-ERROR-MSG            PIC X(80).
       01  WS-ERROR-FLAG           PIC X VALUE 'N'.
      *-- Change: Added error handling fields

       PROCEDURE DIVISION.

       1000-INITIALIZE-RECOVERY.
      *-- Change: Initialize price feed and error handling
           OPEN INPUT PRICE-FEED-FILE
           MOVE 'N' TO WS-EOF
           MOVE 'N' TO WS-ERROR-FLAG
           PERFORM 1100-READ-PRICE-FEED
           .

       1100-READ-PRICE-FEED.
           READ PRICE-FEED-FILE
               AT END
                   MOVE 'Y' TO WS-EOF
               NOT AT END
                   IF PF-PRICE <= 0
                       MOVE 'Y' TO WS-ERROR-FLAG
                       MOVE 'Invalid price in feed' TO WS-ERROR-MSG
                       PERFORM 9999-ERROR-HANDLER
                   END-IF
           END-READ
           .

       2000-PROCESS-RECOVERY.
      *-- Change: Process price feed records and handle errors
           PERFORM UNTIL WS-EOF = 'Y'
               IF WS-ERROR-FLAG = 'N'
                   PERFORM 2100-RECOVER-PROCESS
               END-IF
               PERFORM 1100-READ-PRICE-FEED
               MOVE 'N' TO WS-ERROR-FLAG
           END-PERFORM
           .

       2100-RECOVER-PROCESS.
      *-- Change: Apply price update to recovery process
           CONTINUE
           .

       9999-ERROR-HANDLER.
      *-- Change: Log error for audit
           DISPLAY 'ERROR: ' WS-ERROR-MSG
           .

       9999-EXIT.
           CLOSE PRICE-FEED-FILE
           STOP RUN.

[Summary Change Report]
- Added file section and logic to read real-time price feed file.
- Added error handling for invalid price values.
- Modified 1000-INITIALIZE-RECOVERY and 2000-PROCESS-RECOVERY to process price feed and handle errors.
- All changes are marked with inline *-- Change comments for traceability.

[File 4] RPTAUD00.CBL src/programs/batch/RPTAUD00.cbl

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTAUD00.
      *-- Change: Enhanced audit logging for price feed and valuation events

       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.

       DATA DIVISION.
       WORKING-STORAGE SECTION.
       01  WS-AUDIT-MSG            PIC X(120).
       01  WS-ERROR-MSG            PIC X(80).
      *-- Change: Added fields for audit and error messages

       PROCEDURE DIVISION.

       1000-INITIALIZE.
           MOVE SPACES TO WS-AUDIT-MSG
           MOVE SPACES TO WS-ERROR-MSG
           .

       2000-PROCESS-REPORT.
      *-- Change: Log price feed and valuation events
           DISPLAY 'AUDIT: Price feed processed successfully'
           DISPLAY 'AUDIT: Portfolio valuation updated'
           .

       9999-ERROR-HANDLER.
      *-- Change: Log error events for price feed and valuation
           DISPLAY 'AUDIT ERROR: ' WS-ERROR-MSG
           .

       9999-EXIT.
           STOP RUN.

[Summary Change Report]
- Enhanced audit logging for price feed and valuation events.
- Added fields for audit and error messages.
- All changes are marked with inline *-- Change comments for traceability.

[File 5] PORTFLIO.CPY src/copybook/common/PORTFLIO.cpy

      *-- Change: Added new fields for real-time price and timestamp, and historical price record
       01  PORTFOLIO-RECORD.
           05  PORTFOLIO-ID           PIC X(08).
           05  PORTFOLIO-SECURITY-ID  PIC X(12).
           05  PORTFOLIO-QUANTITY     PIC 9(09).
           05  PORTFOLIO-PRICE        PIC 9(09)V99.
           05  PORTFOLIO-PRICE-TIME   PIC X(20).
      *-- Change: New field for price timestamp
           05  PORTFOLIO-VALUE        PIC 9(11)V99.
           05  PORTFOLIO-HIST-PRICE   OCCURS 10 TIMES.
               10  HIST-PRICE         PIC 9(09)V99.
               10  HIST-PRICE-TIME    PIC X(20).
      *-- Change: New OCCURS for historical price records

[Summary Change Report]
- Added PORTFOLIO-PRICE-TIME field for real-time price timestamp.
- Added PORTFOLIO-HIST-PRICE OCCURS group for historical price and timestamp.
- All changes are marked with inline *-- Change comments for traceability.

TRNREC.cpy /COBOL-Legacy-Benchmark-Suite-main/COBOL-Legacy-Benchmark-Suite-main/src/copybook/common/TRNREC.cpy

```
      *****************************************************************
      * TRANSACTION RECORD STRUCTURE
      * VERSION: 1.0
      * DATE: 2024
      *****************************************************************
       01  TRANSACTION-RECORD.
           05  TRN-KEY.
               10  TRN-DATE           PIC X(08).
               10  TRN-TIME           PIC X(06).
               10  TRN-PORTFOLIO-ID   PIC X(08).
               10  TRN-SEQUENCE-NO    PIC X(06).
           05  TRN-DATA.
               10  TRN-INVESTMENT-ID  PIC X(10).
               10  TRN-TYPE           PIC X(02).
                   88  TRN-TYPE-BUY     VALUE 'BU'.
                   88  TRN-TYPE-SELL    VALUE 'SL'.
                   88  TRN-TYPE-TRANS   VALUE 'TR'.
                   88  TRN-TYPE-FEE     VALUE 'FE'.
               10  TRN-QUANTITY       PIC S9(11)V9(4) COMP-3.
               10  TRN-PRICE         PIC S9(11)V9(4) COMP-3.
               10  TRN-AMOUNT        PIC S9(13)V9(2) COMP-3.
               10  TRN-CURRENCY      PIC X(03).
               10  TRN-STATUS        PIC X(01).
                   88  TRN-STATUS-PEND   VALUE 'P'.
                   88  TRN-STATUS-DONE   VALUE 'D'.
                   88  TRN-STATUS-FAIL   VALUE 'F'.
                   88  TRN-STATUS-REV    VALUE 'R'.
               10  TRANSACTION-TYPE   PIC X(10).
      *    ^--- Added field to record the type of each transaction (BUY, SELL, DIVIDEND, etc.)
           05  TRN-AUDIT.
               10  TRN-PROCESS-DATE  PIC X(26).
               10  TRN-PROCESS-USER  PIC X(08).
           05  TRN-FILLER           PIC X(50).
      *****************************************************************
      * FIELD DESCRIPTIONS:
      * TRN-DATE        : TRANSACTION DATE (YYYYMMDD)
      * TRN-TIME        : TRANSACTION TIME (HHMMSS)
      * TRN-PORTFOLIO-ID: PORTFOLIO IDENTIFIER
      * TRN-SEQUENCE-NO : SEQUENCE NUMBER FOR MULTIPLE TRANS
      * TRN-TYPE        : BU=BUY, SL=SELL, TR=TRANSFER, FE=FEE
      * TRANSACTION-TYPE: TYPE OF TRANSACTION (BUY, SELL, DIVIDEND, ETC.)
      * TRN-STATUS      : P=PENDING, D=DONE, F=FAILED, R=REVERSED
      ***************************************************************** 
```

Summary: Added new field TRANSACTION-TYPE (PIC X(10)) to transaction record layout for recording the type of each transaction (BUY, SELL, DIVIDEND, etc.), as per new requirements.

---

RPTPOS00.cbl /COBOL-Legacy-Benchmark-Suite-main/COBOL-Legacy-Benchmark-Suite-main/src/programs/batch/RPTPOS00.cbl

```
       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTPOS00.
       AUTHOR. CLAUDE.
       DATE-WRITTEN. 2024-04-09.
      *****************************************************************
      * Daily Position Report Generator                                 *
      *                                                               *
      * This program generates the daily position report including:    *
      * - Portfolio position summary                                   *
      * - Transaction activity                                         *
      * - Exception reporting                                          *
      * - Performance metrics                                          *
      *****************************************************************
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT POSITION-MASTER ASSIGN TO POSMSTRE
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS POS-KEY
               FILE STATUS IS WS-POSITION-STATUS.

           SELECT TRANSACTION-HISTORY ASSIGN TO TRANHIST
               ORGANIZATION IS INDEXED
               ACCESS MODE IS SEQUENTIAL
               RECORD KEY IS TRAN-KEY
               FILE STATUS IS WS-TRAN-STATUS.

           SELECT REPORT-FILE ASSIGN TO RPTFILE
               ORGANIZATION IS SEQUENTIAL
               FILE STATUS IS WS-REPORT-STATUS.

       DATA DIVISION.
       FILE SECTION.
           COPY POSREC.
           COPY TRNREC.
           
       FD  REPORT-FILE
           RECORDING MODE IS F
           BLOCK CONTAINS 0 RECORDS.
       01  REPORT-RECORD             PIC X(132).

       WORKING-STORAGE SECTION.
           COPY RTNCODE.
           COPY ERRHAND.

       01  WS-FILE-STATUS.
           05  WS-POSITION-STATUS    PIC XX.
           05  WS-TRAN-STATUS        PIC XX.
           05  WS-REPORT-STATUS      PIC XX.

       01  WS-REPORT-HEADERS.
           05  WS-HEADER1.
               10  FILLER            PIC X(132) VALUE ALL '*'.
           05  WS-HEADER2.
               10  FILLER            PIC X(40) VALUE SPACES.
               10  FILLER            PIC X(52) 
                   VALUE 'DAILY POSITION REPORT'.
               10  FILLER            PIC X(40) VALUE SPACES.
           05  WS-HEADER3.
               10  FILLER            PIC X(15) VALUE 'REPORT DATE:'.
               10  WS-REPORT-DATE    PIC X(10).
               10  FILLER            PIC X(107) VALUE SPACES.
           05  WS-HEADER4.
               10  FILLER            PIC X(15) VALUE 'TRANSACTION ACTIVITY'.
               10  FILLER            PIC X(117) VALUE SPACES.
           05  WS-HEADER5.
               10  FILLER            PIC X(10) VALUE 'DATE'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(6) VALUE 'TIME'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(8) VALUE 'PORTFOL'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(10) VALUE 'INVEST ID'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(10) VALUE 'TRN TYPE'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(10) VALUE 'TRN QTY'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(10) VALUE 'TRN AMT'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(10) VALUE 'TRN CURR'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(10) VALUE 'TRN STATUS'.
               10  FILLER            PIC X(2) VALUE SPACES.
               10  FILLER            PIC X(10) VALUE 'TRANSACTION'.
               10  FILLER            PIC X(10) VALUE 'TYPE'.  *> Added header for TRANSACTION-TYPE

       01  WS-POSITION-DETAIL.
           05  WS-POS-PORTFOLIO     PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-DESCRIPTION   PIC X(30).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-QUANTITY      PIC ZZZ,ZZZ,ZZ9.99.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-VALUE         PIC $$$$,$$$,$$9.99.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-POS-CHANGE-PCT    PIC +ZZ9.99.
           05  FILLER               PIC X(40) VALUE SPACES.

       01  WS-TRANSACTION-DETAIL.
           05  WS-TRN-DATE          PIC X(08).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TRN-TIME          PIC X(06).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TRN-PORTFOLIO     PIC X(08).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TRN-INVESTMENT    PIC X(10).
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TRN-TYPE          PIC X(02).
           05  FILLER               PIC X(8) VALUE SPACES.
           05  WS-TRN-QUANTITY      PIC -ZZZZZZZZ9.9999.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TRN-AMOUNT        PIC -ZZZZZZZZZZ9.99.
           05  FILLER               PIC X(2) VALUE SPACES.
           05  WS-TRN-CURRENCY      PIC X(03).
           05  FILLER               PIC X(7) VALUE SPACES.
           05  WS-TRN-STATUS        PIC X(01).
           05  FILLER               PIC X(9) VALUE SPACES.
           05  WS-TRANSACTION-TYPE-DISPLAY PIC X(10).
      *    ^--- Added field for displaying TRANSACTION-TYPE

       PROCEDURE DIVISION.
       0000-MAIN.
           PERFORM 1000-INITIALIZE
           PERFORM 2000-PROCESS-REPORT
           PERFORM 3000-CLEANUP
           GOBACK.

       1000-INITIALIZE.
           PERFORM 1100-OPEN-FILES
           PERFORM 1200-WRITE-HEADERS.

       1100-OPEN-FILES.
           OPEN INPUT POSITION-MASTER
           IF WS-POSITION-STATUS NOT = '00'
               MOVE 'ERROR OPENING POSITION MASTER'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN INPUT TRANSACTION-HISTORY
           IF WS-TRAN-STATUS NOT = '00'
               MOVE 'ERROR OPENING TRANSACTION HISTORY'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF

           OPEN OUTPUT REPORT-FILE
           IF WS-REPORT-STATUS NOT = '00'
               MOVE 'ERROR OPENING REPORT FILE'
                 TO WS-ERROR-MESSAGE
               PERFORM 9999-ERROR-HANDLER
           END-IF.

       1200-WRITE-HEADERS.
           ACCEPT WS-REPORT-DATE FROM DATE
           WRITE REPORT-RECORD FROM WS-HEADER1
           WRITE REPORT-RECORD FROM WS-HEADER2
           WRITE REPORT-RECORD FROM WS-HEADER3
           WRITE REPORT-RECORD FROM WS-HEADER4 *> Added header for transaction activity
           WRITE REPORT-RECORD FROM WS-HEADER5 *> Added header row for transaction columns

       2000-PROCESS-REPORT.
           PERFORM 2100-READ-POSITIONS
           PERFORM 2200-PROCESS-TRANSACTIONS
           PERFORM 2300-WRITE-SUMMARY.

       2100-READ-POSITIONS.
           READ POSITION-MASTER
               AT END SET END-OF-POSITIONS TO TRUE
           END-READ
           
           PERFORM UNTIL END-OF-POSITIONS
               PERFORM 2110-FORMAT-POSITION
               READ POSITION-MASTER
                   AT END SET END-OF-POSITIONS TO TRUE
               END-READ
           END-PERFORM.

       2110-FORMAT-POSITION.
           MOVE POS-PORTFOLIO-ID   TO WS-POS-PORTFOLIO
           MOVE POS-DESCRIPTION    TO WS-POS-DESCRIPTION
           MOVE POS-QUANTITY       TO WS-POS-QUANTITY
           MOVE POS-CURRENT-VALUE  TO WS-POS-VALUE
           COMPUTE WS-POS-CHANGE-PCT = 
               (POS-CURRENT-VALUE - POS-PREVIOUS-VALUE) /
                POS-PREVIOUS-VALUE * 100
           WRITE REPORT-RECORD FROM WS-POSITION-DETAIL.

       2200-PROCESS-TRANSACTIONS.
           READ TRANSACTION-HISTORY
               AT END SET END-OF-TRANSACTIONS TO TRUE
           END-READ
           PERFORM UNTIL END-OF-TRANSACTIONS
               PERFORM 2210-FORMAT-TRANSACTION
               READ TRANSACTION-HISTORY
                   AT END SET END-OF-TRANSACTIONS TO TRUE
               END-READ
           END-PERFORM.

       2210-FORMAT-TRANSACTION.
           MOVE TRN-DATE           TO WS-TRN-DATE
           MOVE TRN-TIME           TO WS-TRN-TIME
           MOVE TRN-PORTFOLIO-ID   TO WS-TRN-PORTFOLIO
           MOVE TRN-INVESTMENT-ID  TO WS-TRN-INVESTMENT
           MOVE TRN-TYPE           TO WS-TRN-TYPE
           MOVE TRN-QUANTITY       TO WS-TRN-QUANTITY
           MOVE TRN-AMOUNT         TO WS-TRN-AMOUNT
           MOVE TRN-CURRENCY       TO WS-TRN-CURRENCY
           MOVE TRN-STATUS         TO WS-TRN-STATUS
           IF TRANSACTION-TYPE = SPACES OR TRANSACTION-TYPE = LOW-VALUES
               MOVE 'UNKNOWN'      TO WS-TRANSACTION-TYPE-DISPLAY
           ELSE
               MOVE TRANSACTION-TYPE TO WS-TRANSACTION-TYPE-DISPLAY
           END-IF
      *    ^--- Added logic to handle missing transaction type as "UNKNOWN"
           WRITE REPORT-RECORD FROM WS-TRANSACTION-DETAIL.

       2300-WRITE-SUMMARY.
           PERFORM 2310-WRITE-TOTALS
           PERFORM 2320-WRITE-EXCEPTIONS
           PERFORM 2330-WRITE-METRICS.

       3000-CLEANUP.
           CLOSE POSITION-MASTER
                TRANSACTION-HISTORY
                REPORT-FILE.

       9999-ERROR-HANDLER.
           DISPLAY WS-ERROR-MESSAGE
           MOVE 12 TO RETURN-CODE
           GOBACK.
```

Summary: 
- Added logic and display fields in the report to include the new TRANSACTION-TYPE field from the transaction record.
- Added header columns and display logic for TRANSACTION-TYPE.
- Handles missing values by displaying "UNKNOWN" for backward compatibility.

```

This completes the required modifications and structured change report for the impacted COBOL copybook and reporting program.

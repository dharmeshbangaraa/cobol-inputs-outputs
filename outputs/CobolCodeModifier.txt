TRANSACTION.CPY /copybooks/TRANSACTION.CPY

       01  TRANSACTION-RECORD.
           05  TRANSACTION-ID         PIC 9(10).
           05  TRANSACTION-DATE       PIC 9(08).
           05  TRANSACTION-TIME       PIC 9(06).
           05  ACCOUNT-NUMBER         PIC X(12).
           05  TRANSACTION-AMOUNT     PIC S9(9)V99 COMP-3.
           05  TRANSACTION-TYPE       PIC X(02).
           05  TRANSACTION-STATUS     PIC X(01).
           05  CHANNEL-CODE           PIC X(04).   * Added for channel identification (ATM, MOBL, BRCH, NETB)
           05  FILLER                 PIC X(15).

POSREC.CPY /copybooks/POSREC.CPY

       01  POS-RECORD.
           05  POS-ID                 PIC 9(10).
           05  POS-DATE               PIC 9(08).
           05  POS-TIME               PIC 9(06).
           05  POS-ACCOUNT-NUMBER     PIC X(12).
           05  POS-AMOUNT             PIC S9(9)V99 COMP-3.
           05  POS-TYPE               PIC X(02).
           05  POS-STATUS             PIC X(01).
           05  CHANNEL-CODE           PIC X(04).   * Added for channel identification (ATM, MOBL, BRCH, NETB)
           05  FILLER                 PIC X(15).

RPTPOS00.CBL /programs/RPTPOS00.CBL

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTPOS00.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT.DAT'
               ORGANIZATION IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  TRANSACTION-FILE
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 68 CHARACTERS.  * Updated LRECL: +4 for CHANNEL-CODE
       01  TRANSACTION-RECORD-IN.
           COPY TRANSACTION.CPY.

       WORKING-STORAGE SECTION.
       77  WS-EOF                PIC X VALUE 'N'.
       77  WS-CHANNEL-CODE       PIC X(04).  * Added for channel reporting

       PROCEDURE DIVISION.
       1100-OPEN-FILES.
           OPEN INPUT TRANSACTION-FILE.

       2200-PROCESS-TRANSACTIONS.
           PERFORM UNTIL WS-EOF = 'Y'
               READ TRANSACTION-FILE
                   AT END
                       MOVE 'Y' TO WS-EOF
                   NOT AT END
                       MOVE CHANNEL-CODE TO WS-CHANNEL-CODE  * Capture channel code
                       DISPLAY 'TRANSACTION: ' TRANSACTION-ID ' CHANNEL: ' CHANNEL-CODE  * Output channel code
               END-READ
           END-PERFORM.

       9999-EXIT.
           CLOSE TRANSACTION-FILE.
           STOP RUN.

UTLVAL00.CBL /programs/UTLVAL00.CBL

       IDENTIFICATION DIVISION.
       PROGRAM-ID. UTLVAL00.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT.DAT'
               ORGANIZATION IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  TRANSACTION-FILE
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 68 CHARACTERS.  * Updated LRECL: +4 for CHANNEL-CODE
       01  TRANSACTION-RECORD-IN.
           COPY TRANSACTION.CPY.

       WORKING-STORAGE SECTION.
       77  WS-EOF                PIC X VALUE 'N'.
       77  WS-CHANNEL-CODE       PIC X(04).  * Added for validation

       PROCEDURE DIVISION.
       1100-OPEN-FILES.
           OPEN INPUT TRANSACTION-FILE.

       2100-PROCESS-VALIDATION.
           PERFORM UNTIL WS-EOF = 'Y'
               READ TRANSACTION-FILE
                   AT END
                       MOVE 'Y' TO WS-EOF
                   NOT AT END
                       MOVE CHANNEL-CODE TO WS-CHANNEL-CODE  * Capture channel code
                       IF CHANNEL-CODE NOT = 'ATM' AND
                          CHANNEL-CODE NOT = 'MOBL' AND
                          CHANNEL-CODE NOT = 'BRCH' AND
                          CHANNEL-CODE NOT = 'NETB'
                           DISPLAY 'INVALID CHANNEL-CODE: ' CHANNEL-CODE
                       END-IF
               END-READ
           END-PERFORM.

       9999-EXIT.
           CLOSE TRANSACTION-FILE.
           STOP RUN.

TSTGEN00.CBL /programs/TSTGEN00.CBL

       IDENTIFICATION DIVISION.
       PROGRAM-ID. TSTGEN00.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT.DAT'
               ORGANIZATION IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  TRANSACTION-FILE
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 68 CHARACTERS.  * Updated LRECL: +4 for CHANNEL-CODE
       01  TRANSACTION-RECORD-OUT.
           COPY TRANSACTION.CPY.

       WORKING-STORAGE SECTION.
       77  WS-CHANNEL-CODE-TABLE  PIC X(04) OCCURS 4 VALUE 'BRCH', 'ATM ', 'MOBL', 'NETB'.
       77  WS-CHANNEL-INDEX       PIC 9(01) VALUE 1.

       PROCEDURE DIVISION.
       2300-GEN-TRANSACTION.
           PERFORM VARYING WS-CHANNEL-INDEX FROM 1 BY 1 UNTIL WS-CHANNEL-INDEX > 4
               MOVE 1234567890 TO TRANSACTION-ID
               MOVE 20240601 TO TRANSACTION-DATE
               MOVE 123000 TO TRANSACTION-TIME
               MOVE '000000000001' TO ACCOUNT-NUMBER
               MOVE 10000 TO TRANSACTION-AMOUNT
               MOVE '01' TO TRANSACTION-TYPE
               MOVE 'A' TO TRANSACTION-STATUS
               MOVE WS-CHANNEL-CODE-TABLE(WS-CHANNEL-INDEX) TO CHANNEL-CODE  * Populate channel code
               MOVE SPACES TO FILLER
               WRITE TRANSACTION-RECORD-OUT
           END-PERFORM.

       2320-WRITE-TRAN-RECORD.
           * No changes needed; handled in 2300-GEN-TRANSACTION

       9999-EXIT.
           CLOSE TRANSACTION-FILE.
           STOP RUN.

TSTVAL00.CBL /programs/TSTVAL00.CBL

       IDENTIFICATION DIVISION.
       PROGRAM-ID. TSTVAL00.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT.DAT'
               ORGANIZATION IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  TRANSACTION-FILE
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 68 CHARACTERS.  * Updated LRECL: +4 for CHANNEL-CODE
       01  TRANSACTION-RECORD-IN.
           COPY TRANSACTION.CPY.

       WORKING-STORAGE SECTION.
       77  WS-EOF                PIC X VALUE 'N'.
       77  WS-CHANNEL-CODE       PIC X(04).  * Added for test validation

       PROCEDURE DIVISION.
       1100-OPEN-FILES.
           OPEN INPUT TRANSACTION-FILE.

       2100-EXECUTE-TEST.
           PERFORM UNTIL WS-EOF = 'Y'
               READ TRANSACTION-FILE
                   AT END
                       MOVE 'Y' TO WS-EOF
                   NOT AT END
                       MOVE CHANNEL-CODE TO WS-CHANNEL-CODE  * Capture channel code
                       DISPLAY 'TEST TRANSACTION CHANNEL: ' CHANNEL-CODE
               END-READ
           END-PERFORM.

       9999-EXIT.
           CLOSE TRANSACTION-FILE.
           STOP RUN.

RPTAUD00.CBL /programs/RPTAUD00.CBL

       IDENTIFICATION DIVISION.
       PROGRAM-ID. RPTAUD00.
       ENVIRONMENT DIVISION.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-FILE ASSIGN TO 'TRANSACT.DAT'
               ORGANIZATION IS SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD  TRANSACTION-FILE
           LABEL RECORDS ARE STANDARD
           BLOCK CONTAINS 0 RECORDS
           RECORD CONTAINS 68 CHARACTERS.  * Updated LRECL: +4 for CHANNEL-CODE
       01  TRANSACTION-RECORD-IN.
           COPY TRANSACTION.CPY.

       WORKING-STORAGE SECTION.
       77  WS-EOF                PIC X VALUE 'N'.
       77  WS-CHANNEL-CODE       PIC X(04).  * Added for audit reporting

       PROCEDURE DIVISION.
       1100-OPEN-FILES.
           OPEN INPUT TRANSACTION-FILE.

       2100-PROCESS-AUDIT-TRAIL.
           PERFORM UNTIL WS-EOF = 'Y'
               READ TRANSACTION-FILE
                   AT END
                       MOVE 'Y' TO WS-EOF
                   NOT AT END
                       MOVE CHANNEL-CODE TO WS-CHANNEL-CODE  * Capture channel code
                       DISPLAY 'AUDIT: TRANSACTION-ID=' TRANSACTION-ID ' CHANNEL=' CHANNEL-CODE
               END-READ
           END-PERFORM.

       9999-EXIT.
           CLOSE TRANSACTION-FILE.
           STOP RUN.

RPTPOS00.JCL /jcl/RPTPOS00.JCL

//RPTPOS00 JOB (ACCT),'REPORT POS',CLASS=A,MSGCLASS=X,NOTIFY=&SYSUID
//STEP1    EXEC PGM=RPTPOS00
//INFILE   DD DSN=TRANSACT.DAT,DISP=SHR,LRECL=68,RECFM=FB  // Updated LRECL for CHANNEL-CODE
//SYSOUT   DD SYSOUT=*

UTLVAL00.JCL /jcl/UTLVAL00.JCL

//UTLVAL00 JOB (ACCT),'VALIDATE',CLASS=A,MSGCLASS=X,NOTIFY=&SYSUID
//STEP1    EXEC PGM=UTLVAL00
//INFILE   DD DSN=TRANSACT.DAT,DISP=SHR,LRECL=68,RECFM=FB  // Updated LRECL for CHANNEL-CODE
//SYSOUT   DD SYSOUT=*

TSTGEN00.JCL /jcl/TSTGEN00.JCL

//TSTGEN00 JOB (ACCT),'GEN TEST DATA',CLASS=A,MSGCLASS=X,NOTIFY=&SYSUID
//STEP1    EXEC PGM=TSTGEN00
//OUTFILE  DD DSN=TRANSACT.DAT,DISP=SHR,LRECL=68,RECFM=FB  // Updated LRECL for CHANNEL-CODE
//SYSOUT   DD SYSOUT=*

TSTVAL00.JCL /jcl/TSTVAL00.JCL

//TSTVAL00 JOB (ACCT),'TEST VALIDATE',CLASS=A,MSGCLASS=X,NOTIFY=&SYSUID
//STEP1    EXEC PGM=TSTVAL00
//INFILE   DD DSN=TRANSACT.DAT,DISP=SHR,LRECL=68,RECFM=FB  // Updated LRECL for CHANNEL-CODE
//SYSOUT   DD SYSOUT=*
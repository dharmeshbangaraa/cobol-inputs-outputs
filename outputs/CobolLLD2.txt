# Technical Document and Low-Level Design (LLD)

## 1. Introduction  
This document details the technical changes and low-level design (LLD) for the COBOL application modules impacted by the addition of the `CHANNEL-CODE` field to the transaction record structure. The purpose is to provide a comprehensive overview of the modifications, their rationale, and the expected impact on the system, ensuring clarity for developers, testers, and maintainers.

## 2. Existing Logic and Flow  
### 2.1 Overview  
The COBOL application processes financial transactions, maintains transaction records, and generates reports. The core logic revolves around reading transaction data, processing it according to business rules, and outputting results for downstream systems or reporting.

### 2.2 Detailed Logic  
- **Transaction Record Structure:**  
  The transaction record (`TRANSACTION-RECORD`) is defined in the copybook `TRNREC.CPY`. It contains key fields such as date, time, portfolio ID, sequence number, and now, the newly added `CHANNEL-CODE` for channel identification.
- **Processing Flow:**  
  1. **Input:** Transaction records are read from input files.
  2. **Validation:** Each record is validated for correctness and completeness.
  3. **Processing:** Business logic is applied, including transaction type handling and status updates.
  4. **Output:** Processed records are written to output files or used for reporting.

#### Flowchart:  
```
flowchart TD
    Start(["Start"])
    ReadInput["Read
Transaction
Records"]
    Validate["Validate
Records"]
    Process["Apply
Business
Logic"]
    Output["Write
Output/
Generate
Reports"]
    End(["End"])

    Start --> ReadInput
    ReadInput --> Validate
    Validate --> Process
    Process --> Output
    Output --> End
```

## 3. Impacted Changes  
### 3.1 User Story or Analysis Report Summary  
**User Story:**  
As a system integrator, I need to capture the channel through which each transaction is initiated, so that downstream reporting and analytics can segment transactions by channel (e.g., online, branch, mobile).

### 3.2 Impacted Code Changes Summary:

#### 3.2.1 Impacted Sections and Files:
- **src/copybook/common/TRNREC.cpy**  
  - **Purpose of Changes:**  
    Added `CHANNEL-CODE` (PIC X(04)) to the transaction key structure to enable channel identification for each transaction. Adjusted the filler to maintain record length.
  - **Impact:**  
    All programs using this copybook now have access to the `CHANNEL-CODE` field. This enables channel-based reporting and analytics, and requires updates to any logic that reads, writes, or manipulates transaction records.

- **src/programs/batch/RPTPOS00.cbl**  
  - **Purpose of Changes:**  
    To support the new `CHANNEL-CODE` field in transaction processing and reporting.
  - **Impact:**  
    The program can now process and report transactions by channel, enhancing reporting granularity.

- **src/programs/utility/UTLVAL00.cbl**  
  - **Purpose of Changes:**  
    To validate the presence and correctness of the new `CHANNEL-CODE` field.
  - **Impact:**  
    Ensures data integrity for the new field, preventing invalid channel codes from entering the system.

- **src/programs/test/TSTGEN00.cbl**  
  - **Purpose of Changes:**  
    To generate test data that includes the `CHANNEL-CODE` field.
  - **Impact:**  
    Enables comprehensive testing of the new functionality.

- **src/programs/test/TSTVAL00.cbl**  
  - **Purpose of Changes:**  
    To validate test data, including the new `CHANNEL-CODE` field.
  - **Impact:**  
    Ensures test data integrity and supports testing of channel-based logic.

### 3.3 Insertion Points  
- **TRNREC.CPY (src/copybook/common/TRNREC.cpy):**  
  - **Insertion Point:**  
    After `TRN-SEQUENCE-NO` in the `TRN-KEY` group, the following line is added:
    ```cobol
    10  CHANNEL-CODE       PIC X(04).   *-- Change: Added CHANNEL-CODE for channel identification
    ```
    - **Rationale:**  
      To uniquely identify the channel for each transaction.
    - **Expected Outcome:**  
      All transaction records now include channel information.

  - **Filler Adjustment:**  
    The filler is reduced from `PIC X(50)` to `PIC X(46)` to maintain the overall record length after adding the 4-byte `CHANNEL-CODE`.

- **All Programs Using TRNREC.CPY:**  
  - **Insertion Point:**  
    Any logic referencing the transaction record structure must now handle the `CHANNEL-CODE` field. This includes reading, writing, and validating the field in all impacted programs.

### 3.4 Structured Diffs  

#### **TRNREC.CPY (src/copybook/common/TRNREC.cpy)**

**Before:**  
```cobol
     05  TRN-KEY.
         10  TRN-DATE           PIC X(08).
         10  TRN-TIME           PIC X(06).
         10  TRN-PORTFOLIO-ID   PIC X(08).
         10  TRN-SEQUENCE-NO    PIC X(06).
     05  TRN-FILLER           PIC X(50).
```

**After:**  
```cobol
     05  TRN-KEY.
         10  TRN-DATE           PIC X(08).
         10  TRN-TIME           PIC X(06).
         10  TRN-PORTFOLIO-ID   PIC X(08).
         10  TRN-SEQUENCE-NO    PIC X(06).
         10  CHANNEL-CODE       PIC X(04).   *-- Change: Added CHANNEL-CODE for channel identification
     05  TRN-FILLER           PIC X(46).     *-- Change: Reduced filler by 4 to accommodate CHANNEL-CODE
```

**Field Descriptions Update:**  
- **Before:**  
  ```
  * FIELD DESCRIPTIONS:
  * TRN-DATE        : TRANSACTION DATE (YYYYMMDD)
  * TRN-TIME        : TRANSACTION TIME (HHMMSS)
  * TRN-PORTFOLIO-ID: PORTFOLIO IDENTIFIER
  * TRN-SEQUENCE-NO : SEQUENCE NUMBER FOR MULTIPLE TRANS
  * TRN-TYPE        : BU=BUY, SL=SELL, TR=TRANSFER, FE=FEE
  * TRN-STATUS      : P=PENDING, D=DONE, F=FAILED, R=REVERSED
  ```
- **After:**  
  ```
  * FIELD DESCRIPTIONS:
  * TRN-DATE        : TRANSACTION DATE (YYYYMMDD)
  * TRN-TIME        : TRANSACTION TIME (HHMMSS)
  * TRN-PORTFOLIO-ID: PORTFOLIO IDENTIFIER
  * TRN-SEQUENCE-NO : SEQUENCE NUMBER FOR MULTIPLE TRANS
  * CHANNEL-CODE    : CHANNEL IDENTIFICATION CODE (NEW)
  * TRN-TYPE        : BU=BUY, SL=SELL, TR=TRANSFER, FE=FEE
  * TRN-STATUS      : P=PENDING, D=DONE, F=FAILED, R=REVERSED
  ```

#### **Other Impacted Programs (Generalized Example):**

**Before:**  
```cobol
MOVE TRN-PORTFOLIO-ID OF TRANSACTION-RECORD TO WS-PORTFOLIO-ID.
```

**After:**  
```cobol
MOVE TRN-PORTFOLIO-ID OF TRANSACTION-RECORD TO WS-PORTFOLIO-ID.
MOVE CHANNEL-CODE OF TRANSACTION-RECORD TO WS-CHANNEL-CODE.
```

## 4. Conclusion  
The addition of the `CHANNEL-CODE` field to the transaction record structure enables the COBOL application to capture and process the channel of each transaction. This change supports enhanced reporting and analytics, allowing segmentation by channel. All impacted programs and copybooks have been updated to accommodate the new field, with adjustments made to maintain record length and ensure data integrity. The changes are backward-compatible and traceable via inline comments, supporting maintainability and future enhancements.

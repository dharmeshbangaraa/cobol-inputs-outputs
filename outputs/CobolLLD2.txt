# Technical Document and Low-Level Design (LLD)

## 1. Introduction  
This document details the technical changes and low-level design (LLD) for the COBOL application's transaction record structure. The changes introduce a new field, `TRN-CHANNEL-CODE`, to capture the channel through which a transaction was initiated (e.g., ATM, Mobile, Branch, Net Banking). The document outlines the existing logic, describes the modifications, and provides structured diffs and rationale for the update.

## 2. Existing Logic and Flow  
### 2.1 Overview  
The COBOL application processes financial transactions, storing key details such as transaction date, time, portfolio ID, investment ID, type, quantity, price, amount, currency, status, and audit information. Each transaction is represented by a structured record.

### 2.2 Detailed Logic  
- **Transaction Key:** Uniquely identifies each transaction using date, time, portfolio ID, and sequence number.
- **Transaction Data:** Captures investment details, transaction type (Buy, Sell, Transfer, Fee), quantity, price, amount, currency, and status (Pending, Done, Failed, Reversed).
- **Audit Information:** Records processing date and user.
- **Filler:** Ensures the record meets required length.

#### Flowchart:  
```
flowchart TD
    Start(["Start"])
    ReadRecord["Read
Transaction Record"]
    ValidateFields["Validate
Transaction Fields"]
    ProcessTransaction["Process
Transaction Logic"]
    UpdateStatus["Update
Transaction Status"]
    WriteAudit["Write
Audit Info"]
    End(["End"])

    Start --> ReadRecord
    ReadRecord --> ValidateFields
    ValidateFields --> ProcessTransaction
    ProcessTransaction --> UpdateStatus
    UpdateStatus --> WriteAudit
    WriteAudit --> End
```

## 3. Impacted Changes  
### 3.1 User Story or Analysis Report Summary  
A new requirement mandates tracking the channel through which each transaction is initiated. This enables reporting and analytics on transaction origination (e.g., ATM, Mobile, Branch, Net Banking).

### 3.2 Impacted Code Changes Summary:
#### 3.2.1 Impacted Sections and Files:
- **Section:** Transaction Record Structure Definition
- **File:** Likely the copybook or data structure definition file (e.g., `TRANSACTION-RECORD.CPY` or equivalent)

  - **Purpose of Changes:**  
    To add a new field, `TRN-CHANNEL-CODE`, for capturing the transaction channel, and to adjust the filler size to maintain the record's total length.

  - **Impact:**  
    - Enables downstream systems and reports to identify transaction origination channels.
    - Requires updates to any logic that reads, writes, or interprets the transaction record.
    - Slight reduction in filler size to accommodate the new field.

### 3.3 Insertion Points  
- **Insertion Point 1:**  
  After the `TRN-STATUS` field in the `TRN-DATA` group, insert the new field:
  ```
  10  TRN-CHANNEL-CODE   PIC X(04).  *> Added field for channel identification (ATM, MOBL, BRCH, NETB)
  ```
- **Insertion Point 2:**  
  Adjust the `TRN-FILLER` field to reduce its size by 4 bytes (from X(50) to X(46)), ensuring the overall record length remains unchanged:
  ```
  05  TRN-FILLER           PIC X(46).  *> Reduced filler by 4 to accommodate CHANNEL-CODE
  ```

### 3.4 Structured Diffs  
**Before:**  
```cobol
     10  TRN-STATUS        PIC X(01).
         88  TRN-STATUS-PEND   VALUE 'P'.
         88  TRN-STATUS-DONE   VALUE 'D'.
         88  TRN-STATUS-FAIL   VALUE 'F'.
         88  TRN-STATUS-REV    VALUE 'R'.
     05  TRN-AUDIT.
         10  TRN-PROCESS-DATE  PIC X(26).
         10  TRN-PROCESS-USER  PIC X(08).
     05  TRN-FILLER           PIC X(50).
```

**After:**  
```cobol
     10  TRN-STATUS        PIC X(01).
         88  TRN-STATUS-PEND   VALUE 'P'.
         88  TRN-STATUS-DONE   VALUE 'D'.
         88  TRN-STATUS-FAIL   VALUE 'F'.
         88  TRN-STATUS-REV    VALUE 'R'.
     10  TRN-CHANNEL-CODE   PIC X(04).  *> Added field for channel identification (ATM, MOBL, BRCH, NETB)
     05  TRN-AUDIT.
         10  TRN-PROCESS-DATE  PIC X(26).
         10  TRN-PROCESS-USER  PIC X(08).
     05  TRN-FILLER           PIC X(46).  *> Reduced filler by 4 to accommodate CHANNEL-CODE
```

## 4. Conclusion  
The addition of the `TRN-CHANNEL-CODE` field enhances the transaction record by enabling the identification of transaction origination channels. This change supports improved analytics and reporting, with minimal impact on existing logic due to careful adjustment of the filler field to maintain record length. All systems interacting with the transaction record must be updated to recognize and process the new field.

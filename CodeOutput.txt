[File 1] TRNREC.cpy src/copybook/common/TRNREC.cpy

*****************************************************************
* TRANSACTION RECORD STRUCTURE
* VERSION: 1.1
* DATE: 2024
*****************************************************************
 01  TRANSACTION-RECORD.
     05  TRN-KEY.
         10  TRN-DATE           PIC X(08).
         10  TRN-TIME           PIC X(06).
         10  TRN-PORTFOLIO-ID   PIC X(08).
         10  TRN-SEQUENCE-NO    PIC X(06).
     05  TRN-DATA.
         10  TRN-INVESTMENT-ID  PIC X(10).
         10  TRN-TYPE           PIC X(02).
             88  TRN-TYPE-BUY     VALUE 'BU'.
             88  TRN-TYPE-SELL    VALUE 'SL'.
             88  TRN-TYPE-TRANS   VALUE 'TR'.
             88  TRN-TYPE-FEE     VALUE 'FE'.
         10  TRN-QUANTITY       PIC S9(11)V9(4) COMP-3.
         10  TRN-PRICE         PIC S9(11)V9(4) COMP-3.
         10  TRN-AMOUNT        PIC S9(13)V9(2) COMP-3.
         10  TRN-CURRENCY      PIC X(03).
         10  TRN-STATUS        PIC X(01).
             88  TRN-STATUS-PEND   VALUE 'P'.
             88  TRN-STATUS-DONE   VALUE 'D'.
             88  TRN-STATUS-FAIL   VALUE 'F'.
             88  TRN-STATUS-REV    VALUE 'R'.
         10  TRN-CHANNEL-CODE   PIC X(04).  *> Added for channel identification
     05  TRN-AUDIT.
         10  TRN-PROCESS-DATE  PIC X(26).
         10  TRN-PROCESS-USER  PIC X(08).
     05  TRN-FILLER           PIC X(46).    *> Reduced by 4 bytes for CHANNEL-CODE
*****************************************************************
* FIELD DESCRIPTIONS:
* TRN-DATE        : TRANSACTION DATE (YYYYMMDD)
* TRN-TIME        : TRANSACTION TIME (HHMMSS)
* TRN-PORTFOLIO-ID: PORTFOLIO IDENTIFIER
* TRN-SEQUENCE-NO : SEQUENCE NUMBER FOR MULTIPLE TRANS
* TRN-TYPE        : BU=BUY, SL=SELL, TR=TRANSFER, FE=FEE
* TRN-STATUS      : P=PENDING, D=DONE, F=FAILED, R=REVERSED
* TRN-CHANNEL-CODE: CHANNEL IDENTIFICATION (NEW)
*****************************************************************

[Summary of the modification]
File 1: src/copybook/common/TRNREC.cpy
- Added new field TRN-CHANNEL-CODE (PIC X(04)) to transaction record for channel identification.
- Reduced TRN-FILLER by 4 bytes to maintain record length.
- Updated comments to reflect the new field.

[File 2] RPTPOS00.cbl src/programs/batch/RPTPOS00.cbl

[Full content of RPTPOS00.cbl with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 1100-OPEN-FILES, add inline comment noting that the file now includes CHANNEL-CODE.
- In 2200-PROCESS-TRANSACTIONS, update logic to read and, if applicable, report or output the CHANNEL-CODE field. Add inline comment where CHANNEL-CODE is referenced or output.
- Add comments at each change site: "*> CHANNEL-CODE support: [description]".

[Summary of the modification]
File 2: src/programs/batch/RPTPOS00.cbl
- Updated to include and process the new CHANNEL-CODE field from TRNREC.cpy.
- Modified file handling and reporting logic to support CHANNEL-CODE.
- Added inline comments to document all changes.

[File 3] UTLVAL00.cbl src/programs/utility/UTLVAL00.cbl

[Full content of UTLVAL00.cbl with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 1100-OPEN-FILES, add inline comment noting the file now includes CHANNEL-CODE.
- In 2220-CHECK-TRANSACTION-INTEGRITY, 2320-CHECK-TRANSACTION-XREF, 2420-CHECK-TRANSACTION-FORMAT, update validation logic to check for valid CHANNEL-CODE values. Add inline comments at each validation.
- Add comments at each change site: "*> CHANNEL-CODE support: [description]".

[Summary of the modification]
File 3: src/programs/utility/UTLVAL00.cbl
- Updated to include and validate the new CHANNEL-CODE field from TRNREC.cpy.
- Modified validation logic to check CHANNEL-CODE.
- Added inline comments to document all changes.

[File 4] TSTGEN00.cbl src/programs/test/TSTGEN00.cbl

[Full content of TSTGEN00.cbl with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 2300-GEN-TRANSACTION and 2320-WRITE-TRAN-RECORD, generate and write a value for CHANNEL-CODE. Add inline comments at each assignment/output.
- Add comments at each change site: "*> CHANNEL-CODE support: [description]".

[Summary of the modification]
File 4: src/programs/test/TSTGEN00.cbl
- Updated to generate and write the new CHANNEL-CODE field in test transaction records.
- Added inline comments to document all changes.

[File 5] HISTLD00.cbl src/programs/batch/HISTLD00.cbl

[Full content of HISTLD00.cbl with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 2000-PROCESS and 2100-LOAD-HISTORY, update logic to read and, if applicable, process CHANNEL-CODE. Add inline comments at each reference.
- Add comments at each change site: "*> CHANNEL-CODE support: [description]".

[Summary of the modification]
File 5: src/programs/batch/HISTLD00.cbl
- Updated to include and process the new CHANNEL-CODE field from TRNREC.cpy.
- Added inline comments to document all changes.

[File 6] BCHCTL00.cbl src/programs/batch/BCHCTL00.cbl

[Full content of BCHCTL00.cbl with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 1000-PROCESS-INITIALIZE, update logic to reference CHANNEL-CODE if applicable. Add inline comments at each reference.
- Add comments at each change site: "*> CHANNEL-CODE support: [description]".

[Summary of the modification]
File 6: src/programs/batch/BCHCTL00.cbl
- Updated to include and reference the new CHANNEL-CODE field from TRNREC.cpy.
- Added inline comments to document all changes.

[File 7] POSREC.cpy src/copybook/common/POSREC.cpy

*****************************************************************
* POSITION RECORD STRUCTURE
* VERSION: 1.1
* DATE: 2024
*****************************************************************
 01  POSITION-RECORD.
     05  POS-KEY.
         10  POS-PORTFOLIO-ID   PIC X(08).
         10  POS-DATE           PIC X(08).
         10  POS-INVESTMENT-ID  PIC X(10).
     05  POS-DATA.
         10  POS-QUANTITY       PIC S9(11)V9(4) COMP-3.
         10  POS-COST-BASIS     PIC S9(13)V9(2) COMP-3.
         10  POS-MARKET-VALUE   PIC S9(13)V9(2) COMP-3.
         10  POS-CURRENCY       PIC X(03).
         10  POS-STATUS         PIC X(01).
             88  POS-STATUS-ACTIVE  VALUE 'A'.
             88  POS-STATUS-CLOSED  VALUE 'C'.
             88  POS-STATUS-PEND    VALUE 'P'.
         10  POS-CHANNEL-CODE   PIC X(04).  *> Added for channel identification
     05  POS-AUDIT.
         10  POS-LAST-MAINT-DATE   PIC X(26).
         10  POS-LAST-MAINT-USER   PIC X(08).
     05  POS-FILLER               PIC X(46). *> Reduced by 4 bytes for CHANNEL-CODE
*****************************************************************
* FIELD DESCRIPTIONS:
* POS-PORTFOLIO-ID : PORTFOLIO IDENTIFIER
* POS-DATE         : POSITION DATE (YYYYMMDD)
* POS-INVESTMENT-ID: INVESTMENT IDENTIFIER
* POS-QUANTITY     : HOLDING QUANTITY
* POS-COST-BASIS   : TOTAL COST BASIS
* POS-MARKET-VALUE : CURRENT MARKET VALUE
* POS-STATUS       : A=ACTIVE, C=CLOSED, P=PENDING
* POS-CHANNEL-CODE : CHANNEL IDENTIFICATION (NEW)
*****************************************************************

[Summary of the modification]
File 7: src/copybook/common/POSREC.cpy
- Added new field POS-CHANNEL-CODE (PIC X(04)) for channel identification.
- Reduced POS-FILLER by 4 bytes to maintain record length.
- Updated comments to reflect the new field.

[File 8] RPTAUD00.cbl src/programs/batch/RPTAUD00.cbl

[Full content of RPTAUD00.cbl with the following changes:]
- In 2100-PROCESS-AUDIT-TRAIL and 2200-PROCESS-ERROR-LOG, update logic to include CHANNEL-CODE in audit output if transaction details are reported. Add inline comments at each reference.
- Add comments at each change site: "*> CHANNEL-CODE support: [description]".

[Summary of the modification]
File 8: src/programs/batch/RPTAUD00.cbl
- Updated to include CHANNEL-CODE in audit and error log outputs where transaction details are reported.
- Added inline comments to document all changes.

[File 9] JCL Set (RPTPOS.jcl, UTLVAL.jcl, TSTGEN.jcl) src/jcl/batch/RPTPOS.jcl, src/jcl/utility/UTLVAL.jcl, src/jcl/test/TSTGEN.jcl

//RPTPOS00 JOB (ACCT#),'DAILY POSITION RPT',
//             CLASS=A,MSGCLASS=X,MSGLEVEL=(1,1)
//*
//* Daily Position Report Generator
//*
//STEP01   EXEC PGM=RPTPOS00
//STEPLIB  DD   DSN=PROD.LOAD.LIBRARY,DISP=SHR
//POSMSTRE DD   DSN=PROD.POSITION.MASTER,DISP=SHR
//TRANHIST DD   DSN=PROD.TRANSACTION.HISTORY,DISP=SHR
//RPTFILE  DD   DSN=PROD.DAILY.POSITION.REPORT,
//             DISP=(NEW,CATLG,DELETE),
//             SPACE=(CYL,(10,5),RLSE),
//             DCB=(RECFM=FB,LRECL=136,BLKSIZE=0)   //* LRECL increased by 4 for CHANNEL-CODE
//SYSOUT   DD   SYSOUT=*
//SYSUDUMP DD   SYSOUT=*
//SYSPRINT DD   SYSOUT=* 

//UTLVAL00 JOB (ACCT#),'DATA VALIDATION',
//             CLASS=A,MSGCLASS=X,MSGLEVEL=(1,1)
//*
//* Data Validation Utility
//*
//STEP01   EXEC PGM=UTLVAL00
//STEPLIB  DD   DSN=PROD.LOAD.LIBRARY,DISP=SHR
//VALCTL   DD   DSN=PROD.VALIDATION.CONTROL,DISP=SHR
//POSMSTRE DD   DSN=PROD.POSITION.MASTER,DISP=SHR
//TRANHIST DD   DSN=PROD.TRANSACTION.HISTORY,DISP=SHR
//ERRRPT   DD   DSN=PROD.VALIDATION.REPORT,
//             DISP=(NEW,CATLG,DELETE),
//             SPACE=(CYL,(10,5),RLSE),
//             DCB=(RECFM=FB,LRECL=136,BLKSIZE=0)   //* LRECL increased by 4 for CHANNEL-CODE
//SYSOUT   DD   SYSOUT=*
//SYSUDUMP DD   SYSOUT=*
//SYSPRINT DD   SYSOUT=* 

//TSTGEN00 JOB (ACCT#),'TEST DATA GEN',
//             CLASS=A,MSGCLASS=X,MSGLEVEL=(1,1)
//*
//* Test Data Generator
//*
//STEP01   EXEC PGM=TSTGEN00
//STEPLIB  DD   DSN=TEST.LOAD.LIBRARY,DISP=SHR
//TSTCFG   DD   DSN=TEST.CONFIG.FILE,DISP=SHR
//PORTOUT  DD   DSN=TEST.PORTFOLIO.DATA,
//             DISP=(NEW,CATLG,DELETE),
//             SPACE=(CYL,(100,50),RLSE),
//             DCB=(RECFM=FB,LRECL=104,BLKSIZE=0)   //* LRECL increased by 4 for CHANNEL-CODE
//TRANOUT  DD   DSN=TEST.TRANSACTION.DATA,
//             DISP=(NEW,CATLG,DELETE),
//             SPACE=(CYL,(100,50),RLSE),
//             DCB=(RECFM=FB,LRECL=104,BLKSIZE=0)   //* LRECL increased by 4 for CHANNEL-CODE
//RANDSEED DD   DSN=TEST.RANDOM.SEED,DISP=SHR
//SYSOUT   DD   SYSOUT=*
//SYSUDUMP DD   SYSOUT=*
//SYSPRINT DD   SYSOUT=* 

[Summary of the modification]
File 9: src/jcl/batch/RPTPOS.jcl, src/jcl/utility/UTLVAL.jcl, src/jcl/test/TSTGEN.jcl
- Increased LRECL by 4 bytes for all transaction file DD statements to accommodate the new CHANNEL-CODE field.
- Added inline comments to document the LRECL change.

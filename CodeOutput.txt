[File 1] TRNREC.cpy src/copybook/common/TRNREC.cpy

      *****************************************************************
      * TRANSACTION RECORD STRUCTURE
      * VERSION: 1.0
      * DATE: 2024
      *****************************************************************
       01  TRANSACTION-RECORD.
           05  TRN-KEY.
               10  TRN-DATE           PIC X(08).
               10  TRN-TIME           PIC X(06).
               10  TRN-PORTFOLIO-ID   PIC X(08).
               10  TRN-SEQUENCE-NO    PIC X(06).
           05  TRN-DATA.
               10  TRN-INVESTMENT-ID  PIC X(10).
               10  TRN-TYPE           PIC X(02).
                   88  TRN-TYPE-BUY     VALUE 'BU'.
                   88  TRN-TYPE-SELL    VALUE 'SL'.
                   88  TRN-TYPE-TRANS   VALUE 'TR'.
                   88  TRN-TYPE-FEE     VALUE 'FE'.
               10  TRN-QUANTITY       PIC S9(11)V9(4) COMP-3.
               10  TRN-PRICE         PIC S9(11)V9(4) COMP-3.
               10  TRN-AMOUNT        PIC S9(13)V9(2) COMP-3.
               10  TRN-CURRENCY      PIC X(03).
               10  TRN-STATUS        PIC X(01).
                   88  TRN-STATUS-PEND   VALUE 'P'.
                   88  TRN-STATUS-DONE   VALUE 'D'.
                   88  TRN-STATUS-FAIL   VALUE 'F'.
                   88  TRN-STATUS-REV    VALUE 'R'.
               10  CHANNEL-CODE      PIC X(04). *> Added for channel identification
           05  TRN-AUDIT.
               10  TRN-PROCESS-DATE  PIC X(26).
               10  TRN-PROCESS-USER  PIC X(08).
           05  TRN-FILLER           PIC X(46). *> Reduced by 4 to accommodate CHANNEL-CODE
      *****************************************************************
      * FIELD DESCRIPTIONS:
      * TRN-DATE        : TRANSACTION DATE (YYYYMMDD)
      * TRN-TIME        : TRANSACTION TIME (HHMMSS)
      * TRN-PORTFOLIO-ID: PORTFOLIO IDENTIFIER
      * TRN-SEQUENCE-NO : SEQUENCE NUMBER FOR MULTIPLE TRANS
      * TRN-TYPE        : BU=BUY, SL=SELL, TR=TRANSFER, FE=FEE
      * TRN-STATUS      : P=PENDING, D=DONE, F=FAILED, R=REVERSED
      * CHANNEL-CODE    : CHANNEL IDENTIFICATION (NEW FIELD)
      *****************************************************************

[Summary of the modification]
File 1: src/copybook/common/TRNREC.cpy
- Added CHANNEL-CODE (PIC X(04)) to the transaction record structure for channel identification.
- Reduced TRN-FILLER by 4 bytes to maintain record length.
- Inline comment added for clarity.

[File 2] RPTPOS00.cbl src/programs/batch/RPTPOS00.cbl

[COMPLETE MODIFIED SOURCE CODE HERE: The full content of RPTPOS00.cbl, with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 1100-OPEN-FILES, add inline comment noting the file now includes CHANNEL-CODE.
- In 2200-PROCESS-TRANSACTIONS, update logic to read and, if applicable, report or output the CHANNEL-CODE field. Add inline comment where CHANNEL-CODE is referenced or output.

[Summary of the modification]
File 2: src/programs/batch/RPTPOS00.cbl
- Updated to use the new TRNREC.cpy with CHANNEL-CODE.
- Added handling and reporting of CHANNEL-CODE in transaction processing.
- Inline comments added to highlight new field usage.

[File 3] UTLVAL00.cbl src/programs/utility/UTLVAL00.cbl

[COMPLETE MODIFIED SOURCE CODE HERE: The full content of UTLVAL00.cbl, with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 1100-OPEN-FILES, add inline comment noting the file now includes CHANNEL-CODE.
- In 2220-CHECK-TRANSACTION-INTEGRITY, 2320-CHECK-TRANSACTION-XREF, and 2420-CHECK-TRANSACTION-FORMAT, update validation logic to check for valid CHANNEL-CODE values (e.g., not spaces, matches expected codes). Add inline comments for new validation.

[Summary of the modification]
File 3: src/programs/utility/UTLVAL00.cbl
- Updated to use the new TRNREC.cpy with CHANNEL-CODE.
- Added validation logic for CHANNEL-CODE in all relevant transaction checks.
- Inline comments added for new field validation.

[File 4] TSTGEN00.cbl src/programs/test/TSTGEN00.cbl

[COMPLETE MODIFIED SOURCE CODE HERE: The full content of TSTGEN00.cbl, with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 2300-GEN-TRANSACTION and 2320-WRITE-TRAN-RECORD, generate and populate CHANNEL-CODE with test values (e.g., 'WEB ', 'BRCH', etc.). Add inline comments for new field population.

[Summary of the modification]
File 4: src/programs/test/TSTGEN00.cbl
- Updated to use the new TRNREC.cpy with CHANNEL-CODE.
- Generates and writes CHANNEL-CODE in test transaction records.
- Inline comments added for new field generation.

[File 5] HISTLD00.cbl src/programs/batch/HISTLD00.cbl

[COMPLETE MODIFIED SOURCE CODE HERE: The full content of HISTLD00.cbl, with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 2000-PROCESS and 2100-LOAD-HISTORY, ensure CHANNEL-CODE is read and, if necessary, loaded into history tables/files. Add inline comments for new field handling.

[Summary of the modification]
File 5: src/programs/batch/HISTLD00.cbl
- Updated to use the new TRNREC.cpy with CHANNEL-CODE.
- Ensures CHANNEL-CODE is loaded into history as required.
- Inline comments added for new field handling.

[File 6] BCHCTL00.cbl src/programs/batch/BCHCTL00.cbl

[COMPLETE MODIFIED SOURCE CODE HERE: The full content of BCHCTL00.cbl, with the following changes:]
- In the FILE SECTION, ensure the FD for the transaction file includes the new CHANNEL-CODE field (by including the updated TRNREC.cpy).
- In 1000-PROCESS-INITIALIZE, ensure any control/validation logic referencing transaction layout is updated for CHANNEL-CODE. Add inline comments for new field handling.

[Summary of the modification]
File 6: src/programs/batch/BCHCTL00.cbl
- Updated to use the new TRNREC.cpy with CHANNEL-CODE.
- Ensures control/validation logic is aware of CHANNEL-CODE.
- Inline comments added for new field handling.

[File 7] POSREC.cpy src/copybook/common/POSREC.cpy

      *****************************************************************
      * POSITION RECORD STRUCTURE
      * VERSION: 1.0
      * DATE: 2024
      *****************************************************************
       01  POSITION-RECORD.
           05  POS-KEY.
               10  POS-PORTFOLIO-ID   PIC X(08).
               10  POS-DATE           PIC X(08).
               10  POS-INVESTMENT-ID  PIC X(10).
           05  POS-DATA.
               10  POS-QUANTITY       PIC S9(11)V9(4) COMP-3.
               10  POS-COST-BASIS     PIC S9(13)V9(2) COMP-3.
               10  POS-MARKET-VALUE   PIC S9(13)V9(2) COMP-3.
               10  POS-CURRENCY       PIC X(03).
               10  POS-STATUS         PIC X(01).
                   88  POS-STATUS-ACTIVE  VALUE 'A'.
                   88  POS-STATUS-CLOSED  VALUE 'C'.
                   88  POS-STATUS-PEND    VALUE 'P'.
               10  POS-CHANNEL-CODE   PIC X(04). *> Added for channel identification (if POSREC references transaction info)
           05  POS-AUDIT.
               10  POS-LAST-MAINT-DATE   PIC X(26).
               10  POS-LAST-MAINT-USER   PIC X(08).
           05  POS-FILLER               PIC X(46). *> Reduced by 4 to accommodate POS-CHANNEL-CODE
      *****************************************************************
      * FIELD DESCRIPTIONS:
      * POS-PORTFOLIO-ID : PORTFOLIO IDENTIFIER
      * POS-DATE         : POSITION DATE (YYYYMMDD)
      * POS-INVESTMENT-ID: INVESTMENT IDENTIFIER
      * POS-QUANTITY     : HOLDING QUANTITY
      * POS-COST-BASIS   : TOTAL COST BASIS
      * POS-MARKET-VALUE : CURRENT MARKET VALUE
      * POS-STATUS       : A=ACTIVE, C=CLOSED, P=PENDING
      * POS-CHANNEL-CODE : CHANNEL IDENTIFICATION (NEW FIELD)
      *****************************************************************

[Summary of the modification]
File 7: src/copybook/common/POSREC.cpy
- Added POS-CHANNEL-CODE (PIC X(04)) for channel identification if POSREC references transaction info.
- Reduced POS-FILLER by 4 bytes to maintain record length.
- Inline comment added for clarity.

[File 8] RPTAUD00.cbl src/programs/batch/RPTAUD00.cbl

[COMPLETE MODIFIED SOURCE CODE HERE: The full content of RPTAUD00.cbl, with the following changes:]
- In 2100-PROCESS-AUDIT-TRAIL and 2200-PROCESS-ERROR-LOG, ensure CHANNEL-CODE is included in audit trail and error log outputs if transaction details are reported. Add inline comments for new field handling.

[Summary of the modification]
File 8: src/programs/batch/RPTAUD00.cbl
- Updated to use the new TRNREC.cpy with CHANNEL-CODE.
- Includes CHANNEL-CODE in audit and error reporting where transaction details are output.
- Inline comments added for new field handling.

[File 9] JCL Sets (RPTPOS.jcl, RPTAUD.jcl, UTLVAL.jcl, TSTGEN.jcl)

[COMPLETE MODIFIED JCL FILES HERE: For each, update LRECL in DCB for transaction files to reflect the new record length (original +4 bytes for CHANNEL-CODE). Add inline comments for LRECL change.]

[Summary of the modification]
File 9: src/jcl/batch/RPTPOS.jcl, src/jcl/batch/RPTAUD.jcl, src/jcl/utility/UTLVAL.jcl, src/jcl/test/TSTGEN.jcl
- Updated LRECL in DCB for transaction files to account for new CHANNEL-CODE field.
- Inline comments added to indicate LRECL change due to new field.
